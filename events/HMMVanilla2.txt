###########################
# German Events
###########################

add_namespace = germany

# Austrian Anschluss Completed
country_event = {
	id = germany.4
	title = germany.4.t
	desc = germany.4.d
	picture = GFX_report_event_german_speech

	is_triggered_only = yes

 	immediate = {
 		hidden_effect = {
 			add_named_threat = { threat = 10 name = germany.4.t }
 		}
 	}

	option = {
		name = germany.4.a
		4 = {
			if = {
				limit = { is_owned_by = AUS }
				add_core_of = GER
			}
		}
		152 = {
			if = {
				limit = { is_owned_by = AUS }
				add_core_of = GER
			}
		}
		153 = {
			if = {
				limit = { is_owned_by = AUS }
				add_core_of = GER
			}
		}
		AUS = {
			every_unit_leader = {
				set_nationality = GER
			}
		}
		annex_country = { target = AUS transfer_troops = yes }
		add_political_power = 75
		set_country_flag = AUS_annexed
		add_war_support = 0.1
		add_stability = 0.05
		USA = {
			set_country_flag = { flag = USA_anschluss_window days = 60 value = 1 }
		}
		custom_effect_tooltip = anschluss_mefo_bills_tt
		hidden_effect = { # Having it appear twice might be confusing
			GER_mefo_bills_level_down = yes
			GER_mefo_bills_level_down = yes
		}
		custom_effect_tooltip = anschluss_mefo_bills_double_reduction
		add_to_variable = { var = GER_mefo_bill_counter value = -10 }

		if = {
			limit = {
				has_dlc = "Death or Dishonor"
				country_exists = YUG
				YUG = { has_war = no }
			}
			country_event = {
				id = DOD_yugoslavia.30
				days = 4
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.36 }
		}
	}
}

#anti_comintern_pact
# nations are asked to join pact, agreeing = relations with GER and hit with SOV

country_event = {
	id = germany.5
	title = germany.5.t
	desc = germany.5.d
	picture = GFX_report_event_japan_europe_pact

	is_triggered_only = yes

	option = {
		name = germany.5.a		#join
		ai_chance = {
			factor = 75
			modifier = {
				factor = 4
				has_opinion = {
					target = SOV
					value < -10
				}
			}
			modifier = {
				factor = 0.5
				has_opinion = {
					target = GER
					value < -10
				}
			}
			modifier = {
				factor = 0
				has_war = yes
			}
			modifier = {
				factor = 0
				is_literally_china = yes
				JAP = { has_completed_focus = JAP_purge_the_kodoha_faction }
			}
			modifier = {
				factor = 0
				tag = JAP
				has_completed_focus = JAP_purge_the_kodoha_faction
				date > 1938.1.1
			}
		}
		set_country_flag = anti_comintern_member
		GER = { add_opinion_modifier = { target = ROOT modifier = anti_comintern_pact_opinion } }
		add_opinion_modifier = { target = GER modifier = anti_comintern_pact_opinion }
		SOV  = { add_opinion_modifier = { target = ROOT modifier = pact_against_us } }
	}

	#option = {
		#name = germany.5.b		#refuse
		#trigger = { NOT = { is_puppet_of = GER } }
		#ai_chance = {
			#factor = 25
		#}
		#GER =  { add_opinion_modifier = { target = ROOT modifier = refused_anti_comintern_pact_opinion } }
	#}

}

# tripartite_pact
# anti_comintern_pact nations are asked to join pact, agreeing = relations with GER and hit with SOV

country_event = {
	id = germany.6
	title = germany.6.t
	desc = germany.6.d
	picture = GFX_report_event_hitler_croatia_handshake


	is_triggered_only = yes

	option = {
		name = germany.6.a		#join
		remove_opinion_modifier = { target = GER modifier = anti_comintern_pact_opinion }
		add_opinion_modifier = { target = GER modifier = tripartite_pact_opinion }
		remove_opinion_modifier = { target = SOV modifier = pact_against_us }
		add_opinion_modifier = { target = SOV modifier = worse_pact_against_us }
	}

	option = {
		name = germany.6.b		#refuse
		trigger = { NOT = { is_puppet_of = GER } }
		add_opinion_modifier = { target = GER modifier = refused_tripartite_pact_opinion }
	}

}

#molotov_ribbentrop_pact
# fire event to SOV to accept or not. adds claims
# SOV events sends reply to GER, adds claims if they said yes, hurts relations if they say no

# Molotov-Ribbentrop Pact (Soviets)
country_event = {
	id = germany.11
	title = germany.11.t
	desc = germany.11.d
	picture = GFX_report_event_molotov_ribentrop_handshake

	is_triggered_only = yes

	option = {
		name = germany.11.a	#sounds good
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0
				GER = {
					OR = {
						has_wargoal_against = SOV
						is_justifying_wargoal_against = SOV
					}
					NOT = {
						is_in_faction_with = SOV
					}
				}
			}
		}
		add_opinion_modifier = { target = GER modifier = MR_pact }# pact
		custom_effect_tooltip = germany.11.a.tt
		if = {
			limit = {
				NOT = { owns_state = 146 }
			}
			add_state_claim = 146 #KARELIA (FIN)
		}
		if = {
			limit = {
				NOT = { owns_state = 147 }
			}
			add_state_claim = 147 #SALLA (FIN)
		}
		if = {
			limit = {
				NOT = { owns_state = 722 }
			}
			add_state_claim = 722 #PETSAMO (FIN)
		}
		if = {
			limit = {
				NOT = { owns_state = 13 }
			}
			add_state_claim = 13 #PÄRNU (EST)
		}
		if = {
			limit = {
				NOT = { owns_state = 191 }
			}
			add_state_claim = 191 #TARTU (EST)
		}
		if = {
			limit = {
				NOT = { owns_state = 314 }
			}
			add_state_claim = 314 #SAAREMAA (EST)
		}
		if = {
			limit = {
				NOT = { owns_state = 312 }
			}
			add_state_claim = 312 #VIRUMAA (EST)
		}
		if = {
			limit = {
				NOT = { owns_state = 313 }
			}
			add_state_claim = 313 #TALLIN (EST)
		}
		if = {
			limit = {
				NOT = { owns_state = 12 }
			}
			add_state_claim = 12 #VIDZEME (LAT)
		}
		if = {
			limit = {
				NOT = { owns_state = 190 }
			}
			add_state_claim = 190 #KURZEME (LAT)
		}
		if = {
			limit = {
				NOT = { owns_state = 317 }
			}
			add_state_claim = 317 #RIGA (LAT)
		}
		if = {
			limit = {
				NOT = { owns_state = 316 }
			}
			add_state_claim = 316 #ZEMGALE (LAT)
		}
		if = {
			limit = {
				NOT = { owns_state = 315 }
			}
			add_state_claim = 315 #LATGALE (LAT)
		}
		if = {
			limit = {
				NOT = { owns_state = 11 }
			}
			add_state_claim = 11 #KAUNAS (LIT)
		}
		if = {
			limit = {
				NOT = { owns_state = 702 }
			}
			add_state_claim = 702 #WILNO (LIT)
		}
		if = {
			limit = {
				NOT = { owns_state = 189 }
			}
			add_state_claim = 189 #ZEMAITIJA (LIT)
		}
		if = {
			limit = {
				NOT = { owns_state = 306 }
			}
			add_state_claim = 306 #SUDUVA (LIT)
		}
		if = {
			limit = {
				NOT = { owns_state = 305 }
			}
			add_state_claim = 305 #AUKSTAITIJA (LIT)
		}
		if = {
			limit = {
				NOT = { owns_state = 89 }
			}
			add_state_claim = 89 #STANISLAWOW (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 91 }
			}
			add_state_claim = 91 #LWOW (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 93 }
			}
			add_state_claim = 93 #WOLYN (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 94 }
			}
			add_state_claim = 94 #POLESIE (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 95 }
			}
			add_state_claim = 95 #NOWOGRODEK (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 96 }
			}
			add_state_claim = 96 #WILEJKA (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 97 }
			}
			add_state_claim = 97 #BIALYSTOK (POL)
		}
		if = {
			limit = {
				NOT = { owns_state = 78 }
			}
			add_state_claim = 78 #BESSARABIA (ROM)
		}
		if = {
			limit = {
				NOT = { owns_state = 80 }
			}
			add_state_claim = 80 #BUCOVINA (ROM)
		}
		if = {
			limit = {
				NOT = { owns_state = 343 }
			}
			add_state_claim = 343 #SOUTHERN BESSARABIA (ROM)
		}

		hidden_effect =  { add_timed_idea = { idea = SOV_molotov_ribbentrop_pact days = 730 } }
		GER = {
			country_event = { days = 1 id = germany.12 }
			effect_tooltip = {
				add_opinion_modifier = { target = SOV modifier = MR_pact }# pact
			}
		}
		set_global_flag = sov_yes_pact
	}
}

# Soviets Sign MR Pact
country_event = {
	id = germany.12
	title = germany.12.t
	desc = germany.12.d
	picture = GFX_report_event_molotov_signing_pact

	is_triggered_only = yes

	option = {
		name = germany.12.a	#neat
		every_other_country = {
			limit = {
				NOT = { tag = GER }
				has_government = fascism
			}
			add_opinion_modifier = { target = GER modifier = MR_pact_fascists }
		}
		diplomatic_relation = { country = SOV relation = non_aggression_pact }
		add_opinion_modifier = { target = SOV modifier = MR_pact }# pact
		USA = {
			set_country_flag = { flag = USA_MR_window days = 60 value = 1 }
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.32 }
		}
	}
}

# Poland conquered... honor MR Pact?
country_event = {
	id = germany.14
	title = germany.14.t
	desc = germany.14.d
	picture = GFX_report_event_german_troops

	fire_only_once = yes

	trigger = {
		OR = {
			tag = GER
			AND = {
				tag = LIT
				is_ai = no
				has_global_flag = LIT_occupies_POL
			}
		}
		has_global_flag = sov_yes_pact
		SOU = { exists = yes }
		NOT =  { has_war_with = SOU }
		OR = {
			AND = {
				OR = {
					owns_state = 96
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 96
					}
				}
				OR = {
					owns_state = 95
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 95
					}
				}
				OR = {
					owns_state = 94
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 94
					}
				}
				OR = {
					owns_state = 93
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 93
					}
				}
				OR = {
					owns_state = 91
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 91
					}
				}
				OR = {
					owns_state = 97
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 97
					}
				}
				OR = {
					owns_state = 89
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 89
					}
				}
				OR = {
					owns_state = 702
					any_other_country = {
						is_in_faction_with = GER
						GER = {
							is_faction_leader = yes
						}
						owns_state = 702
					}
				}
			}
			AND = {
				POL = { has_capitulated = yes }
				AND = {
					OR = {
						controls_state = 96
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 96
						}
					}
					OR = {
						controls_state = 95
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 95
						}
					}
					OR = {
						controls_state = 94
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 94
						}
					}
					OR = {
						controls_state = 93
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 93
						}
					}
					OR = {
						controls_state = 91
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 91
						}
					}
					OR = {
						controls_state = 97
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 97
						}
					}
					OR = {
						controls_state = 89
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 89
						}
					}
					OR = {
						controls_state = 702
						any_other_country = {
							is_in_faction_with = GER
							GER = {
								is_faction_leader = yes
							}
							controls_state = 702
						}
					}
				}
			}
		}
	}


	option = {
		ai_chance = {
			base = 1
			modifier = {
				factor = 0
				AND = {
					POL = {
						is_ai = no
						has_civil_war = no
					}
					is_in_faction_with = POL
				}
			}
		}
		name = germany.14.a
		if = { #MR Pact if ally has taken some of Poland
			limit = {
				GER = { is_faction_leader = yes }
				any_allied_country = {
					NOT = { is_subject_of = GER }
					NOT = { tag = SOU }
					OR = {
						controls_state = 96
						controls_state = 95
						controls_state = 94
						controls_state = 93
						controls_state = 91
						controls_state = 97
						controls_state = 89
						controls_state = 702
					}
				}
			}
			random_country = {
				limit = {
					is_in_faction_with = ROOT
					NOT = { is_subject_of = GER }
					NOT = { tag = SOU }
					OR = {
						controls_state = 96
						controls_state = 95
						controls_state = 94
						controls_state = 93
						controls_state = 91
						controls_state = 97
						controls_state = 89
						controls_state = 702
					}
				}
				if = {
					limit = {
						is_subject = yes
					}
					OVERLORD = { country_event = germany.1002 }
				}
				else = {
					country_event = { id = germany.1002 hours = 3 }
				}
			}
		}
		else = { #MR Pact as normal
			MR_pact_transfer_state_effect = yes
			SOU = { country_event = { id = germany.15 hours = 3 } }
		}
	}
}

#Event for allies signing MR pact
country_event = {
	id = germany.1002
	title = germany.1002.t
	desc = germany.1002.desc
	picture = GFX_report_event_molotov_signing_pact

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_country_flag = responded_to_MR_allied_pact
			every_other_country = {
				limit = {
					is_subject_of = ROOT
				}
				set_country_flag = responded_to_MR_allied_pact
			}
		}
	}

	option = { #Agree to honor the pact
		name = germany.14.a
		ai_chance = {
			base = 100 #ai should always say yes if Germany said yes
		}
		effect_tooltip = {
			MR_pact_transfer_state_effect = yes
		}
		hidden_effect = { #Keep going around all of Germany's allies who own parts of Poland until they have all made a decision
			if = {
				limit = {
					any_allied_country = {
						NOT = { is_subject_of = ROOT }
						NOT = { has_country_flag = responded_to_MR_allied_pact }
						OR = {
							controls_state = 96
							controls_state = 95
							controls_state = 94
							controls_state = 93
							controls_state = 91
							controls_state = 97
							controls_state = 89
							controls_state = 702
						}
					}
				}
				random_country = {
					limit = {
						is_in_faction_with = ROOT
						NOT = { is_subject_of = ROOT }
						NOT = { has_country_flag = responded_to_MR_allied_pact }
						OR = {
							controls_state = 96
							controls_state = 95
							controls_state = 94
							controls_state = 93
							controls_state = 91
							controls_state = 97
							controls_state = 89
							controls_state = 702
						}
					}
					if = {
						limit = {
							is_subject = yes
						}
						OVERLORD = { country_event = germany.1002 }
					}
					else = {
						country_event = germany.1002
					}
				}
			}
			else = { #No more allies left to ask, actually do the MR pact
				MR_pact_transfer_faction_state_effect = yes
				SOU = { country_event = germany.15 }
			}
		}
	}
}

#Event telling Germany their ally broke the pact
country_event = {
	id = germany.1003
	title = germany.1003.t
	desc = germany.1003.desc
	picture = GFX_report_event_molotov_signing_pact

	is_triggered_only = yes

	option = {
		name = germany.1003.a
		ai_chance = {
			base = 1
		}
		effect_tooltip = {
			GER = {
				diplomatic_relation = {
					country = SOV
					relation = non_aggression_pact
					active = no
				}
			}
			SOU = {
				if = {
					limit = {
						NOT = { owns_state = 146 }
					}
					add_state_claim = 146 #KARELIA (FIN)
				}
				if = {
					limit = {
						NOT = { owns_state = 147 }
					}
					add_state_claim = 147 #SALLA (FIN)
				}
				if = {
					limit = {
						NOT = { owns_state = 722 }
					}
					add_state_claim = 722 #PETSAMO (FIN)
				}
				if = {
					limit = {
						NOT = { owns_state = 13 }
					}
					add_state_claim = 13 #PÄRNU (EST)
				}
				if = {
					limit = {
						NOT = { owns_state = 191 }
					}
					add_state_claim = 191 #TARTU (EST)
				}
				if = {
					limit = {
						NOT = { owns_state = 314 }
					}
					add_state_claim = 314 #SAAREMAA (EST)
				}
				if = {
					limit = {
						NOT = { owns_state = 312 }
					}
					add_state_claim = 312 #VIRUMAA (EST)
				}
				if = {
					limit = {
						NOT = { owns_state = 313 }
					}
					add_state_claim = 313 #TALLIN (EST)
				}
				if = {
					limit = {
						NOT = { owns_state = 12 }
					}
					add_state_claim = 12 #VIDZEME (LAT)
				}
				if = {
					limit = {
						NOT = { owns_state = 190 }
					}
					add_state_claim = 190 #KURZEME (LAT)
				}
				if = {
					limit = {
						NOT = { owns_state = 317 }
					}
					add_state_claim = 317 #RIGA (LAT)
				}
				if = {
					limit = {
						NOT = { owns_state = 316 }
					}
					add_state_claim = 316 #ZEMGALE (LAT)
				}
				if = {
					limit = {
						NOT = { owns_state = 315 }
					}
					add_state_claim = 315 #LATGALE (LAT)
				}
				if = {
					limit = {
						NOT = { owns_state = 11 }
					}
					add_state_claim = 11 #KAUNAS (LIT)
				}
				if = {
					limit = {
						NOT = { owns_state = 702 }
					}
					add_state_claim = 702 #WILNO (LIT)
				}
				if = {
					limit = {
						NOT = { owns_state = 189 }
					}
					add_state_claim = 189 #ZEMAITIJA (LIT)
				}
				if = {
					limit = {
						NOT = { owns_state = 306 }
					}
					add_state_claim = 306 #SUDUVA (LIT)
				}
				if = {
					limit = {
						NOT = { owns_state = 305 }
					}
					add_state_claim = 305 #AUKSTAITIJA (LIT)
				}
				if = {
					limit = {
						NOT = { owns_state = 89 }
					}
					add_state_claim = 89 #STANISLAWOW (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 91 }
					}
					add_state_claim = 91 #LWOW (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 93 }
					}
					add_state_claim = 93 #WOLYN (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 94 }
					}
					add_state_claim = 94 #POLESIE (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 95 }
					}
					add_state_claim = 95 #NOWOGRODEK (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 96 }
					}
					add_state_claim = 96 #WILEJKA (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 97 }
					}
					add_state_claim = 97 #BIALYSTOK (POL)
				}
				if = {
					limit = {
						NOT = { owns_state = 78 }
					}
					add_state_claim = 78 #BESSARABIA (ROM)
				}
				if = {
					limit = {
						NOT = { owns_state = 80 }
					}
					add_state_claim = 80 #BUCOVINA (ROM)
				}
				if = {
					limit = {
						NOT = { owns_state = 343 }
					}
					add_state_claim = 343 #SOUTHERN BESSARABIA (ROM)
				}
				effect_tooltip = {
					create_wargoal = {
						type = annex_everything
						target = GER
					}
				}
			}
		}
	}
}

# Germany honors MR Pact (Soviets)
country_event = {
	id = germany.15
	title = germany.15.t
	desc = germany.15.d
	picture = GFX_report_event_soviet_german_soldier_handshake

	is_triggered_only = yes

	option = {
		name = germany.12.a
		if = {
			limit = {
				SOU = {
					controls_state = 93
					controls_state = 94
				}
			}
			hidden_effect = {
				news_event = { hours = 6 id = news.33 }
			}
		}
	}
}

# Germany betrays MR Pact (Soviets)
country_event = {
	id = germany.16
	title = germany.16.t
	desc = germany.16.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = {
		name = germany.16.a
		hidden_effect = {
			news_event = news.153
		}
		create_wargoal = {
			type = annex_everything
			target = FROM
		}
	}
}

# Romania Rejects Decision!
country_event = {
	id = germany.21
	title = germany.21.t
	desc = germany.21.d
	picture = GFX_report_event_vienna_award_hungary

	is_triggered_only = yes

	option = {
		name = germany.21.a
		create_wargoal = {
			type = take_state_focus
			target = ROM
			generator = { 76 }
		}
	}
}

# Claim Memel - Lithuania Folds
country_event = {
	id = germany.22
	title = germany.22.t
	desc = germany.22.d
	picture = GFX_report_event_vienna_award_hungary

	is_triggered_only = yes

	option = {
		name = germany.22.a
		GER = {
			transfer_state = 188
			add_state_core = 188
		}
		hidden_effect = {
			country_event = { days = 1 id = news.19 }
		}
	}
}

# Claim Memel - Lithuania Rejects Demand
country_event = {
	id = germany.23
	title = germany.23.t
	desc = germany.23.d
	picture = GFX_report_event_lithuania_army

	is_triggered_only = yes

	option = {
		name = germany.23.a
		create_wargoal = {
			type = take_state_focus
			target = LIT
			generator = { 188 }
		}
		hidden_effect = {
			country_event = { days = 1 id = news.20 }
		}
	}
}


# Fortifying the Westwall
country_event = {
	id = germany.27
	title = germany.27.t
	desc = germany.27.d
	picture = GFX_report_event_bunker_01

	is_triggered_only = yes

	option = {
		name = germany.27.a
		50 = {
			add_building_construction = {
				type = bunker
				province = 11640
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 6712
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 6542
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 3530
				level = 5
			}
		}
		42 = {
			add_building_construction = {
				type = bunker
				province = 3558
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 563
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 11531
				level = 5
			}
			add_building_construction = {
				type = bunker
				province = 9575
				level = 5
			}
		}
	}
}

# Austria asked about Anschluss
country_event = {
	id = germany.28
	title = germany.28.t
	desc = germany.28.d
	picture = GFX_report_event_hitler_parade

	is_triggered_only = yes

	option = { # Accept
		name = germany.28.a
		ai_chance = {
			base = 30
			modifier = {
				add = -25
				GER = { has_army_size = { size < 40 } }
			}
			modifier = {
				add = 100
				GER = { has_army_size = { size > 39 } }
			}
			modifier = {
				add = 20
				is_in_faction_with = GER
			}
		}
		GER = {
			country_event = { hours = 2 id = germany.4 }
		}
		custom_effect_tooltip = GAME_OVER_TT
	}
}

# Austria refuses Anschluss
country_event = {
	id = germany.29
	title = germany.29.t
	desc = germany.29.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = {
		name = germany.29.a
		add_state_claim = 4
		add_state_claim = 152
		add_state_claim = 153
		create_wargoal = {
			type = take_state_focus
			target = AUS
			generator = { 4 152 153 }
		}
	}
}

### Munich Conference

# Britain
country_event = {
	id = germany.40
	title = germany.40.t
	desc = {
		text = germany.40.d
		trigger = { NOT = { has_war_with = GER } }
	}
	desc = {
		text = germany.40.d_2
		trigger = { has_war_with = GER }
	}
	desc = {
		text = germany.40.d_3
		trigger = {
			NOT = { has_war_with = GER }
			tag = HOL
		}
	}
	picture = GFX_report_event_german_politician_speech

	is_triggered_only = yes

	option = { # Abandon the Czechs
		name = germany.40.a
		ai_chance = {
			factor = 90
		}
		trigger = {
			NOT = { has_war_with = GER }
			is_puppet = no # can't do anything if puppet
		}
		if = {
			limit = {
				tag = HOL
			}
			ENG = { country_event = germany.40 }
		}
		if = {
			limit = {
				tag = ENG
			}
			FRA = { country_event = germany.41 }
		}
		CZE = {
			add_opinion_modifier = { target = ROOT modifier = western_betrayal }
		}
		if = {
			limit = {
				tag = HOL
				CZE = { is_guaranteed_by = HOL }
			}
			HOL = {
				diplomatic_relation = {
   					country = CZE
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "CZE"
					value = -100
				}
			}
		}
		if = {
			limit = {
				tag = ENG
				CZE = { is_guaranteed_by = ENG }
			}
			ENG = {
				diplomatic_relation = {
   					country = CZE
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "CZE"
					value = -100
				}
			}
		}
		if = {
			limit = {
				CZE = { is_in_faction_with = ROOT }
				is_faction_leader = yes
			}
			remove_from_faction = CZE
		}
	}
}

# France (Britain Backs Down)
country_event = {
	id = germany.41
	title = germany.40.t
	desc = germany.41.d
	picture = GFX_report_event_chamberlain_announce

	is_triggered_only = yes

	option = { # Follow Britain's lead
		name = germany.41.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0
				is_in_faction_with = CZE
			}
			modifier = {
				factor = 0.3
				has_government = communism
				CZE = { has_government = communism }
			}
			modifier = {
				has_global_flag = GER_has_started_war
				factor = 0
			}
		}
		CZE = {
			country_event = germany.46
			add_opinion_modifier = { target = FRA modifier = western_betrayal }
		}
		if = {
			limit = {
				is_in_faction_with = CZE
				is_faction_leader = yes
			}
			if = {
				limit = {
					NOT = {
						any_other_country = { #check if CZE and FRA are the only countries in this faction
							NOT = { original_tag = CZE }
							is_in_faction_with = ROOT
						}
					}
				}
				dismantle_faction = yes
			}
		}
		if = {
			limit = {
				is_in_faction_with = CZE
				is_faction_leader = no
			}
			random_other_country = {
				limit = {
					is_in_faction_with = FRA
					is_faction_leader = yes
				}
				remove_from_faction = FRA
			}
		}
		if = {
			limit = {
				CZE = { is_guaranteed_by = FRA }
			}
			FRA = {
				diplomatic_relation = {
   					country = CZE
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "CZE"
					value = -100
				}
			}
		}
		if = {
			limit = {
				YUG = { is_guaranteed_by = FRA }
			}
			FRA = {
				diplomatic_relation = {
   					country = YUG
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "YUG"
					value = -100
				}
			}
			YUG = {
				add_opinion_modifier = { target = FRA modifier = western_betrayal }
			}
		}
	}
}

# France (Britain Supports the Czechs)
country_event = {
	id = germany.42
	title = germany.40.t
	desc = germany.42.d
	picture = GFX_report_event_czech_soldiers_01

	is_triggered_only = yes

	#Support
	option = {
		name = germany.42.a
		trigger = {
			is_subject = no
		}
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0
				is_in_faction_with = GER
			}
		}
		if = {
			limit = {
				is_in_faction = yes
				NOT = { is_in_faction_with = ENG }
				NOT = { is_in_faction_with = CZE }
				NOT = { has_guaranteed = CZE }
			}
			give_guarantee = CZE
		}
		if = {
			limit = {
				is_in_faction = no
			}
			ENG = { add_to_faction = FRA }
			add_ai_strategy = {
				type = alliance
				id = "ENG"
				value = 200
			}
		}
		add_opinion_modifier = { target = GER modifier = condemn_aggression }
		CZE = {
			country_event = germany.44
			add_opinion_modifier = { target = FRA modifier = offered_support }
		}
		GER = {
			country_event = germany.47
			effect_tooltip = {
				create_wargoal = {
					type = take_state_focus
					target = CZE
					generator = { 69 }
				}
			}
		}
	}

	#Abandon
	option = {
		name = germany.42.b
		trigger = {
			NOT = { is_in_faction_with = ENG }
			NOT = { is_in_faction_with = CZE }
		}
		ai_chance = {
			factor = 10
			modifier = {
				has_global_flag = GER_has_started_war
				NOT = { is_in_faction_with = GER } #FRA doesn't care if in faction
				factor = 0
			}
		}
		if = {
			limit = {
				CZE = { is_guaranteed_by = FRA }
			}
			FRA = {
				diplomatic_relation = {
   					country = CZE
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "CZE"
					value = -100
				}
			}
		}
		if = {
			limit = {
				YUG = { is_guaranteed_by = FRA }
			}
			FRA = {
				diplomatic_relation = {
   					country = YUG
   					relation = guarantee
   					active = no
  				}
  				add_ai_strategy = {
					type = protect
					id = "YUG"
					value = -100
				}
			}
			YUG = {
				add_opinion_modifier = { target = FRA modifier = western_betrayal }
			}
		}
		CZE = {
			country_event = germany.44
			add_opinion_modifier = { target = FRA modifier = western_betrayal }
		}
		GER = {
			country_event = germany.47
			effect_tooltip = {
				create_wargoal = {
					type = take_state_focus
					target = CZE
					generator = { 69 }
				}
			}
		}
	}
}

# France leaves the Allies
country_event = {
	id = germany.43
	title = germany.43.t
	desc = germany.43.d
	picture = GFX_report_event_french_british_officers

	is_triggered_only = yes

	option = {
		name = germany.43.a
		FRA = {
			add_opinion_modifier = { target = ENG modifier = abandoned_czechs }
		}
	}
}

# Czechoslovakia (British and (possibly) French Support)
country_event = {
	id = germany.44
	title = germany.40.t
	desc = germany.44.d
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.44.a
		effect_tooltip = {
			GER = {
				create_wargoal = {
					type = take_state_focus
					target = CZE
					generator = { 69 }
				}
			}
		}
	}
}

# Czechoslovakia (French Support)
country_event = {
	id = germany.45
	title = germany.40.t
	desc = germany.45.d
	picture = GFX_report_event_chamberlain_announce

	is_triggered_only = yes

	option = {
		name = germany.45.a
		effect_tooltip = {
			GER = {
				create_wargoal = {
					type = take_state_focus
					target = CZE
					generator = { 69 }
				}
			}
		}
	}
}

# Czechoslovakia (Abandoned)
country_event = {
	id = germany.46
	title = germany.46.t
	desc = germany.46.d
	picture = GFX_report_event_czech_soldiers_01

	is_triggered_only = yes

	option = { # Surrender the Sudetenland
		name = germany.46.a
		ai_chance = {
			factor = 90
			modifier = { # Decrease chance CZE resists if AUS isn't taken first
				AUS = { exists = yes }
				factor = 0.5
			}
			modifier = { # If they stand a chance they will fight
				factor = 0
				strength_ratio = {
					tag = GER
					ratio > 0.75
				}
				NOT = {
					any_neighbor_country = {
						NOT = { tag = GER }
						is_in_faction_with = GER
					}
				}
			}
			modifier = {
				factor = 0 #if you lead a faction, fight
				is_faction_leader = yes
			}
			modifier = {
				factor = 0.5 #if you are in a faction, maybe fight
				is_faction_leader = no
				is_in_faction = yes
			}
			modifier = {
				factor = 0.05 #if you are in a faction with a major, probably fight
				is_faction_leader = no
				is_in_faction = yes
				any_allied_country = {
					is_major = yes
				}
			}
			modifier = {
				factor = 0
				is_puppet = yes
				NOT = { is_puppet_of = GER } #puppeted CZE wouldn't surrender Sudetenland otherwise
			}
			modifier = { # Increase it again if other bordering nations are in Axis
				any_neighbor_country = {
					NOT = { tag = GER }
					is_in_faction_with = GER
				}
				factor = 2.0
			}
		}
		GER = { country_event = germany.50 }
	}
}

# Germany (British and (possibly) French Support for Czechoslovakia)
country_event = {
	id = germany.47
	title = germany.40.t
	desc = germany.47.d
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.47.a
		create_wargoal = {
			type = take_state_focus
			target = CZE
			generator = { 69 74 }
		}
		add_state_claim = 69
		add_state_claim = 74
		hidden_effect = {
			news_event = { hours = 6 id = news.57 }
		}
		set_country_flag = allies_support_czechs
	}
}

# Germany (French Support for Czechoslovakia)
country_event = {
	id = germany.48
	title = germany.40.t
	desc = germany.48.d
	picture = GFX_report_event_chamberlain_announce

	is_triggered_only = yes

	option = {
		name = germany.48.a
		create_wargoal = {
			type = take_state_focus
			target = CZE
			generator = { 69 74 }
		}
		add_state_claim = 69
		add_state_claim = 74
		hidden_effect = {
			country_event = { hours = 6 id = news.58 }
		}
	}
}

# Germany (Czechoslovakia Refuses Demands)
country_event = {
	id = germany.49
	title = germany.40.t
	desc = germany.49.d
	picture = GFX_report_event_czech_soldiers_02

	is_triggered_only = yes

	option = {
		name = germany.49.a
		create_wargoal = {
			type = take_state_focus
			target = CZE
			generator = { 69 74 }
		}
		add_state_claim = 69
		add_state_claim = 74
		if = {
			limit = {
				CZE = {
					is_in_faction_with = GER
				}
			}
			GER = { remove_from_faction = CZE }
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.59 }
		}
	}
}

# Germany (Czechoslovakia Surrenders Sudetenland)
country_event = {
	id = germany.50
	title = germany.40.t
	desc = germany.50.d
	picture = GFX_report_event_german_politician_speech

	is_triggered_only = yes

	option = {
		name = germany.50.a
		69 = { add_core_of = GER }
		GER = { transfer_state = 69 }
		74 = { add_core_of = GER }
		GER = { transfer_state = 74 }
		set_country_flag = sudetenland_acquired
		add_war_support = 0.1
		add_stability = 0.05
		play_peace_in_our_time_effect = yes
		USA = {
			set_country_flag = { flag = USA_munich_window days = 60 value = 1 }
		}
		if = {
			limit = {
				88 = { is_owned_by = POL }
			}
			POL = {
				country_event = { hours = 6 id = germany.52 }
			}
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.56 }
			if = {
				limit = {
					has_dlc = "Death or Dishonor"
					country_exists = YUG
					YUG = { has_war = no }
					ENG = { NOT = { has_war_with = YUG } }
					ENG = { has_government = democratic }
				}
				ENG = {
					country_event = {
						id = DOD_yugoslavia.42
						days = 3
					}
				}
			}
		}
	}
}

# Hungary (First Vienna Award)
country_event = {
	id = germany.51
	title = germany.51.t
	desc = germany.51.d
	picture = GFX_report_event_vienna_award_negotiations

	is_triggered_only = yes

	option = {
		name = germany.51.a
		HUN = { transfer_state = 664 }
	}
}

# Poland (Zaolzie)
country_event = {
	id = germany.52
	title = germany.52.t
	desc = germany.52.d
	picture = GFX_report_event_polish_tanks_01

	is_triggered_only = yes

	option = {
		name = germany.52.a
		72 = { add_core_of = POL }
		POL = { transfer_state = 72 }
	}
}

# Czechoslovakia (The Fate of Czechoslovakia)
country_event = {
	id = germany.53
	title = germany.53.t
	desc = germany.53.d
	picture = GFX_report_event_german_politician_speech

	is_triggered_only = yes

	option = { # Agree
		name = germany.53.a
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					is_in_faction_with = ENG
					is_in_faction_with = FRA
					is_puppet = yes
					GER = {
						AND = {
							has_war_with = ENG
							has_war_with = FRA
						}
					}
					GER = {
						AND = {
							has_war_with = SOV
							OR = {
								has_war_with = ENG
								has_war_with = FRA
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.5
				GER = {
					OR = {
						AND = {
							has_war_with = ENG
							NOT = {
								has_war_with = FRA
							}
						}
						AND = {
							has_war_with = FRA
							NOT = {
								has_war_with = ENG
							}
						}
					}
				}
			}
		}
		GER = { country_event = germany.55 }
		if = {
			limit = {
				ENG = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			ENG = {
				add_war_support = 0.1
			}
		}
		if = {
			limit = {
				FRA = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			FRA = {
				add_war_support = 0.1
			}
		}
		if = {
			limit = {
				has_DLC = "Death or Dishonor"
				country_exists = YUG
				YUG = { has_war = no }
			}
			GER = {
				country_event = {
					id = DOD_yugoslavia.32
					hours = 6
				}
			}
		}
		custom_effect_tooltip = GAME_OVER_TT
	}
}

# The Czechs Resist
country_event = {
	id = germany.54
	title = germany.54.t
	desc = germany.54.d
	picture = GFX_report_event_czech_soldiers_01

	is_triggered_only = yes

	option = {
		name = germany.54.a
		if = {
			limit = {
				75 = {
					is_owned_and_controlled_by = CZE
				}
			}
			add_state_claim = 75
		}
		if = {
			limit = {
				9 = {
					is_owned_and_controlled_by = CZE
				}
			}
			add_state_claim = 9
		}
		create_wargoal = {
			type = annex_everything
			target = CZE
		}
	}
}

# The Fate of Czechoslovakia
country_event = {
	id = germany.55
	title = germany.53.t
	desc = {
		text = germany.55.d
		trigger = { has_global_flag = end_of_czechoslovakia }
	}
	desc = {
		text = germany.55.d_2
		trigger = { NOT = { has_global_flag = end_of_czechoslovakia } }
	}
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.55.b
		add_political_power = -20
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		trigger = {
			always = yes
		}
		HUN = { country_event = germany.56 }
		add_war_support = 0.1
		if = {
			limit = {
				72 = {
					OR = {
						is_owned_by = CZE
						is_owned_by = GER
					}
				}
				country_exists = POL
			}
			POL = { transfer_state = 72 } # Give Poland Zaolzie
		}
		custom_effect_tooltip = end_of_czechoslovakia_mefo_bills_tt
		add_to_variable = { var = GER_mefo_bill_counter value = -5 }
		GER_mefo_bills_level_down = yes
	}

	option = {
		name = germany.55.do
		trigger = {
			has_global_flag = GER_HUN_CZE_split #promised Hungary Slovakia in earlier event
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				is_in_faction_with = HUN
			}
		}
		HUN = { country_event = DOD_hungary.101 }
		add_war_support = 0.1
		custom_effect_tooltip = end_of_czechoslovakia_mefo_bills_tt
		add_to_variable = { var = GER_mefo_bill_counter value = -5 }
		GER_mefo_bills_level_down = yes
	}
}

# Hungary asked to partition Czechoslovakia
country_event = {
	id = germany.56
	title = germany.56.t
	desc = {
		text = germany.56.d
		trigger = { has_global_flag = end_of_czechoslovakia }
	}
	desc = {
		text = germany.56.d_2
		trigger = { NOT = { has_global_flag = end_of_czechoslovakia } }
	}
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.56.a
		ai_chance = { factor = 100 }
		transfer_state = 70
		transfer_state = 71
		transfer_state = 73
		hidden_effect = {
			GER = {
				annex_country = { target = CZE }
				add_to_faction = HUN
			}
			HUN = {
				add_ai_strategy = {
					type = alliance
					id = "GER"
					value = 200
				}
			}
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.61 }
		}
	}
}

# Hungary refuses partition!
country_event = {
	id = germany.57
	title = germany.57.t
	desc = germany.57.d
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.57.a
		add_political_power = -20
		ai_chance = { factor = 60 }
		if = {
			limit = {
				154 = { is_owned_by = HUN }
				73 = {
					OR = {
						is_owned_by = CZE
						is_owned_by = GER
					}
				}
			}
			HUN = { transfer_state = 73 }
		}
		if = {
			limit = {
				72 = {
					OR = {
						is_owned_by = CZE
						is_owned_by = GER
					}
				}
			}
			POL = { transfer_state = 72 } # Give Poland Zaolzie
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.60 }
		}
	}
	option = {
		name = germany.57.b
		add_political_power = -40
		ai_chance = { factor = 40 }
		if = {
			limit = { country_exists = CZE }
			annex_country = { target = CZE }
		}
		hidden_effect = {
			country_event = { hours = 6 id = news.62 }
		}
	}
}

# Polish Question Completed
country_event = {
	id = germany.58
	title = germany.58.t
	desc = germany.58.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = {
		name = germany.58.a
		add_political_power = 150
	}

}

### Remilitarization of the Rhineland

# French Response
country_event = {
	id = germany.60
	title = germany.60.t
	desc = germany.60.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = { # Diplomatic response
		name = germany.60.b
		ai_chance = {
			factor = 99
			modifier = {
				has_global_flag = GER_has_started_war
				factor = 0
			}
		}
		ENG = { country_event = germany.62 }
		add_opinion_modifier = { target = GER modifier = protest_action }
	}
}

# British Response (French Press for War)
country_event = {
	id = germany.61
	title = germany.60.t
	desc = germany.61.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = { # War out of the question
		name = germany.61.a
		ai_chance = {
			factor = 90
		}
		FRA = {
			country_event = { hours = 6 id = germany.63 }
		}
	}
}

# British Response (French Want Peace)
country_event = {
	id = germany.62
	title = germany.60.t
	desc = germany.62.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = {
		name = germany.62.a
		hidden_effect = {
			news_event = { hours = 6 id = news.25 }
		}
		add_opinion_modifier = { target = GER modifier = protest_action }
		GER = {
			add_war_support = 0.1
		}
	}
}

# France (Britain Refuses Support)
country_event = {
	id = germany.63
	title = germany.63.t
	desc = germany.63.d
	picture = GFX_report_event_chamberlain_announce

	is_triggered_only = yes

	option = { # Back Down
		name = germany.63.b
		ai_chance = { factor = 40 }
		ENG = { country_event = germany.67 }
		add_opinion_modifier = { target = GER modifier = protest_action }
	}
}

# France (Britain Gives Support)
country_event = {
	id = germany.64
	title = germany.64.t
	desc = germany.64.d
	picture = GFX_report_event_british_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.64.a
		GER = { country_event = germany.65 }
		if = {
			limit = {
				has_idea = FRA_disjointed_government
				NOT = { has_government = communism }
			}
			custom_effect_tooltip = germany.60.a.tt
			effect_tooltip = {
				start_civil_war = {
					ideology = communism
					size = 0.2
				}
			}
		}
		if = {
			limit = {
				has_idea = FRA_disjointed_government
				has_government = communism
			}
			custom_effect_tooltip = germany.60.a.tt
			effect_tooltip = {
				start_civil_war = {
					ideology = democratic
					size = 0.3
				}
			}
		}
	}
}

# Germany (France and Britain go to war)
country_event = {
	id = germany.65
	title = germany.65.t
	desc = germany.65.d
	picture = GFX_report_event_british_artillery

	is_triggered_only = yes

	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				strength_ratio = {
					tag = FRA
					ratio < 1
				}
				strength_ratio = {
					tag = ENG
					ratio < 1
				}
			}
		}
		name = germany.65.a
		FRA = {
			declare_war_on = {
				target = GER
				type = take_state_focus
				generator = { 42 51 }
			}
			country_event = germany.92
			if = {
				limit = {
					has_idea = FRA_disjointed_government
					NOT = { has_government = communism }
				}
				start_civil_war = {
					ideology = communism
					size = 0.2
				}
			}
			if = {
				limit = {
					has_idea = FRA_disjointed_government
					has_government = communism
				}
				start_civil_war = {
					ideology = democratic
					size = 0.3
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.26 }
		}
	}
	option = {
		name = germany.65.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				strength_ratio = {
					tag = FRA
					ratio > 1
				}
				strength_ratio = {
					tag = ENG
					ratio > 1
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.151 }
		}
		set_country_flag = GER_rhineland_backed_down
		42 = { set_demilitarized_zone = yes }
		51 = { set_demilitarized_zone = yes }
		add_timed_idea = {
			idea = rhineland_challenge_met
			days = 183
		}
	}
}

# Germany (France goes to war)
country_event = {
	id = germany.66
	title = germany.66.t
	desc = germany.66.d
	picture = GFX_report_event_degaulle_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.65.a
		add_war_support = 0.1 #original German clay
		ENG = {
			country_event = germany.68
			if = {
				limit = {
					ENG = {
						is_in_faction_with = FRA
						is_faction_leader = yes
					}
				}
				remove_from_faction = FRA
			}
		}
		FRA = {
			declare_war_on = {
				target = GER
				type = take_state_focus
				generator = { 42 51 }
			}
			country_event = germany.92
			if = {
				limit = {
					has_idea = FRA_disjointed_government
					NOT = { has_government = communism }
				}
				start_civil_war = {
					ideology = communism
					size = 0.2
				}
			}
			if = {
				limit = {
					has_idea = FRA_disjointed_government
					has_government = communism
				}
				start_civil_war = {
					ideology = democratic
					size = 0.3
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.27 }
		}
	}

	option = {
		name = germany.65.b
		hidden_effect = {
			news_event = { hours = 6 id = news.152 }
		}
		set_country_flag = GER_rhineland_backed_down
		add_war_support = -0.2 #That was scary for a moment there!
		42 = { set_demilitarized_zone = yes }
		51 = { set_demilitarized_zone = yes }
		add_timed_idea = {
			idea = rhineland_challenge_met
			days = 183
		}
	}
}

# Britain (France Backs Down)
country_event = {
	id = germany.67
	title = germany.67.t
	desc = germany.67.d
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.67.a
		hidden_effect = {
			news_event = { hours = 6 id = news.25 }
		}
		add_opinion_modifier = { target = GER modifier = protest_action }
		GER = {
			add_war_support = 0.1
		}
	}
}

# Britain (France Goes Ahead Anyway)
country_event = {
	id = germany.68
	title = germany.68.t
	desc = germany.68.d
	picture = GFX_report_event_french_liberation

	is_triggered_only = yes

	option = {
		name = germany.68.a
	}
}

### Oster Conspiracy

# Conspiracy Begins!
country_event = {
	id = germany.70
	title = germany.70.t
	desc = germany.70.d
	picture = GFX_report_event_german_reichstag_gathering

	fire_only_once = yes

	trigger = {
		has_country_leader = { name = "Adolf Hitler" }
		tag = GER
		AND = {
			CZE = { has_capitulated = no }
			country_exists = CZE # Should only trigger if CZE hasn't fallen
		}
		has_war_with = CZE
		has_war_with = FRA
		has_war_with = ENG
		has_country_flag = allies_support_czechs
	}


	option = {
		name = germany.70.a
		add_stability = -0.2
		hidden_effect = {
			if = {
				limit = { NOT = { any_war_score < 39 } }
				random_list = {
					20 = { country_event = { hours = 6 id = germany.71 } } # Conspiracy defeated, but Hitler dead
					75 = { country_event = { hours = 6 id = germany.72 } } # Conspiracy defeated, Hitler survives
					5 = { country_event = { hours = 6 id = germany.73 } } # Conspiracy successful, Civil War
				}
			}
			if = {
				limit = { any_war_score < 39 }
				random_list = {
					33 = { country_event = { hours = 6 id = germany.71 } } # Conspiracy defeated, but Hitler dead
					33 = { country_event = { hours = 6 id = germany.72 } } # Conspiracy defeated, Hitler survives
					33 = { country_event = { hours = 6 id = germany.73 } } # Conspiracy successful, Civil War
				}
			}
		}
	}
}

# Conspiracy defeated, but Hitler is dead
country_event = {
	id = germany.71
	title = germany.71.t
	desc = germany.71.d
	picture = GFX_report_event_europe_funeral

	is_triggered_only = yes

	option = { # Himmler
		name = germany.71.a
		# Himmler becomes the new Fascist leader of Germany
		kill_country_leader = yes
		add_stability = 0.05
		GER_heinrich_himmler = {
			add_country_leader_role = {
				promote_leader = yes
				country_leader = {
					ideology = nazism
					expire = "1965.1.1.1"
					traits = {}
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.28 }
		}
	}
	option = { # Göring
		name = germany.71.b
		# Göring becomes the new Fascist leader of Germany
		kill_country_leader = yes
		add_stability = 0.1
		GER_hermann_goring = {
			add_country_leader_role = {
				promote_leader = yes
				country_leader = {
					ideology = nazism
					expire = "1965.1.1.1"
					traits = {}
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.29 }
		}
	}
}

# Conspiracy defeated, Hitler survives
country_event = {
	id = germany.72
	title = germany.72.t
	desc = germany.72.d
	picture = GFX_report_event_hitler_parade

	is_triggered_only = yes

	option = {
		name = germany.72.a
		add_stability = 0.25
		hidden_effect = {
			news_event = { hours = 6 id = news.30 }
		}
	}
}

# Conspiracy successful, Civil War begins
country_event = {
	id = germany.73
	title = germany.73.t
	desc = germany.73.d
	picture = GFX_report_event_german_reichstag_bombed

	is_triggered_only = yes

	option = { # Side with the Rebels
		name = germany.73.a
		trigger = { is_ai = no }
		set_country_flag = german_rebels
		kill_country_leader = yes
		if = {
			limit =  {
				OR = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ruling_party = democratic
				ideology = fascism
				size = 0.5
			}
		}
		if = {
			limit =  {
				NOT = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ruling_party = democratic
				ideology = fascism
				size = 0.7
			}
		}
		GER_heinrich_himmler = {
			add_country_leader_role = {
				promote_leader = yes
				country_leader = {
					ideology = nazism
					expire = "1965.1.1.1"
					traits = {}
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.31 }
		}
	}
	option = { # Side with Himmler
		name = germany.73.b
		# Himmler becomes the new Fascist leader of Germany
		kill_country_leader = yes
		GER_heinrich_himmler = {
			add_country_leader_role = {
				promote_leader = yes
				country_leader = {
					ideology = nazism
					expire = "1965.1.1.1"
					traits = {}
				}
			}
		}
		if = {
			limit =  {
				OR = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ideology = democratic
				size = 0.5
			}
		}
		if = {
			limit =  {
				NOT = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ideology = democratic
				size = 0.3
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.31 }
		}
	}
	option = { # Side with Göring
		name = germany.73.c
		# Göring becomes the new Fascist leader of Germany
		kill_country_leader = yes
		GER_hermann_goring = {
			add_country_leader_role = {
				promote_leader = yes
				country_leader = {
					ideology = nazism
					expire = "1965.1.1.1"
					traits = {}
				}
			}
		}
		if = {
			limit =  {
				OR = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ideology = democratic
				size = 0.5
			}
		}
		if = {
			limit =  {
				NOT = {
					any_war_score < 39
					has_stability < 60
				}
			}
			start_civil_war = {
				ideology = democratic
				size = 0.3
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.31 }
		}
	}
}

# Anschluss Preparations
country_event = {
	id = germany.74
	title = germany.74.t
	desc = germany.74.d
	picture = GFX_report_event_fascist_speech

	is_triggered_only = yes

	option = {
		name = germany.74.a
		#add_ideas = elyesa_bazna
	}
}

# German-Soviet Treaty (Soviets)
country_event = {
	id = germany.75
	title = germany.75.t
	desc = germany.75.d
	picture = GFX_report_event_physics_lab_01

	is_triggered_only = yes

	option = {
		name = germany.75.a	#sounds good
		GER = {
			country_event = { days = 1 id = germany.76 }
			add_opinion_modifier = {
				target = ROOT
				modifier = sov_ger_treaty
			}
			add_opinion_modifier = {
				target = ROOT
				modifier = sov_ger_treaty_trade
			}
		}
		# REVISIT Balance research bonus
		give_SOV_armor_research_bonuses = yes
	}

	option = {
		name = germany.75.b	#no way
		add_timed_idea = { idea = SOV_scientist_defect days = 365 }
		ai_chance = { factor = 0 }
		trigger = {
			always = no
		}
		add_political_power = -10
		add_opinion_modifier = { target = GER modifier = refused_MR_pact }# no pact
		GER = {
			country_event = { days = 1 id = germany.77 }
		}
	}
}

# Soviets Accept German-Soviet Treaty
country_event = {
	id = germany.76
	title = germany.76.t
	desc = germany.76.d
	picture = GFX_report_event_physics_lab_02

	is_triggered_only = yes

	option = {
		name = germany.76.a	#bah
		# REVISIT Balance research bonus
		if = {
			limit = {
				NOT = {
					has_dlc = "No Step Back"
				}
			}
			add_tech_bonus = {
				name = med_armor_bonus
				ahead_reduction = 1
				category = cat_medium_armor
			}
			add_tech_bonus = {
				name = armor_bonus
				bonus = 1.0
				uses = 2
				category = armor
			}
		}
		else = { #NO STEP BACK EFFECTS
			add_tech_bonus = {
				name = armor_bonus
				bonus = 1.0
				uses = 2
				category = armor
			}
			if = {
				limit = {
					has_tech = basic_medium_tank_chassis
				}
				create_equipment_variant = {
					name = "Panzer III Ausf. A"
					type = medium_tank_chassis_1
					parent_version = 0
					modules = {
						main_armament_slot = tank_high_velocity_cannon
						turret_type_slot = tank_medium_three_man_tank_turret
						suspension_type_slot = tank_bogie_suspension
						armor_type_slot = tank_welded_armor
						engine_type_slot = tank_gasoline_engine
						special_type_slot_1 = tank_radio_1
						special_type_slot_2 = smoke_launchers
					}
					upgrades = {
						tank_nsb_engine_upgrade = 6
						tank_nsb_armor_upgrade = 3
					}
					icon = "gfx/interface/technologies/ger_basic_main_tank.dds"
				}
				create_equipment_variant = {
					name = "Panzer IV Ausf. A"
					type = medium_tank_chassis_1
					parent_version = 1
					modules = {
						main_armament_slot = tank_close_support_gun
						turret_type_slot = tank_medium_three_man_tank_turret
						suspension_type_slot = tank_bogie_suspension
						armor_type_slot = tank_welded_armor
						engine_type_slot = tank_gasoline_engine
						special_type_slot_1 = tank_radio_1
						special_type_slot_2 = smoke_launchers
					}
					upgrades = {
						tank_nsb_engine_upgrade = 6
						tank_nsb_armor_upgrade = 2
					}
					icon = "gfx/interface/technologies/ger_basic_main_tank.dds"
				}
			}
		}
		SOV = {
			add_opinion_modifier = { target = GER modifier = sov_ger_treaty }
			add_opinion_modifier = { target = GER modifier = sov_ger_treaty_trade }
		}
		###
		#if = {
		#	limit = {
		#		has_game_rule = {
		#			rule = HMM_GER_ARTILLERY
		#			option = HMM_GER_ARTILLERY_TREATY
		#		}
		#	}
		#	add_tech_bonus = {
		#		name = artillery_bonus
		#		bonus = 1.0
		#		uses = 2
		#		technology = antiair4
		#		technology = antiair5
		#		#
		#		technology = artillery4
		#		technology = artillery5
		#		#
		#		technology = antitank4
		#		technology = antitank5
		#	}
		#}
	}
}

# Soviets Reject German-Soviet Treaty
country_event = {
	id = germany.77
	title = germany.77.t
	desc = germany.77.d
	picture = GFX_report_event_physics_lab_02

	is_triggered_only = yes

	option = {
		name = germany.77.a
		#add_opinion_modifier = { target = SOV modifier = refused_MR_pact }# no pact
	}
}

# German Joint Air Research
country_event = {
	id = germany.78
	title = germany.78.t
	desc = germany.78.d
	picture = GFX_report_event_radar_01

	is_triggered_only = yes

	option = {
		name = germany.78.a
		add_ideas = GER_air_innovations_2_idea
		add_tech_bonus = {
				name = radar_tech_bonus
				bonus = 1.0
				uses = 1
				category = radar_tech
			}
	}
}

# Anti-Soviet Pact
country_event = {
	id = germany.83
	title = germany.83.t
	desc = germany.83.d
	picture = GFX_report_event_japan_europe_pact

	is_triggered_only = yes

	option = {
		ai_chance = {
			factor = 10
		}
		name = germany.83.a		#join
		add_ideas = anti_soviet_pact
		SOV = {
			remove_opinion_modifier = { target = ROOT modifier = pact_against_us }
			add_opinion_modifier = { target = ROOT modifier = worse_pact_against_us }
		}
	}

	option = {
		name = germany.83.b		#refuse
		trigger = { NOT = { is_puppet_of = GER } }
		ai_chance = {
			factor = 2
		}
	}
}

# Call Pact Members to War (Instigator)
country_event = {
	id = germany.84
	title = germany.84.t
	desc = germany.84.d
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes

	#immediate = {
	#	remove_ideas = anti_soviet_pact
	#}

	option = {
		name = germany.84.a
		every_other_country = {
			limit = {
				has_idea = anti_soviet_pact
				NOT = { has_war_with = SOV }
				is_subject = no
				any_other_country = {
					has_idea = anti_soviet_pact
					has_war_with = SOV
				}
			}
			country_event = { id = germany.85 days = 1 }
		}
		hidden_effect = {
			if = {
				limit = {
					original_tag = GER
					has_government = neutrality
				}
				country_event = { id = germany.127 days = 7 random_days = 7 }
			}
		}
	}
}

# [From.GetName] Calls Pact Members to War
country_event = {
	id = germany.85
	title = germany.85.t
	
	desc = {
		text = germany.85.desc.b
	}
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes

	#immediate = {
	#	remove_ideas = anti_soviet_pact
	#}

	option = {
		name = germany.85.a
		ai_chance = {
			factor = 10
		}
		add_to_war = {
			targeted_alliance = FROM
			enemy = SOV
			hostility_reason = ally
		}
		hidden_effect = {
			if = {
				limit = {
					original_tag = GER
				}
				country_event = { id = germany.127 days = 7 random_days = 7 }
			}
		}
	}

	option = {
		name = germany.85.b
		trigger = {
			NOT = { FROM = { original_tag = POL } }
			NOT = { original_tag = GER }
		}
		ai_chance = {
			factor = 0
		}
		remove_ideas = anti_soviet_pact
		FROM = { add_opinion_modifier = { target = ROOT modifier = anti_soviet_pact_call_refused } }
		SOV = { remove_opinion_modifier = { target = SOV modifier = worse_pact_against_us } }
		add_timed_idea = {
			idea = anti_soviet_pact_refused_call
			days = 365
		}
		custom_effect_tooltip = germany.85.b_tt
		hidden_effect = {
			country_event = { id = germany.112 days = 3 }
		}
	}
}

# Danzig or War (Poland)
country_event = {
	id = germany.86
	title = germany.86.t
	desc = germany.86.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	trigger = {
		NOT = { has_war_with = GER }
	}

	option = {
		name = germany.86.b
		ai_chance = {
			factor = 80
			modifier = {
				factor = 3
				strength_ratio = {
					tag = GER
					ratio > 0.7
				}
			}
			modifier = {
				factor = 10
				any_other_country = {
					is_major = yes
					is_in_faction_with = POL
				}
			}
		}
		GER = { country_event = { id = germany.88 days = 1 }
			if = {
				limit = {
					is_in_faction_with = POL
					is_faction_leader = yes
				}
				remove_from_faction = POL
			}
			if = {
				limit = {
					is_in_faction_with = POL
					is_faction_leader = no
				}
				random_other_country = {
					limit = {
						is_in_faction_with = GER
						is_faction_leader = yes
					}
					remove_from_faction = GER
				}
			}
		}
		hidden_effect = {
			news_event = { hours = 1 id = news.204 }
		}
		effect_tooltip = {
			GER = {
				declare_war_on = {
					target = POL
					type = take_state
					generator = { 85 }
				}
			}
		}
	}
}

# Poland Cedes Danzig (Danzig or War)
country_event = {
	id = germany.87
	title = germany.87.t
	desc = germany.87.d
	picture = GFX_report_event_german_polish_border

	is_triggered_only = yes

	option = {
		name = germany.87.a
		transfer_state = 85
		transfer_state = 318
		add_state_core = 318
		remove_state_claim = 86
		if = {
			limit = {
				ENG = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			ENG = {
				add_war_support = -0.1 #dodged a bullet there
			}
		}
		if = {
			limit = {
				FRA = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			FRA = {
				add_war_support = -0.1 #dodged a bullet there
			}
		}
	}
}

# Poland Refuses to Cede Danzig (Danzig or War)
country_event = {
	id = germany.88
	title = germany.88.t
	desc = germany.88.d
	picture = GFX_report_event_polish_tanks_02

	is_triggered_only = yes

	option = {
		name = germany.88.a
		if = {
			limit = {
				POL = {
					is_subject = yes
					OVERLORD = {
						has_non_aggression_pact_with = GER
					}
				}
			}
			POL = {
				OVERLORD = {
					diplomatic_relation = {
						country = GER
						relation = non_aggression_pact
						active = no
					}
				}
			}
		}
		if = {
			limit = {
				POL = {
					has_non_aggression_pact_with = GER
				}
			}
			POL = {
				diplomatic_relation = {
					country = GER
					relation = non_aggression_pact
					active = no
				}
			}
			every_other_country = {
				limit = {
					has_non_aggression_pact_with = GER
				}
				add_opinion_modifier = {
					target = GER
   					modifier = protest_action_strong
				}
			}
		}
		create_wargoal = {
			type = take_state
			generator = { 85 318 }
			target = POL
		}
		add_state_core = 85
		add_state_core = 318
		if = {
			limit = {
				ENG = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			ENG = {
				add_war_support = 0.1 #just not cricket
			}
		}
		if = {
			limit = {
				FRA = {
					NOT = {
						is_in_faction_with = GER
					}
				}
			}
			FRA = {
				add_war_support = 0.1
			}
		}
		if = {
			limit = {
				CZE = {
					exists = yes
					is_subject = no
					has_government = democratic
					NOT = { is_in_faction_with = GER }
				}
			}
			CZE = {
				add_ai_strategy = {
					type = conquer
					id = "GER"
					value = 200
				}
				add_ai_strategy = {
					type = alliance
					id = "POL"
					value = 200
				}
			}
		}
	}
}

# France national focus -  requests to join germany
country_event = {
	id = germany.91
	title = germany.91.t
	desc = germany.91.d
	picture = GFX_report_event_fascist_gathering

	is_triggered_only = yes

	option = {
		name = germany.91.a
		GER = { add_to_faction = FRA }
		FRA = {
			add_ai_strategy = {
				type = alliance
				id = "GER"
				value = 200
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.182 }
		}
	}
	option = {
		name = germany.91.b
		ai_chance = { factor = 0 }
		FRA = {
			add_opinion_modifier = {
				target = GER
				modifier = GER_FRA_join_germany_reject
			}
		}
		hidden_effect = {
			news_event = { hours = 6 id = news.183 }
		}
	}
}

# France/England (Germany Refuses Ultimatum)
country_event = {
	id = germany.92
	title = germany.92.t
	desc = germany.92.d
	picture = GFX_report_event_worried_french

	is_triggered_only = yes

	option = {
		name = germany.92.a
	}
}

# Germany (British and (possibly) French Support for Yugoslavia)
country_event = {
	id = germany.93
	title = germany.93.t
	desc = {
		text = germany.93.d
		trigger = { NOT = { has_global_flag = FRA_abandoned_yugoslavia } }
	}
	desc = {
		text = germany.93.d_FRA_abandoned_yugoslavia
		trigger = { has_global_flag = FRA_abandoned_yugoslavia }
	}
	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		name = germany.93.a
		create_wargoal = {
			type = take_state_focus
			target = YUG
			generator = { 102 }
		}
		hidden_effect = {
			news_event = { id = news.164 hours = 6 }
		}
		set_country_flag = allies_support_yugoslavia
	}
}
# Germany (Italy protects Yugoslavia)
country_event = {
	id = germany.96
	title = germany.96.t
	desc = germany.96.d
	picture = GFX_report_event_german_politician_speech

	is_triggered_only = yes

	option = {
		name = germany.96.a
		create_wargoal = {
			type = take_state_focus
			target = YUG
			generator = { 102 }
		}
		hidden_effect = {
			news_event = { id = news.167 hours = 6 }
		}
	}
}

# Germany: Carve up Greece - Give land to Italy?
country_event = {
	id = germany.99
	title = germany.99.t
	desc = germany.99.d

	picture = GFX_report_event_german_inspect_troops

	is_triggered_only = yes

	option = {
		ai_chance = { factor = 5 }
		name = germany.99.a

		ITA = { add_opinion_modifier = { target = GER modifier = GER_second_ljubljana_award_GER } }

		if = {
			limit = {
				GRE = { owns_state = 185 }
			}
			set_global_flag = GER_second_ljubljana_award_ITA_185
		}
		if = {
			limit = {
				GRE = { owns_state = 186 }
			}
			set_global_flag = GER_second_ljubljana_award_ITA_186
		}
		if = {
			limit = {
				GRE = { owns_state = 47 }
			}
			set_global_flag = GER_second_ljubljana_award_ITA_47
		}
		if = {
			limit = {
				OR = {
					has_global_flag = GER_second_ljubljana_award_BUL_done
					NOT = { has_global_flag = GER_second_ljubljana_award_BUL_event }
				}
			}
			GRE = { country_event = { id = greece.2 hours = 2 } }
		}
		set_global_flag = GER_second_ljubljana_award_ITA_done
	}

		#Don't give them anything
	option = {
		ai_chance = { factor = 0 }
		name = germany.99.b
		ITA = { add_opinion_modifier = { target = GER modifier = GER_second_ljubljana_award_noland } }
		set_global_flag = GER_second_ljubljana_award_ITA_done
	}
}

# Germany: Italy demands lands in Vichy France
country_event = {
	id = germany.104
	title = germany.104.t
	desc = { text = germany.104.d_Savoy 					trigger = { has_global_flag = ITA_claims_on_france_735 } }
	desc = { text = germany.104.d_Corsica 				trigger = { has_global_flag = ITA_claims_on_france_1 } }
	desc = { text = germany.104.d_Savoy_Corsica 	trigger = { has_global_flag = ITA_claims_on_france_735 has_global_flag = ITA_claims_on_france_1 } }


	picture = GFX_report_event_german_italian_pact

	is_triggered_only = yes

	# Italy gets 1 state Savoy
	option = {
		ai_chance = { factor = 70 }
		name = germany.104.a
		trigger = {
			has_global_flag = ITA_claims_on_france_735
			has_global_flag = ITA_claims_on_france_1
		}
		clr_global_flag = ITA_claims_on_france_1
		random_other_country = {
			limit = {
				original_tag = FRA
				has_government = fascism
			}
			country_event = france.27
		}
		ITA = { country_event = { id = italy.16 hours = 2 } }
	}

	# Italy gets 1 state Corsica
	option = {
		ai_chance = { factor = 70 }
		name = germany.104.b
		trigger = {
			NOT = { has_global_flag = ITA_claims_on_france_735 }
			has_global_flag = ITA_claims_on_france_1
		}
		random_other_country = {
			limit = {
				original_tag = FRA
				has_government = fascism
			}
			country_event = france.27
		}
		ITA = { country_event = { id = italy.15 hours = 2 } }
	}

	# Italy gets Savoy
	option = {
		ai_chance = { factor = 70 }
		name = germany.104.c
		trigger = {
			has_global_flag = ITA_claims_on_france_735
			NOT = { has_global_flag = ITA_claims_on_france_1 }
		}
		random_other_country = {
			limit = {
				original_tag = FRA
				has_government = fascism
			}
			country_event = france.27
		}
		ITA = { country_event = { id = italy.15 hours = 2 } }
	}

	# Italy gets Savoy and Corsica
	option = {
		ai_chance = { factor = 20 }
		name = germany.104.e
		trigger = {
			has_global_flag = ITA_claims_on_france_735
			has_global_flag = ITA_claims_on_france_1
		}
		random_other_country = {
			limit = {
				original_tag = FRA
				has_government = fascism
			}
			country_event = france.27
		}
		ITA = { country_event = { id = italy.15 hours = 2 } }
	}

	# Italy gets nothing
	option = {
		ai_chance = { factor = 10 }
		name = germany.104.f
		ITA = { country_event = { id = italy.14 hours = 2 } }
	}
}



# Germany: Treaty Of Craiova
country_event = {
	id = germany.106
	title = germany.106.t
	desc = { text = germany.106.d_second_vienna_accepted_all trigger = { ROM = { has_country_flag = second_vienna_accepted_all } } }
	desc = { text = germany.106.d_second_vienna_accepted_north trigger = { ROM = { has_country_flag = second_vienna_accepted_north } } }
	desc = {
		text = germany.106.d_no_vienna
		trigger = {
			ROM = {
				NOT = { has_country_flag = second_vienna_accepted_all }
				NOT = { has_country_flag = second_vienna_accepted_north }
			}
		}
	}
	picture = GFX_report_event_vienna_award_hungary

	is_triggered_only = yes

	option = { # Give Bulgaria state 77
		name = germany.106.a
		ai_chance = { factor = 95
			modifier = {
				factor = 0
				BUL = {
					is_in_faction = yes
					NOT = { is_in_faction_with = GER }
				}
			}
		}
		add_named_threat = { threat = 2 name = germany.106_threat }
		BUL = {
			add_opinion_modifier = { target = GER modifier = GER_treaty_of_craiova_GER }

			every_other_country = {
				limit = {
					is_faction_leader = yes
					NOT = { tag = GER }
				}
				reverse_add_opinion_modifier = { target = BUL modifier = GER_treaty_of_craiova_other }
			}
		}
		ROM = {
			country_event = { id = romania.5 hours = 3 }
		}
	}
	option = { # Give Bulgaria nothing
		name = germany.106.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
				NOT = {
					BUL = {
						is_in_faction = yes
						NOT = { is_in_faction_with = GER }
					}
				}
			}
		}
		BUL = {
			add_opinion_modifier = { target = GER modifier = GER_treaty_of_craiova_noland }
			country_event = { id = bulgaria.5 hours = 4 }
		}
	}
}

# Flight of Rudolf No Hindenburg
country_event = {
	id = germany.107
	title = germany.107.t
	desc = germany.107.d
	picture = GFX_report_event_airplane_crash

	is_triggered_only = yes

	immediate = {
		set_country_flag = flight_of_hess
		if = {
			limit = {
				has_idea = rudolf_hess
			}
			remove_ideas = rudolf_hess
		}
	}

	option = {
		name = germany.107.a
	}
}

# Rudolf Hess killed No Hindenburg
country_event = {
	id = germany.108
	title = germany.108.t
	desc = germany.108.d
	picture = GFX_report_event_airplane_crash

	is_triggered_only = yes

	immediate = {
		set_country_flag = flight_of_hess
		if = {
			limit = {
				has_idea = rudolf_hess
			}
			remove_ideas = rudolf_hess
		}
	}

	option = {
		name = germany.108.a
	}
}

# Flight of Rudolf Hess (Hindenburg)
country_event = {
	id = germany.109
	title = germany.107.t
	desc = germany.109.d
	picture = GFX_report_event_hindenburg_flames

	is_triggered_only = yes

	immediate = {
		set_country_flag = flight_of_hess
		if = {
			limit = {
				has_idea = rudolf_hess
			}
			remove_ideas = rudolf_hess
		}
	}

	option = {
		name = germany.108.a
	}
}

# Rudolf Hess Killed (Hindenburg)
country_event = {
	id = germany.110
	title = germany.108.t
	desc = germany.110.d
	picture = GFX_report_event_hindenburg_flames

	is_triggered_only = yes

	immediate = {
		set_country_flag = flight_of_hess
		if = {
			limit = {
				has_idea = rudolf_hess
			}
			remove_ideas = rudolf_hess
		}
	}

	option = {
		name = germany.110.a
	}
}

# Yugoslavia refuses
country_event = {
	id = germany.111
	title = germany.111.t
	desc = germany.111.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	option = {
		name = germany.111.a
		create_wargoal = {
			type = annex_everything
			target = YUG
		}
	}
}

# (Hidden)
country_event = {
	id = germany.112

	is_triggered_only = yes

	hidden = yes

	immediate = {
		every_other_country = {
			limit = { has_idea = anti_soviet_pact }
			add_opinion_modifier = { target = FROM modifier = anti_soviet_pact_call_refused }
		}
	}
}


# Danzig or War (Polish Civil War)
country_event = {
	id = germany.113
	title = germany.113.t
	desc = germany.113.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	#Demand Danzig for aid
	option = {
		name = germany.113.a
		set_country_flag = GER_POL_danzig_promised
		GER = {
			country_event = { id = germany.117 days = 1 }
		}
	}
}

#Germany expects Danzig after war
country_event = {
	id = germany.114
	title = germany.114.t
	desc = germany.114.d
	picture = GFX_report_event_polish_tanks_01

	trigger = {
		has_country_flag = GER_POL_danzig_promised
		has_civil_war = no
		owns_state = 85
		controls_state = 85
	}

	fire_only_once = yes


	immediate = {
		hidden_effect = {
			clr_country_flag = GER_POL_danzig_promised
		}
	}

	option = {
		name = germany.114.a
		ai_chance = {
			base = 1
		}
		GER = {
			country_event = { id = germany.115 days = 1 }
		}
	}

	option = {
		name = germany.114.b
		trigger = {
			NOT = {
				is_in_faction_with = GER
			}
		}
		ai_chance = {
			base = 0
		}
		GER = {
			country_event = { id = germany.116 days = 1 }
			effect_tooltip = {
				declare_war_on = {
					target = POL
					type = take_state
					generator = { 85 }
				}
			}
		}
	}
}

#Poland cedes Danzig as repayment
country_event = {
	id = germany.115
	title = germany.115.t
	desc = germany.115.d
	picture = GFX_report_event_polish_tanks_01

	is_triggered_only = yes

	option = {
		name = germany.115.a
		transfer_state = 85
		remove_state_claim = 86
	}
}


# Poland Refuses to Cede Danzig (Polish Civil War)
country_event = {
	id = germany.116
	title = germany.116.t
	desc = germany.116.d
	picture = GFX_report_event_polish_tanks_02

	is_triggered_only = yes

	option = {
		name = germany.116.a
		ai_chance = {
			base = 1
		}
		declare_war_on = {
			target = POL
			type = take_state
			generator = { 85 }
		}
	}

	option = {
		name = germany.116.b
		ai_chance = {
			base = 0
		}
	}
}


# The Promise of Danzig (Polish Civil War)
country_event = {
	id = germany.117
	title = germany.117.t
	desc = germany.117.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	# This is a German struggle
	option = {
		name = germany.117.a
	}
}


#The Yalta Conference
country_event = {
	id = germany.118
	title = germany.118.t
	desc = germany.118.d
	picture = GFX_report_event_generic_sign_treaty2

	fire_only_once = yes

	trigger = {
		#A democratic faction leader whose faction holds at least one German core state while SOV holds another can get this.
		has_war_with = GER
		GER = {
			surrender_progress > 0.5
		}
		is_faction_leader = yes
		any_state = {
			is_core_of = GER
			controller = {
				is_in_faction_with = ROOT
			}
		}
		has_government = democratic
		NOT = {
			tag = SOV
		}
		NOT = {
			has_war_with = SOV
		}
		SOV = {
			is_faction_leader = yes
		}
		any_state = {
			is_core_of = GER
			is_controlled_by = SOV
		}
		NOT = {
			has_global_flag = had_yalta_conference
		}
		NOT = {
			any_state = {
				is_core_of = GER
				controller = {
					NOT = {
						tag = GER
					}
					is_in_faction = yes
					NOT = {
						OR = {
							is_in_faction_with = ROOT
							is_in_faction_with = SOV
						}
					}
				}
			}
		}
	}


	immediate = {
		set_global_flag = had_yalta_conference
		SOV = {
			save_event_target_as = yalta_partner
		}
		ROOT = {
			save_event_target_as = yalta_origin
		}
	}

	option = {
		name = germany.118.a
		hidden_effect = {
			event_target:yalta_partner = {
				country_event = { days = 1 id = germany.119 }
			}
		}
		effect_tooltip = {
			POL = {
				add_state_core = 66
				add_state_core = 67
				add_state_core = 68
				add_state_core = 63
				add_state_core = 5
			}
		}
		event_target:yalta_partner = {
			custom_effect_tooltip = needs_approval
		}
	}

	option = {
		name = germany.118.b
		ai_chance = {
			factor = 0
		}
	}
}


#Yalta Conference Follow-up
country_event = {
	id = germany.119
	title = germany.119.t
	desc = germany.119.d
	picture = GFX_report_event_generic_sign_treaty2

	fire_only_once = yes

	is_triggered_only = yes

	option = {
		name = germany.119.a
		POL = {
			add_state_core = 66
			add_state_core = 67
			add_state_core = 68
			add_state_core = 63
			add_state_core = 5
		}
		hidden_effect = {
			news_event = { days = 1 id = news.236 }
		}
	}

	option = {
		name = germany.119.b
		ai_chance = {
			factor = 0
		}
	}
}


country_event = {
	id = germany.120
	title = germany.120.t
	desc = germany.120.d
	picture = GFX_report_event_generic_sign_treaty1

	fire_only_once = yes

	is_triggered_only = yes

	option = {
		name = germany.120.a
	}
}

country_event = {
	id = germany.121
	title = germany.121.t
	desc = germany.121.d
	picture = GFX_report_event_generic_sign_treaty2

	fire_only_once = yes

	is_triggered_only = yes

	option ={
		name = germany.121.a
		if = {
			limit = {
				country_exists = POL
			}
			#Return Polish territory + new cores if they exist
			every_state = {
				limit = {
					is_core_of = POL
					is_owned_and_controlled_by = GER
				}
				POL = {
					transfer_state = PREV
				}
			}
		}
		if = {
			limit = {
				NOT = {
					country_exists = POL
				}
			}
			#Otherwise give SOV Polish cores
			every_state = {
				limit = {
					is_core_of = POL
					is_owned_and_controlled_by = GER
				}
				SOV = {
					transfer_state = PREV
				}
			}
		}
		
		if = {
			limit = {
				any_state = {
					is_core_of = CZE
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
			}
			#Give CZE any territory that might have been taken in a war or focus ending before the one that ended with the Yalta conference.
			every_state = {
				limit = {
					is_core_of = CZE
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
				CZE = {
					transfer_state = PREV
				}
			}
		}
		if = {
			limit = {
				any_state = {
					is_core_of = YUG
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
			}
			#Give YUG any territory that might have been taken in a war or focus ending before the one that ended with the Yalta conference.
			every_state = {
				limit = {
					is_core_of = YUG
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
				YUG = {
					transfer_state = PREV
				}
			}
		}
		if = {
			limit = {
				country_exists = LIT
				any_state = {
					is_core_of = LIT
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
			}
			#Give LIT any territory that might have been taken in a war or focus ending before the one that ended with the Yalta conference.
			every_state = {
				limit = {
					is_core_of = LIT
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
				LIT = {
					transfer_state = PREV
				}
			}
		}
		if = {
			limit = {
				NOT = {
					country_exists = LIT
				}
				any_state = {
					is_core_of = LIT
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
			}
			#Give any LIT cores to SOV if they have been taken in a previous war/focus
			every_state = {
				limit = {
					is_core_of = LIT
					is_owned_and_controlled_by = GER
					NOT = {
							is_core_of = POL
					}
				}
				SOV = {
					transfer_state = PREV
				}
			}
		}
	}
}

#Events in case of weirdness with German Czechoslovakia focus
country_event = {
	id = germany.122
	title = germany.122.t
	desc = germany.122.d
	picture = GFX_report_event_german_speech

	is_triggered_only = yes

	option = {
		name = germany.122.a
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.8
				strength_ratio = { tag = GER ratio < 0.5 }
			}
			modifier = {
				factor = 0.8
				has_opinion = { target = GER value > 99 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = GER ratio < 0.3 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = GER ratio < 0.2 }
			}
			modifier = {
				factor = 0.5
				strength_ratio = { tag = GER ratio < 0.1 }
			}
		}
		if = {
			limit = {
				is_in_faction_with = GER
				is_subject = no
			}
			remove_from_faction = CZE #kicked from faction
		}

		effect_tooltip = {
			GER = {
				add_state_claim = 69
				add_state_claim = 74
				create_wargoal = {
					type = take_state_focus
					target = CZE
					generator = { 69 74 }
				}
			}
		}
		hidden_effect = {
			GER = {
				country_event = { id = germany.123 days = 1 }
			}
		}
	}

	option = {
		name = germany.122.b
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					is_guaranteed_by = POL
					is_in_faction_with = POL
				}
			}
			modifier = {
				factor = 0
				any_other_country = {
					is_major = yes
					has_guaranteed = CZE
				}
			}
			modifier = {
				factor = 0
				any_other_country = {
					is_major = yes
					is_in_faction_with = CZE
				}
			}
			modifier = {
				factor = 0.8
				any_other_country = {
					is_major = no
					has_guaranteed = CZE
				}
			}
			modifier = {
				factor = 0.8
				is_in_faction = yes
				NOT = {
					any_other_country = {
						is_major = yes
						is_in_faction_with = CZE
					}
				}
			}
		}
		effect_tooltip = {
			GER = {
				transfer_state = 69
				transfer_state = 74
			}
		}
		hidden_effect = {
			GER = {
				country_event = {
					id = germany.124 days = 1
				}
			}
		}
	}
}


#Events in case of weirdness with German Czechoslovakia focus
country_event = {
	id = germany.123
	title = germany.123.t
	desc = germany.123.d
	picture = GFX_report_event_czech_soldiers_02

	is_triggered_only = yes

	option = {
		name = germany.123.a
		add_state_claim = 69
		add_state_claim = 74
		if = {
			limit = {
				CZE = { is_subject_of = FROM }
				FROM = {
					is_in_faction_with = GER
					is_faction_leader = no
				}
			}
			remove_from_faction = CZE
			remove_from_faction = FROM
		}
		69 = {
			controller = {
				GER = {
					create_wargoal = {
						type = take_state_focus
						target = PREV
						generator = { 69 74 }
					}
				}
			}
		}
	}
}


#Events in case of weirdness with German Czechoslovakia focus
country_event = {
	id = germany.124
	title = germany.124.t
	desc = germany.124.d
	picture = GFX_report_event_german_reichstag_gathering

	is_triggered_only = yes

	option = {
		name = germany.124.a
		add_state_core = 69
		transfer_state = 69
		add_state_core = 74
		transfer_state = 74
	}
}

#Event if Austria has a civil war
country_event = {
	id = germany.126
	title = germany.126.t
	desc = germany.126.d
	picture = GFX_report_event_german_reichstag_gathering

	is_triggered_only = yes

	option = {
		name = germany.126.a
		ai_chance = {
			base = 0
			modifier = {
				add = 1
				OR = {
					has_government = neutrality
					has_government = fascism
				}
			}
		}
		random_other_country = {
			limit = {
				original_tag = AUS
				NOT = { tag = ROOT }
			}
			FROM = {
				add_to_war = {
					targeted_alliance = ROOT
					enemy = PREV
					hostility_reason = war
				}
				annex_country = { target = ROOT transfer_troops = yes }
				hidden_effect = { news_event = { id = news.237 } }
			}
		}
		custom_effect_tooltip = GAME_OVER_TT
	}
	option = {
		name = germany.126.b
		ai_chance = {
			base = 0
			modifier = {
				add = 1
				OR = {
					has_government = communism
					has_government = democratic
				}
			}
		}
		every_country = {
			limit = {
				OR = {
					tag = AUS
					original_tag = AUS
				}
			}
			FROM = {
				create_wargoal = {
					target = PREV
					type = annex_everything
				}
			}
		}
	}
}

# Anti-Soviet Pact, ask Germany to create faction or invite to faction
country_event = {
	id = germany.127
	title = germany.127.t
	desc = germany.127.d
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes

	# Create faction (if none) and send requests to join faction (members leave other faction)
	option = {
		name = germany.127.a
		every_other_country = {
			limit = {
				has_idea = anti_soviet_pact
				has_war_with = SOV
			}
			country_event = { id = germany.128 days = 1 }
		}
		if = {
			limit = {
				is_in_faction = no
			}
			create_faction = "anti_soviet_pact"
		}
	}

	# No ty
	option = {
		name = germany.127.b
		ai_chance = {
			base = 0
		}
	}
}

# Anti-Soviet Pact, Germany asks country to join faction
country_event = {
	id = germany.128
	title = germany.128.t
	desc = germany.128.d
	picture = GFX_report_event_soviet_tanks

	is_triggered_only = yes

	# Join faction (if none) and send requests to join faction (members leave other faction)
	option = {
		name = germany.128.a
		trigger = {
			is_in_faction = no
		}
		ai_chance = {
			base = 10
		}
		GER = { add_to_faction = ROOT }
	}

	# No ty
	option = {
		name = germany.128.b
		ai_chance = {
			base = 0
		}
	}
}

#rename city
country_event = {
	id = germany.999
	title = germany.999.t
	desc = germany.999.desc
	picture = GFX_report_event_german_reichstag_gathering

	fire_only_once = yes

	trigger = {
		tag = GER
		GER = {
			has_government = fascism
			owns_state = 217
			owns_state = 195
		}
	}

	option = { #a great idea!
		name = germany.999.a
		ai_chance = {
			base = 100
		}
		set_province_name = { id = 3529 name = "Hindenburg"}
		set_province_name = { id = 3151 name = "Ludendorff"}
		set_global_flag = GER_cities_renamed
	}

	option = { #rather not
		name = germany.999.b
		ai_chance = {
			base = 0
		}
		add_stability = -0.05 #because fuck you
							  #language
	}

}

#reset city name if retaken
country_event = {
	id = germany.1000
	title = germany.1000.t
	desc = germany.1000.desc
	picture = GFX_report_event_german_reichstag_gathering
	fire_only_once = yes
	hidden = yes

	trigger = {
		SOV = {
			has_government = communism
			owns_state = 217
			owns_state = 195
		}
		OR = {
			has_global_flag = GER_cities_renamed
			has_global_flag = ROM_king_is_silly
		}
	}


	option = { #a great idea!
		name = germany.1000.a
		ai_chance = {
			base = 100
		}
		reset_province_name = 3529
		reset_province_name = 3151
		clr_global_flag = GER_cities_renamed
		clr_global_flag = ROM_king_is_silly
	}
}

country_event = { #Hand over sudetenland even if we're not czech
	id = germany.1041
	title = germany.1041.t
	desc = germany.1041.desc
	picture = GFX_report_event_german_reichstag_gathering

	is_triggered_only = yes

	option = { #SURE
		name = germany.1041.a
		ai_chance = {
			base = 50
		}
		effect_tooltip = {
			GER = {
				transfer_state = 69
				transfer_state = 74
			}
		}
		hidden_effect = {
			GER = {
				country_event = { id = germany.1042 }
			}
		}
	}

	option = { #NO THX
		name = germany.1041.b

		effect_tooltip = {
			GER = {
				create_wargoal = {
					type = take_state_focus
					target = PREV
					expire = 0
					generator = { 69 }
				}
			}
		}
		hidden_effect = {
			GER = {
				country_event = { id = germany.1043 }
			}
		}
		ai_chance = {
			base = 5 #No need for long and complicated factors here - it's an edge case
			modifier = {
				factor = 10
				is_historical_focus_on = no
			}
		}

	}
}

country_event = { #Handed Over
	id = germany.1042
	title = germany.1042.t
	desc = germany.1042.desc
	picture = GFX_report_event_german_reichstag_gathering

	is_triggered_only = yes

	option = { #SURE
		name = germany.1042.a
		69 = {
			controller = {
				GER = {
					transfer_state = 69
					transfer_state = 74
				}
			}
		}
	}
}

country_event = { #Handed Over.. NOT
	id = germany.1043
	title = germany.1043.t
	desc = germany.1043.desc
	picture = GFX_report_event_german_reichstag_gathering

	is_triggered_only = yes

	option = { #NOPE
		name = germany.1043.a
		create_wargoal = {
			type = take_state_focus
			target = FROM
			expire = 0
			generator = { 69 }
		}
	}
}

###########################
# Hungarian Events
###########################

add_namespace = hungary

# Second Vienna Award - No Territory
country_event = {
	id = hungary.1
	title = hungary.1.t
	desc = hungary.1.d
	picture = GFX_report_event_finnish_letter
	
	is_triggered_only = yes
	
	option = {
		name = hungary.1.a
	}
}

# Second Vienna Award - Northern Transylvania
country_event = {
	id = hungary.2
	title = hungary.2.t
	desc = hungary.2.d
	picture = GFX_report_event_second_vienna_award_pact
	
	is_triggered_only = yes
	
	option = {
		name = hungary.2.a
		HUN = { 
			transfer_state = 76
		}
		hidden_effect = {
			country_event = { days = 1 id = news.15 }
		}
	}
}

# Second Vienna Award - All of Transylvania
country_event = {
	id = hungary.3
	title = hungary.2.t
	desc = hungary.3.d
	picture = GFX_report_event_second_vienna_award_pact
	
	is_triggered_only = yes
	
	option = {
		name = hungary.2.a
		HUN = { 
			transfer_state = 76
			transfer_state = 83
			transfer_state = 84
		}
		hidden_effect = {
			country_event = { days = 1 id = news.16 }
		}
	}
}

# Second Vienna Award - Romania Rejects Verdict (Northern Transylvania)
country_event = {
	id = hungary.4
	title = hungary.2.t
	desc = hungary.4.d
	picture = GFX_report_event_second_vienna_award_pact
	
	is_triggered_only = yes
	
	option = {
		name = hungary.4.a
		add_state_claim = 76
		hidden_effect = {
			country_event = { days = 1 id = news.17 }
		}
	}
}

# Second Vienna Award - Romania Rejects Verdict (All of Transylvania)
country_event = {
	id = hungary.5
	title = hungary.2.t
	desc = hungary.5.d
	picture = GFX_report_event_second_vienna_award_pact
	
	is_triggered_only = yes
	
	option = {
		name = hungary.4.a
		add_state_claim = 76
		add_state_claim = 83
		add_state_claim = 84
		hidden_effect = {
			country_event = { days = 1 id = news.18 }
		}
	}
}

# Hungary (First Ljubljana Award) from german focus
country_event = {
	id = hungary.6
	title = hungary.6.t
	desc = hungary.6.d
	picture = GFX_report_event_vienna_award_negotiations
	
	is_triggered_only = yes
	
	option = {
		name = hungary.6.a
		HUN = { transfer_state = 45 }
	}
}
###########################
# Italian Events
###########################

add_namespace = italy

# Extension of the Vallo Alpino
country_event = {
	id = italy.4
	title = italy.4.t
	desc = italy.4.d
	picture = GFX_report_event_bunker_01
	
	is_triggered_only = yes
	
	option = {
		name = italy.4.a
		158 = {
			add_building_construction = {
				type = bunker
				province = 11891
				level = 3
			}
			add_building_construction = {
				type = bunker
				province = 11721
				level = 3
			}
		
			add_building_construction = {
				type = bunker
				province = 9738
				level = 3
			}
		}
		160 = {
			add_building_construction = {
				type = bunker
				province = 3657
				level = 3
			}
			add_building_construction = {
				type = bunker
				province = 9613
				level = 3
			}
			add_building_construction = {
				type = bunker
				province = 11595
				level = 3
			}
		}
	}
}


# Italian-German Treaty (Germans)
country_event = {
	id = italy.5
	title = italy.5.t
	desc = italy.5.d
	picture = GFX_report_event_german_italian_pact
	
	is_triggered_only = yes
	
	option = {
		name = italy.5.a	#sounds good
		ITA = {
			country_event = { days = 1 id = italy.6 }
		}
		# REVISIT Balance research bonus, also in event below
		add_tech_bonus = {
			bonus = 1.0
			uses = 1
			technology = tech_mountaineers2
		}
		add_doctrine_cost_reduction = {
			cost_reduction = 0.35
			uses = 2
			category = naval_doctrine
		}
	}
}

# Germans Accept Italian-German Treaty
country_event = {
	id = italy.6
	title = italy.6.t
	desc = italy.6.d
	picture = GFX_report_event_physics_lab_01

	is_triggered_only = yes
	
	option = {
		name = italy.6.a
		# REVISIT Balance research bonus
		add_tech_bonus = {
			name = synth_bonus
			bonus = 1.0
			uses = 1
			category = synth_resources
		}
		add_tech_bonus = {
			name = armor_bonus
			bonus = 1.0
			uses = 2
			category = armor
		}
		ITA = {
			add_opinion_modifier = { target = GER modifier = ger_ita_tech_treaty }
		}
	}
}

# Request Balearic Islands from Spain
country_event = {
	id = italy.9
	title = italy.9.t
	desc = italy.9.d
	picture = GFX_report_event_merchant_ship_01

	is_triggered_only = yes
	
	option = {
		name = italy.9.a
		ITA = { country_event = { id = italy.10 } }
		effect_tooltip = {
			ITA = { transfer_state = 177 }
			remove_opinion_modifier = { target = ITA modifier = ita_supported_spain_civil_war }
		}

		hidden_effect = {
			news_event = { id = news.190 }
		}
	}
	option = {
		name = italy.9.b
		ai_chance = { factor = 0 }
		ITA = { country_event = { id = italy.11 } }
		effect_tooltip = {
			ITA = { add_state_claim = 177 }
		}
	}
}

# Spain Gives Up Balearic Islands
country_event = {
	id = italy.10
	title = italy.10.t
	desc = italy.10.d
	picture = GFX_report_event_merchant_ship_01

	is_triggered_only = yes
	
	option = {
		name = italy.10.a
		ITA = { transfer_state = 177 }
		remove_opinion_modifier = { target = ITA modifier = ita_supported_spain_civil_war }
	}
}

# Spain Refuses to Give Up Islands
country_event = {
	id = italy.11
	title = italy.11.t
	desc = italy.11.d
	picture = GFX_report_event_merchant_ship_01

	is_triggered_only = yes
	
	option = {
		name = italy.11.a
		ITA = { add_state_claim = 177 }
	}
}

# Italy Germany rejects demands for Vichy territory
country_event = {
	id = italy.14
	title = italy.14.t
	desc = italy.14.d
 
	picture = GFX_report_event_generic_sign_treaty1
	
	is_triggered_only = yes
	
	option = {
		ai_chance = { factor = 25 }
		name = italy.14.a
		GER = { 
			remove_from_faction = ITA 
			country_event = germany.105
		}
	}

	option = {
		ai_chance = { factor = 75 }
		name = italy.14.b

	}
}


# Italy Germany accepts demands for Vichy territory
country_event = {
	id = italy.15
	title = italy.15.t
	desc = { 
		text = italy.15.d
		trigger = {
			has_global_flag = ITA_claims_on_france_735
			has_global_flag = ITA_claims_on_france_1
		}
	}
	desc = { 
		text = italy.15.d_Corsica
		trigger = {
			NOT = { has_global_flag = ITA_claims_on_france_735 }
			has_global_flag = ITA_claims_on_france_1
		}
	}
 
	picture = GFX_report_event_generic_sign_treaty1
	
	is_triggered_only = yes
	
	option = {
		name = italy.15.a
		if = {
			limit = { has_global_flag = ITA_claims_on_france_735 }
			ITA = { transfer_state = 735 }
		}
		if = {
			limit = { has_global_flag = ITA_claims_on_france_1 }
			ITA = { transfer_state = 1 }
		}		
	}
}

# Italy Germany accepts some of demands for Vichy territory
country_event = {
	id = italy.16
	title = italy.16.t
	desc = italy.16.d
 
	picture = GFX_report_event_generic_sign_treaty1
	
	is_triggered_only = yes
	
	option = {
		name = italy.16.a

		transfer_state = 735
	}
}

###########################
# Japanese Events
###########################

add_namespace = japan

# Chinese Refuse Concessions
country_event = {
	id = japan.1
	title = china.1.t
	desc = japan.1.d
	picture = GFX_report_event_chinese_soldiers_01

	is_triggered_only = yes
	
	option = {
		name = japan.1.a
		add_war_support = 0.05
		create_wargoal = {
  			type = annex_everything
  			target = CHI
  		}
  		create_wargoal = {
  			type = annex_everything
  			target = SHX
  		}
		hidden_effect = {
			country_event = { days = 5 id = news.1 }
		}
		USA = { set_country_flag = { flag = USA_china_window days = 60 value = 1 } }
		if = {
			limit = {
				has_country_leader = { id = 700 ruling_only = yes }
			}
			remove_country_leader_trait = imperial_sanction
		}
	}
}

# Chinese Concessions
country_event = {
	id = japan.2
	title = china.1.t
	desc = japan.2.d
	picture = GFX_report_event_chinese_soldiers_running
	
	is_triggered_only = yes
	
	option = {
		name = japan.2.a
		effect_tooltip = {
			set_truce = { target = FROM days = 180 }
		}
		hidden_effect = {
			country_event = { days = 5 id = news.2 }
		}
		if = {
			limit = {
				608 = {
					is_controlled_by = FROM
				}
			}
			JAP = {
				transfer_state = 608
			}
		}
		if = {
			limit = {
				597 = {
					is_controlled_by = FROM
				}
			}
			JAP = {
				transfer_state = 597
			}
		}
		if = {
			limit = {
				614 = {
					is_controlled_by = FROM
				}
			}
			JAP = {
				transfer_state = 614
			}
		}
		if = {
			limit = {
				488 = {
					is_controlled_by = FROM
				}
			}
			JAP = {
				transfer_state = 488
			}
		}
		add_state_claim = 613
		if = {
			limit = {
				has_country_leader = { id = 700 ruling_only = yes }
			}
			remove_country_leader_trait = imperial_sanction
		}
		
		add_ai_strategy = {
			type = antagonize
			id = "CHI"
			value = 500
		}
	}
}

# Soviets Push Back And Win
country_event = {
	id = japan.3
	title = japan.3.t
	desc = japan.3.d
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes
	
	option = {
		if = {
			limit = { 
			714 = { 
				OR = {
					is_owned_by = JAP
					is_owned_by = MAN
				} 
				any_neighbor_state = { is_owned_by = SOV } }
			} 
			714 = { add_manpower = -30000 }
		}		
		if = {
			limit = {
				NOT = {
					714 = {
						OR = {
							is_owned_by = JAP
							is_owned_by = MAN
						}
						any_neighbor_state = { is_owned_by = SOV } 
					}
				}
			}
			random_owned_state = {
				limit = { any_neighbor_state = { is_owned_by = SOV } }
				add_manpower = -30000
			}
		}

		army_experience = 5
		add_tech_bonus = {
			name = japan.3.t #test_the_ussr_focus
			bonus = 1.0
			uses = 1
			category = cat_anti_tank
		}
		name = japan.3.a
		SOV = {
			country_event = { id = soviet.2 }
		}
	}
}
# Soviets Push Back And Lose
country_event = {
	id = japan.4
	title = japan.4.t
	desc = japan.4.d
	picture = GFX_report_event_japanese_soldiers_01
	
	is_triggered_only = yes
	
	option = {
		name = japan.4.a
		if = {
			limit = { 
			714 = { 
				OR = {
					is_owned_by = JAP
					is_owned_by = MAN						
				}
				any_neighbor_state = { is_owned_by = SOV } }
			} 
			714 = { add_manpower = -20000 }
		}		
		if = {
			limit = {
				NOT = {
					714 = {
						OR = {
							is_owned_by = JAP							
							is_owned_by = MAN						
						}
						any_neighbor_state = { is_owned_by = SOV } 
					}
				}
			}
			random_owned_state = {
				limit = { any_neighbor_state = { is_owned_by = SOV } }
				add_manpower = -20000
			}
		}
		army_experience = 15
		add_doctrine_cost_reduction = {
			name = japan.4.t
			cost_reduction = 0.35
			uses = 1
			category = cat_grand_battle_plan
		}
		SOV = {
			country_event = { id = soviet.3 }
		}
	}
}

# Soviets Yield
country_event = {
	id = japan.5
	title = japan.5.t
	desc = japan.5.d
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes
	
	option = {
		name = japan.5.a
		add_war_support = 0.05
		hidden_effect = {
			country_event = { days = 5 id = news.9 }
		}
	}
}

# French Accept Demands
country_event = {
	id = japan.6
	title = japan.6.t
	desc = japan.6.d
	picture = GFX_report_event_japanese_soldiers_02
	
	is_triggered_only = yes
	
	option = {
		name = japan.6.a
		USA = { set_country_flag = { flag = USA_indochina_window days = 60 value = 1 } }
		hidden_effect = {
			news_event = { days = 5 id = news.5 }
		}
		JAP = {
			JAP = { transfer_state = 286 }
			JAP = { transfer_state = 670 }
			JAP = { transfer_state = 671 }
			JAP = { transfer_state = 490 }
			JAP = { transfer_state = 728 }
			286 = { set_compliance = 100 }
			670 = { set_compliance = 100 }
			671 = { set_compliance = 100 }
			490 = { set_compliance = 100 }
			728 = { set_compliance = 100 }
			add_named_threat = { threat = 3 name = france.1.t }
		}
	}
}

# French Reject Demands
country_event = {
	id = japan.7
	title = japan.7.t
	desc = japan.7.d
	picture = GFX_report_event_japanese_soldiers_03
	
	is_triggered_only = yes
	
	option = {
		name = japan.7.a
		create_wargoal = {
			type = take_state
			target = FROM
			generator = {
				286 741 670 671 728
			}
		}
		hidden_effect = {
			country_event = { days = 5 id = news.6 }
		}
	}
}

# Germany Agrees to Withdraw Falkenhausen
country_event = {
	id = japan.8
	title = japan.8.t
	desc = japan.8.d
	picture = GFX_report_event_german_detained_china
	
	is_triggered_only = yes
	
	option = {
		name = japan.8.a
	}
}

# Germany Refuses to Withdraw Falkenhausen
country_event = {
	id = japan.9
	title = japan.9.t
	desc = japan.9.d
	picture = GFX_report_event_german_advisors_remain
	
	is_triggered_only = yes
	
	option = {
		name = japan.9.a
	}
	#option = { # Withdraw from the Anti-Comintern Pact
	#	name = japan.9.b
	#}
}

# USA condemns our war 
country_event = {
	id = japan.10
	title = japan.10.t
	desc = japan.10.d
	picture = GFX_report_event_FDR_speech
	
	is_triggered_only = yes
	
	option = {
		name = japan.10.a
		USA = { 
			add_opinion_modifier = { target = JAP modifier = condemn_aggression }
		}
	}
}

# Pressure Siam to become a puppet
country_event = {
	id = japan.11
	title = japan.11.t
	desc = japan.11.d
	picture = GFX_report_event_japanese_officers
	
	is_triggered_only = yes
	
	option = {
		name = japan.11.a
		SIA = { 
			country_event = { id = japan.12 }
		}
	}

	option = {
		name = japan.11.b
		ai_chance = { factor = 0 }
	}
}

# Siam event from Japan: Become puppet or not
country_event = {
	id = japan.12
	title = japan.12.t
	desc = japan.12.d
	picture = GFX_report_event_japanese_officers
	
	is_triggered_only = yes
	
	option = {
		name = japan.12.a
		ai_chance = {
			factor = 90 
			modifier = {
				#If they have a fighting chance, they should stand their ground
				factor = 0
				strength_ratio = {
					tag = JAP
					ratio > 0.75
				}
			}
		}
		JAP = { 
			country_event = { id = japan.13 }
			effect_tooltip = { puppet = SIA }
		}
	}

	option = {
		name = japan.12.b
		ai_chance = { factor = 10 }
		JAP = { 
			country_event = { id = japan.14 }
			effect_tooltip = {
				declare_war_on = {
					target = SIA
					type = puppet_wargoal_focus
				}
			}
		}
	}
}

# Siam accepts and is puppeted
country_event = {
	id = japan.13
	title = japan.13.t
	desc = japan.13.d
	picture = GFX_report_event_japanese_siam_politicians
	
	is_triggered_only = yes
	
	option = {
		name = japan.13.a
		puppet = SIA
	}
}

# Siam refuses, nations go to war 
country_event = {
	id = japan.14
	title = japan.14.t
	desc = japan.14.d
	picture = GFX_report_event_japanese_chinese_surrender
	
	is_triggered_only = yes
	
	option = {
		name = japan.14.a
		declare_war_on = {
			target = SIA
			type = puppet_wargoal_focus
		}
	}
}

# Indian national army 
country_event = {
	id = japan.15
	title = japan.15.t
	desc = japan.15.d
	picture = GFX_report_event_indian_soldiers
	
	is_triggered_only = yes
	
	option = {
		name = japan.15.a
		hidden_effect = {
			load_oob = "JAP_Indian_National_Army_reinforcement"
		}
		custom_effect_tooltip = JAP_Indian_National_Army_arrives
		add_manpower = 10000
		set_global_flag = indian_national_army_setup
		RAJ = {
			add_stability = -0.2
			if = {
				limit = { has_dlc = "Together for Victory" }
				add_popularity = {
					ideology = fascism
					popularity = 0.1
				}
				add_popularity = {
					ideology = democratic
					popularity = -0.05
				}
				else = {
					add_ideas = RAJ_azad_hind 
					ENG = {
						country_event = { id = britain.19 }
					}
				}
			}
		}
	}
}

# China event from Japan: Become puppet or not
country_event = {
	id = japan.16
	title = japan.16.t
	desc = japan.16.d
	picture = GFX_report_event_asian_politicians
	
	is_triggered_only = yes
	
	#Accept - become puppet
	option = {
		name = japan.16.a
		ai_chance = {
			factor = 60
			modifier = {
				factor = 0
				strength_ratio = {
					tag = JAP
					ratio > 0.10
				}
				CHI_is_on_historical_plan_trigger = yes
			}
		}
		JAP = { 
			country_event = { id = japan.17 }
			effect_tooltip = { puppet = CHI }
		}
	}

	option = {
		name = japan.16.b
		ai_chance = { factor = 40 }
		JAP = { 
			country_event = { id = japan.18 }
			effect_tooltip = {
				create_wargoal = {
					type = take_state
					target = CHI
					generator = owned_states
				}
			}
		}
	}
}

# China accepts and is puppeted
country_event = {
	id = japan.17
	title = japan.17.t
	desc = japan.17.d
	picture = GFX_report_event_chinese_japanese_handshake
	
	is_triggered_only = yes
	
	option = {
		name = japan.17.a
		puppet = CHI
		add_named_threat = { threat = 20 name = chinese_puppet_focus }
		hidden_effect = {
			news_event = { hours = 6 id = news.210 }
		}
	}
}

# China refuses, gain cb
country_event = {
	id = japan.18
	title = japan.18.t
	desc = japan.18.d
	picture = GFX_report_event_chinese_soldiers_02
	
	is_triggered_only = yes
	
	option = {
		name = japan.18.a
		create_wargoal = {
			type = take_state
			target = CHI
			generator = owned_states
		}
	}
}

###   ##  #   ### ### ###  ##   ##  #       #   # ###  ##  #   ### #  #  ##  ### 
#  # #  # #    #   #   #  #  # #  # #       #   #  #  #  # #   #   ## # #  # #   
###  #  # #    #   #   #  #    #### #        # #   #  #  # #   ##  # ## #    ##  
#    #  # #    #   #   #  #  # #  # #        # #   #  #  # #   #   #  # #  # #   
#     ##  ### ###  #  ###  ##  #  # ###       #   ###  ##  ### ### #  #  ##  ### 


add_namespace = lar_france_political_violence

# right wing riots
country_event = {
	id = lar_france_political_violence.1
	title = lar_france_political_violence.1.t
	desc = lar_france_political_violence.1.desc
	picture = GFX_report_event_generic_riot
	is_triggered_only = yes

	option = {
		name = lar_france_political_violence.1.a #ignore
		add_stability = -0.05
		add_popularity = { ideology = fascism popularity = 0.025 }
		add_popularity = { ideology = neutrality popularity = 0.025 }
	}

	option = {
		name = lar_france_political_violence.1.b #prosecute
		add_political_power = -50
	}
}

# communist riots
country_event = {
	id = lar_france_political_violence.2
	title = lar_france_political_violence.1.t
	desc = lar_france_political_violence.2.desc
	picture = GFX_report_event_generic_riot
	is_triggered_only = yes

	option = {
		name = lar_france_political_violence.1.a #ignore
		add_stability = -0.05
		add_popularity = { ideology = communism popularity = 0.025 }
	}

	option = {
		name = lar_france_political_violence.1.b #prosecute
		add_political_power = -50
	}
}

# massive right wing riots
country_event = {
	id = lar_france_political_violence.3
	title = lar_france_political_violence.3.t
	desc = lar_france_political_violence.3.desc
	picture = GFX_report_event_generic_riot
	is_triggered_only = yes

	option = {
		name = lar_france_political_violence.3.a #ignore
		add_stability = -0.1
		add_popularity = { ideology = fascism popularity = 0.05 }
		add_popularity = { ideology = neutrality popularity = 0.05 }
	}

	option = {
		name = lar_france_political_violence.3.b #prosecute
		add_political_power = -150
	}
}

# political violence returns at low stability
country_event = {
	id = lar_france_political_violence.4
	title = lar_france_political_violence.4.t
	desc = lar_france_political_violence.4.desc
	picture = GFX_report_event_generic_rally2
	is_triggered_only = yes

	option = {
		name = lar_france_political_violence.4.a #ignore
		effect_tooltip = {
			add_ideas = FRA_political_violence
		}
	}
}

#    ##  #   #      ## ###  ##  ###  ### #   ### ### #   #      ##  ### #   # ### #       #   #  ##  ###  
#   #  # #   #     #    #  #  # #  #  #  #    #   #   # #      #  #  #  #   #  #  #       #   # #  # #  # 
#   #  # # # #      #   #  #### ###   #  #    #   #    #       #     #   # #   #  #       # # # #### ###  
#   #  # # # #       #  #  #  # #  #  #  #    #   #    #       #  #  #   # #   #  #       # # # #  # #  # 
###  ##   # #      ##   #  #  # ###  ### ### ###  #    #        ##  ###   #   ### ###      # #  #  # #  # 

add_namespace = lar_low_stability_civil_war

#communists start uprising
country_event = {
	id = lar_low_stability_civil_war.1
	title = lar_low_stability_civil_war.1.t
	desc = lar_low_stability_civil_war.1.desc
	picture = GFX_report_event_spain_civil_war_volunteers_02
	
	is_triggered_only = yes

	option = {
		name = lar_low_stability_civil_war.1.a #agree
		ai_chance = {
			factor = 80
		}
		start_civil_war = {
			ideology = communism
			size = 0.5
		}
	}
}

#fascists start uprising
country_event = {
	id = lar_low_stability_civil_war.2
	title = lar_low_stability_civil_war.2.t
	desc = lar_low_stability_civil_war.2.desc
	picture = GFX_report_event_spain_civil_war_soldiers

	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = lar_low_stability_civil_war.2.a #agree
		ai_chance = {
			factor = 80
		}
		start_civil_war = {
			ideology = fascism
			size = 0.5
		}
	}
}

#   #  ##  ###  # # ### ###       ## #  #  ##  ###  ###  ##   ##  ### 
#   # #  # #  # # # #   #  #     #   #  # #  # #  #  #  #  # #    #   
# # # #  # ###  ##  ##  ###       #  #### #  # ###   #  #### # ## ##  
# # # #  # #  # # # #   #  #       # #  # #  # #  #  #  #  # #  # #   
 # #   ##  #  # # # ### #  #     ##  #  #  ##  #  #  #  #  #  ##  ### 


#events to notify player that they are having worker issues
add_namespace = lar_worker_shortage

 ##  ###  #   #  ##     ###  #  # ###   ##  #  #  ##   ## ###  ## 
#  # #  # ## ## #       #  # #  # #  # #  # #  # #  # #   #   #   
#### ###  # # #  #      ###  #  # ###  #    #### ####  #  ##   #  
#  # #  # #   #   #     #    #  # #  # #  # #  # #  #   # #     # 
#  # #  # #   # ##      #     ##  #  #  ##  #  # #  # ##  ### ##  

add_namespace = lar_arms_purchases

#intial event for US - France wants to buy weapons
country_event = {
	id = lar_arms_purchases.1
	title = lar_arms_purchases.1.t
	desc = lar_arms_purchases.1.desc
	picture = GFX_report_event_generic_lend_lease
	is_triggered_only = yes
	option = {
		name = lar_arms_purchases.1.a #agree
		ai_chance = {
			factor = 40
		}
		trigger = {
			USA_can_sell_weapons_trigger = yes
		}
		FRA = {
			country_event = lar_arms_purchases.2
		}
		army_experience = 10
	}

	option = {
		name = lar_arms_purchases.1.b #refuse
		ai_chance = {
			factor = 60
			modifier = {
				FRA = { has_war = yes }
				factor = 0.5
			}
		}
		FRA = {
			country_event = lar_arms_purchases.3
		}
	}
}

# rasponse event for France - country agrees
country_event = {
	id = lar_arms_purchases.2
	title = lar_arms_purchases.2.t
	desc = lar_arms_purchases.2.desc
	picture = GFX_report_event_merchant_ship_01
	is_triggered_only = yes
	option = {
		name = lar_arms_purchases.2.a #agree
		ai_chance = {
			factor = 100
		}
		set_country_flag = FRA_arms_purchases_permitted
	}
}
#response event for France - US refuse
country_event = {
	id = lar_arms_purchases.3
	title = lar_arms_purchases.3.t
	desc = lar_arms_purchases.3.desc
	picture = GFX_report_event_generic_read_write
	is_triggered_only = yes
	option = {
		name = lar_arms_purchases.3.a #agree
		ai_chance = {
			factor = 80
		}
	}
}

#   #  ##  #   #  # #  # ### ### ### ###   ##     ###  ##       ## ###   ##  ### #  # 
#   # #  # #   #  # ## #  #  #   #   #  # #        #  #  #     #   #  # #  #  #  ## # 
 # #  #  # #   #  # # ##  #  ##  ##  ###   #       #  #  #      #  ###  ####  #  # ## 
 # #  #  # #   #  # #  #  #  #   #   #  #   #      #  #  #       # #    #  #  #  #  # 
  #    ##  ###  ##  #  #  #  ### ### #  # ##       #   ##      ##  #    #  # ### #  # 

add_namespace = lar_france_volunteers

#event for country - French volunteers have joined!
country_event = {
	id = lar_france_volunteers.1
	title = lar_france_volunteers.1.t
	desc = lar_france_volunteers.1.desc
	picture = GFX_report_event_spain_civil_war_volunteers_01
	immediate = {
		if = {
			limit = { has_government = fascism }
			set_variable = { volunteer_strength = FRA.party_popularity@fascism }
		}
		else_if = {
			limit = { has_government = communism }
			set_variable = { volunteer_strength = FRA.party_popularity@communism }
		}
		else_if = {
			limit = { has_government = democratic }
			set_variable = { volunteer_strength = FRA.party_popularity@democratic }
			multiply_variable = { volunteer_strength = 0.5 } #special modifier to reduce impact of democratic support [no longer war support, or we reach 0 often, also it is HIDDEN]
		}
		else_if = {
			limit = { has_government = neutrality }
			set_variable = { volunteer_strength = FRA.party_popularity@neutrality }
		}
		multiply_variable = { volunteer_strength = 1000 }
	}
	is_triggered_only = yes
	option = {
		name = lar_france_volunteers.1.a #agree
		ai_chance = {
			factor = 40
		}
		set_country_flag = FRA_has_received_volunteers
		add_manpower = volunteer_strength
	}
}

# volunteers return - hidden event
country_event = {
	id = lar_france_volunteers.2
	hidden = yes
	is_triggered_only = yes
	option = {}
}  

# volunteers return - event for France to accept them
country_event = {
	id = lar_france_volunteers.3
	title = lar_france_volunteers.3.t
	desc = lar_france_volunteers.3.desc
	picture = GFX_report_event_saf_civil_war
	is_triggered_only = yes
	
	option = {
		name = lar_france_volunteers.3.a #agree
		ai_chance = {
			factor = 60
		}
		if = {
			limit = {
				FROM = {
					has_government = fascism
				}
			}
			add_popularity = { ideology = fascism popularity = 0.05 }
			army_experience = 10
		}
		else_if = {
			limit = {
				FROM = {
					has_government = communism
				}
			}
			add_popularity = { ideology = communism popularity = 0.05 }
			army_experience = 10
		}
		else_if = {
			limit = {
				FROM = {
					has_government = democratic
				}
			}
			add_popularity = { ideology = democratic popularity = 0.05 }
			army_experience = 10
		}
		else_if = {
			limit = {
				FROM = {
					has_government = neutrality
				}
			}
			add_popularity = { ideology = neutrality popularity = 0.05 }
			army_experience = 10
		}
	}

	option = {
		name = lar_france_volunteers.3.b #arefuse
		ai_chance = {
			factor = 40
		}
		if = {
			limit = {
				FROM = {
					has_government = fascism
				}
			}
			set_temp_variable = { stability_impact = party_popularity@fascism }
			multiply_temp_variable = { stability_impact = 0.1 }
			add_stability = stability_impact
		}
		else_if = {
			limit = {
				FROM = {
					has_government = communism
				}
			}
			set_temp_variable = { stability_impact = party_popularity@communism }
			multiply_temp_variable = { stability_impact = 0.1 }
			add_stability = stability_impact
		}
		else_if = {
			limit = {
				FROM = {
					has_government = democratic
				}
			}
			set_temp_variable = { stability_impact = party_popularity@democratic }
			multiply_temp_variable = { stability_impact = 0.1 }
			add_stability = stability_impact
		}
		else_if = {
			limit = {
				FROM = {
					has_government = neutrality
				}
			}
			set_temp_variable = { stability_impact = party_popularity@neutrality }
			multiply_temp_variable = { stability_impact = 0.1 }
			add_stability = stability_impact
		}
	}
} 

#  #  ##  #  #     ### #  # ### ### ###  #   # ### #  # ### ###  ##  #  #     ### #  #      ## ###   ##  ### #  # 
## # #  # ## #      #  ## #  #  #   #  # #   # #   ## #  #   #  #  # ## #      #  ## #     #   #  # #  #  #  ## # 
# ## #  # # ##      #  # ##  #  ##  ###   # #  ##  # ##  #   #  #  # # ##      #  # ##      #  ###  ####  #  # ## 
#  # #  # #  #      #  #  #  #  #   #  #  # #  #   #  #  #   #  #  # #  #      #  #  #       # #    #  #  #  #  # 
#  #  ##  #  #     ### #  #  #  ### #  #   #   ### #  #  #  ###  ##  #  #     ### #  #     ##  #    #  # ### #  # 

add_namespace = lar_non_intervention

#intial event France wants to propose non-intervention
country_event = {
	id = lar_non_intervention.1
	title = lar_non_intervention.1.t
	desc = lar_non_intervention.1.desc
	picture = GFX_report_event_generic_conference
	is_triggered_only = yes
	option = {
		name = lar_non_intervention.1.a #agree
		ai_chance = {
			factor = 80
		}
		set_country_flag = FRA_non_intervention_agreed
		FRA = {
			country_event = lar_non_intervention.2
		}
	}

	option = {
		name = lar_non_intervention.1.b #refuse
		ai_chance = {
			factor = 20
		}
		FRA = {
			country_event = lar_non_intervention.3
		}
		set_country_flag = FRA_non_intervention_refused
	}
}

# rasponse event for France - country agrees
country_event = {
	id = lar_non_intervention.2
	title = lar_non_intervention.2.t
	desc = lar_non_intervention.2.desc
	picture = GFX_report_event_generic_sign_treaty1
	is_triggered_only = yes
	option = {
		name = lar_non_intervention.2.a #agree
		ai_chance = {
			factor = 100
		}
		add_stability = 0.02
		add_war_support = -0.01
	}
}
#response event for France - country refuses
country_event = {
	id = lar_non_intervention.3
	title = lar_non_intervention.3.t
	desc = lar_non_intervention.3.desc
	picture = GFX_report_event_generic_sign_treaty2
	is_triggered_only = yes
	option = {
		name = lar_non_intervention.3.a #agree
		ai_chance = {
			factor = 80
		}
	}
}

 ##   ##  #   # #   # #  # #  # ###  ## ###      ## #  # ###  ###   ##  ###  ### 
#  # #  # ## ## ## ## #  # ## #  #  #    #      #   #  # #  # #  # #  # #  #  #  
#    #  # # # # # # # #  # # ##  #   #   #       #  #  # ###  ###  #  # ###   #  
#  # #  # #   # #   # #  # #  #  #    #  #        # #  # #    #    #  # #  #  #  
 ##   ##  #   # #   #  ##  #  # ### ##   #      ##   ##  #    #     ##  #  #  #  

add_namespace = lar_communist_support

country_event = {
	id = lar_communist_support.1
	hidden = yes
	trigger = {
		has_idea = FRA_communist_cooperation
		communism > 0.15
	}
	fire_only_once = yes
	immediate = {
		swap_ideas = {
			remove_idea = FRA_communist_cooperation
			add_idea = FRA_communist_cooperation_2
		}
	}

	option = {
		
	}
}

add_namespace = lar_news


# End of the Spanish Civil War (Nationalist/Carlist victory)
news_event = {
	id = lar_news.1
	title = {
		text = lar_news.1.t_franco
		trigger = {
			has_global_flag = SPR_franco_won
		}
	}
	title = {
		text = lar_news.1.t_falangist
		trigger = {
			has_global_flag = SPR_falange_won
		}
	}
	title = {
		text = lar_news.1.t_carlists
		trigger = {
			has_global_flag = SPR_carlists_won
		}
	}
	desc = {
		text = lar_news.1.desc_franco
		trigger = {
			has_global_flag = SPR_franco_won
			NOT = {
				has_global_flag = SPR_carlist_uprising_flag
				has_global_flag = scw_early_end
			}
		}
	}
	desc = {
		text = lar_news.1.desc_franco_unified
		trigger = {
			has_global_flag = SPR_franco_won
			NOT = { has_global_flag = SPR_carlist_uprising_flag }
			has_global_flag = scw_early_end
		}
	}
	desc = {
		text = lar_news.1.desc_franco_uprising
		trigger = {
			has_global_flag = SPR_franco_won
			has_global_flag = SPR_carlist_uprising_flag
		}
	}
	desc = {
		text = lar_news.1.desc_falangist
		trigger = {
			has_global_flag = SPR_falange_won
		}
	}
	desc = {
		text = lar_news.1.desc_carlists
		trigger = {
			has_global_flag = SPR_carlists_won
		}
	}
	picture = GFX_news_event_033
	
	major = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_completed_focus = SPA_the_phalanx_ascendant
				}
				set_global_flag = SPR_falange_won
			}
			if = {
				limit = {
					has_completed_focus = SPA_unify_the_nationalist_front
				}
				set_global_flag = SPR_franco_won
			}
			if = {
				limit = {
					has_completed_focus = SPA_supremacy_of_the_communion
				}
				set_global_flag = SPR_carlists_won
			}
			if = {
				limit = {
					OR = {
						tag = SPA
						tag = SPB
					}
				}
				delete_unit_template_and_units = {
					division_template = "Guarnición Nacionalista"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "División de la Guardia de Asalto"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Brigada de la Guardia Civil"
					disband = yes
				}
				if = {
					limit = {
						tag = SPA
						has_completed_focus = SPA_the_fifth_column
					}
					delete_unit_template_and_units = {
						division_template = "Fifth Columnist Brigade"
						disband = yes
					}
				}
				if = {
					limit = {
						NOT = {
							tag = SPB
						}
					}
					delete_unit_template_and_units = {
						division_template = "Requeté Carlista"
						disband = yes
					}
				}
				if = {
					limit = {
						tag = SPA
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_nationalists_flag
						}
						remove_core_of = SPB
						remove_core_of = SPC
						remove_core_of = SPD
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_republicans_flag
						}
						remove_core_of = SPA
						remove_core_of = SPB
						remove_core_of = SPC
						remove_core_of = SPD
						start_resistance = yes
					}
					118 = {
						if = {
							limit = {
								is_controlled_by = ROOT
							}
							remove_core_of = SPB
							remove_core_of = SPD
							remove_core_of = SPC
							add_core_of = ROOT
						}
						else = {
							remove_claim_by = SPB
							remove_claim_by = SPC
							remove_claim_by = SPD
							add_claim_by = SPA
						}
					}
				}
				if = {
					limit = {
						tag = SPB
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_nationalists_flag
						}
						remove_core_of = SPA
						remove_core_of = SPC
						remove_core_of = SPD
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_republicans_flag
						}
						remove_core_of = SPB
						remove_core_of = SPA
						remove_core_of = SPC
						remove_core_of = SPD
						start_resistance = yes
					}
					118 = {
						if = {
							limit = {
								is_controlled_by = ROOT
							}
							remove_core_of = SPA
							remove_core_of = SPD
							remove_core_of = SPC
							add_core_of = ROOT							
						}
						else = {
							remove_claim_by = SPA
							remove_claim_by = SPC
							remove_claim_by = SPD
							add_claim_by = SPB
						}
					}
				}
				remove_ideas = SPA_death_before_surrender
				add_timed_idea = { idea = SPA_recovering_from_civil_war days = 2190 }
				if = {
					limit = {
						has_idea = SPA_foreign_training_staff
					}
					remove_ideas = SPA_foreign_training_staff
				}
				if = {
					limit = {
						has_idea = SPA_a_methodical_approach
					}
					remove_ideas = SPA_a_methodical_approach
				}
				every_state = {
					limit = {
						OR = {
							state = 41
							state = 165
							state = 166
							state = 167
							state = 168
							state = 169
							state = 170
							state = 171
							state = 172
							state = 173
							state = 174
							state = 175
							state = 176
							state = 649
							state = 552
							state = 544
							state = 540
							state = 494
							state = 493
							state = 492
						}
					}
					remove_dynamic_modifier = {
						modifier = unplanned_offensive
					}
				}
			}
		}
	}
	
	option = {
		name = lar_news.1.a
		trigger = {
			country_exists = SPB
			SPB = { has_capitulated = no }
			NOT = { tag = SPB }
			NOT = { original_tag = SPR }
			has_government = neutrality
		}
	}
	option = {
		name = lar_news.1.b
		trigger = {
			country_exists = SPB
			SPB = { has_capitulated = no }
			NOT = { tag = SPB }
			NOT = { original_tag = SPR }
			NOT = { has_government = neutrality }
		}
	}
	option = {
		name = lar_news.1.c
		trigger = {
			OR = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
			NOT = { original_tag = SPR }
			country_exists = SPA
			SPA = { has_capitulated = no }
			NOT = { tag = SPA }
		}
	}
	option = {
		name = news.28.a
		trigger = {
			NOT = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
				tag = SOV
			}
			NOT = { original_tag = SPR }
			country_exists = SPA
			SPA = { has_capitulated = no }
			NOT = { tag = SPA }
		}
	}
	option = {
		name = lar_news.1.e
		trigger = {
			tag = SOV
			country_exists = SPA
			SPA = { has_capitulated = no }
			NOT = { tag = SPA }
			NOT = { original_tag = SPR }
		}
	}
	option = {
		name = lar_news.1.f
		trigger = {
			OR = {
				tag = SPA
				tag = SPB
			}
		}
		effect_tooltip = {
			delete_unit_template_and_units = {
				division_template = "Guarnición Nacionalista"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "División de la Guardia de Asalto"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Brigada de la Guardia Civil"
				disband = yes
			}
			if = {
				limit = {
					tag = SPA
					has_completed_focus = SPA_the_fifth_column
				}
				delete_unit_template_and_units = {
					division_template = "Fifth Columnist Brigade"
					disband = yes
				}
			}
			if = {
				limit = {
					NOT = {
						tag = SPB
					}
				}
				delete_unit_template_and_units = {
					division_template = "Requeté Carlista"
					disband = yes
				}
			}
			remove_ideas = SPA_death_before_surrender
			if = {
				limit = {
					has_idea = SPA_a_methodical_approach
				}
				remove_ideas = SPA_a_methodical_approach
			}
			add_timed_idea = { idea = SPA_recovering_from_civil_war days = 2190 }
			if = {
				limit = {
					has_idea = SPA_foreign_training_staff
				}
				remove_ideas = SPA_foreign_training_staff
			}
			if = {
				limit = {
					tag = SPA
				}
				every_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						has_state_flag = SPR_sided_with_republicans_flag
					}
					remove_core_of = SPA
					start_resistance = yes
				}
				118 = {
					if = {
						limit = {
							is_controlled_by = ROOT
						}
						add_core_of = ROOT
					}
					else = {
						add_claim_by = SPA
					}
				}
			}
			if = {
				limit = {
					tag = SPB
				}
				every_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						has_state_flag = SPR_sided_with_republicans_flag
					}
					remove_core_of = SPB
					start_resistance = yes
				}
				118 = {
					if = {
						limit = {
							is_controlled_by = ROOT
						}
						add_core_of = ROOT
					}
					else = {
						add_claim_by = SPB
					}
				}
			}
		}
	}
}
# End of the Spanish Civil War (Republican victory)
news_event = {
	id = lar_news.2
	title = {
		text = lar_news.1.t_republic
		trigger = {
			has_global_flag = SPR_democrats_won
		}
	}
	title = {
		text = lar_news.1.t_stalinist
		trigger = {
			has_global_flag = SPR_stalinists_won
		}
	}
	title = {
		text = lar_news.1.t_independent_communist
		trigger = {
			has_global_flag = SPR_poum_won
		}
	}
	title = {
		text = lar_news.1.t_anarchists
		trigger = {
			has_global_flag = SPR_anarchists_won
		}
	}
	desc = {
		text = lar_news.2.desc_republic_no_help
		trigger = {
			has_global_flag = SPR_democrats_won
			NOT = { SPD = {  has_completed_focus = SPR_expand_soviet_aid } }
		}
	}
	desc = {
		text = lar_news.2.desc_republic_soviet_help
		trigger = {
			has_global_flag = SPR_democrats_won
			SPD = { has_completed_focus = SPR_expand_soviet_aid }
		}
	}
	desc = {
		text = lar_news.2.desc_stalinist
		trigger = {
			has_global_flag = SPR_stalinists_won
		}
	}
	desc = {
		text = lar_news.2.desc_independent_communist
		trigger = {
			has_global_flag = SPR_poum_won
		}
	}
	desc = {
		text = lar_news.2.desc_anarchists
		trigger = {
			has_global_flag = SPR_anarchists_won
		}
	}
	picture = GFX_news_event_034
	
	major = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_completed_focus = SPR_regional_defense_council_of_aragon
				}
				set_global_flag = SPR_anarchists_won
			}
			if = {
				limit = {
					has_completed_focus = SPR_hinder_nkvd_interference
				}
				set_global_flag = SPR_poum_won
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_stalinist_doctrine
				}
				set_global_flag = SPR_stalinists_won
			}
			if = {
				limit = {
					has_completed_focus = SPR_maintain_the_second_republic
				}
				set_global_flag = SPR_democrats_won
			}
			if = {
				limit = {
					OR = {
						tag = SPC
						tag = SPD
					}
				}
				if = {
					limit = {
						tag = SPC
						SPC = { has_completed_focus = SPR_regional_defense_council_of_aragon }
					}
					set_global_flag = { flag = SPR_anarchist_victory_timer_flag value = 1 days = 365 }
				}
				delete_unit_template_and_units = {
					division_template = "Guarnición Republicana"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "División de la Guardia de Asalto"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Brigada de la Guardia Civil"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Carabineros"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Brigada Popular"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Brigada de Juventudes Sindicales"
					disband = yes
				}
				delete_unit_template_and_units = {
					division_template = "Brigada Anarquista"
					disband = yes
				}

				if = {
					limit = {
						tag = SPC
					}

					# If POUM wins and Right Oppo Soviets aided them
					if = {
						limit = {
							has_template = "International Marxist Brigades"
						}
						delete_unit_template_and_units = {
							division_template = "International Marxist Brigades"
							disband = yes
						}
					}
					if = {
						limit = {
							has_template = "Soviet Special Brigades"
						}
						delete_unit_template_and_units = {
							division_template = "Soviet Special Brigades"
							disband = yes
						}
					}

					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_republicans_flag
						}
						remove_core_of = SPA
						remove_core_of = SPB
						remove_core_of = SPD
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_nationalists_flag
						}
						remove_core_of = SPC
						remove_core_of = SPB
						remove_core_of = SPD
						remove_core_of = SPA
						start_resistance = yes
					}
					118 = {
						if = {
							limit = {
								is_controlled_by = ROOT
							}
							remove_core_of = SPA
							remove_core_of = SPB
							remove_core_of = SPD
							add_core_of = ROOT
						}
						else = {
							remove_claim_by = SPB
							remove_claim_by = SPA
							remove_claim_by = SPD
							add_claim_by = SPC
						}
					}
				}
				if = {
					limit = {
						tag = SPD
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_republicans_flag
						}
						remove_core_of = SPA
						remove_core_of = SPB
						remove_core_of = SPC
					}
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
							has_state_flag = SPR_sided_with_nationalists_flag
						}
						remove_core_of = SPD
						remove_core_of = SPB
						remove_core_of = SPC
						remove_core_of = SPA
						start_resistance = yes
					}
					118 = {
						if = {
							limit = {
								is_controlled_by = ROOT
							}
							remove_core_of = SPA
							remove_core_of = SPB
							remove_core_of = SPC
							add_core_of = ROOT
						}
						else = {
							remove_claim_by = SPA
							remove_claim_by = SPB
							remove_claim_by = SPC
							add_claim_by = SPD
						}
					}
				}
				remove_ideas = SPR_death_before_surrender
				add_timed_idea = { idea = SPA_recovering_from_civil_war days = 2190 }
				if = {
					limit = {
						has_idea = SPR_anarchist_public_transport
					}
					remove_ideas = SPR_anarchist_public_transport
				}
				if = {
					limit = {
						has_idea = SPR_the_maximum_concession
					}
					remove_ideas = SPR_the_maximum_concession
				}
				if = {
					limit = {
						has_idea = SPR_international_brigades
					}
					remove_ideas = SPR_international_brigades
				}
				if = {
					limit = {
						has_idea = SPR_soviet_military_advisors
					}
					remove_ideas = SPR_soviet_military_advisors
				}
				every_state = {
					limit = {
						OR = {
							state = 41
							state = 165
							state = 166
							state = 167
							state = 168
							state = 169
							state = 170
							state = 171
							state = 172
							state = 173
							state = 174
							state = 175
							state = 176
							state = 649
							state = 552
							state = 544
							state = 540
							state = 494
							state = 493
							state = 492
						}
					}
					remove_dynamic_modifier = {
						modifier = unplanned_offensive
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_expand_soviet_aid
					}
					SOV = {
						country_event = { id = lar_spain.81 hours = 6 }
					}
					country_event = { id = lar_spain.82 hours = 6 }
				}
			}
		}
	}
	
	option = {
		name = lar_news.2.a
		trigger = {
			country_exists = SPC
			SPC = { has_capitulated = no }
			NOT = { tag = SPC }
			NOT = { original_tag = SPR }
			SPC = { has_completed_focus = SPR_regional_defense_council_of_aragon }
		}
	}
	option = {
		name = lar_news.2.b
		trigger = {
			NOT = { tag = SOV }
			NOT = { original_tag = SPR }
			NOT = {
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
			}
			NOT = {
				is_in_faction_with = SOV
				AND = {
					is_in_faction_with = MEX
					MEX = {
						has_country_leader = {
 							character = MEX_leon_trotsky
 						}
					}
				}
			}
			has_government = communism
			country_exists = SPC
			SPC = { has_capitulated = no }
			NOT = { tag = SPC }
			SPC = { has_completed_focus = SPR_hinder_nkvd_interference }
		}
	}
	option = {
		name = lar_news.2.c
		trigger = {
			NOT = { tag = SOV }
			NOT = { original_tag = SPR }
			NOT = {
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
			}
			NOT = {
				is_in_faction_with = SOV
				AND = {
					is_in_faction_with = MEX
					MEX = {
						has_country_leader = {
 							character = MEX_leon_trotsky
 						}
					}
				}
			}
			NOT = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
			NOT = { has_government = communism }
			country_exists = SPC
			SPC = { has_capitulated = no }
			NOT = { tag = SPC }
			SPC = { has_completed_focus = SPR_hinder_nkvd_interference }
		}
	}
	option = {
		name = lar_news.2.d
		trigger = {
			NOT = { original_tag = SPR }
			OR = {
				tag = SOV
				is_in_faction_with = SOV
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
				AND = {
					is_in_faction_with = MEX
					MEX = {
						has_country_leader = {
 							character = MEX_leon_trotsky
 						}
					}
				}
			}
			country_exists = SPC
			SPC = { has_capitulated = no }
			NOT = { tag = SPC }
			SPC = { has_completed_focus = SPR_hinder_nkvd_interference }
		}
	}
	option = {
		name = lar_news.2.e
		trigger = {
			NOT = { original_tag = SPR }
			NOT = {
				tag = SOV
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
			NOT = {
				has_government = communism
			}
			NOT = {
				SPD = { has_completed_focus = SPR_the_stalinist_doctrine }
				SPD = { has_completed_focus = SPR_expand_soviet_aid }
			}
			country_exists = SPD
			SPD = { has_capitulated = no }
			NOT = { tag = SPD }
		}
	}
	option = {
		name = lar_news.2.f
		trigger = {
			NOT = { original_tag = SPR }
			tag = SOV
			NOT = {
				SPD = { has_completed_focus = SPR_the_stalinist_doctrine }
				SPD = { has_completed_focus = SPR_expand_soviet_aid }
			}
			country_exists = SPD
			SPD = { has_capitulated = no }
			NOT = { tag = SPD }
		}
	}
	option = {
		name = lar_news.2.g
		trigger = {
			NOT = { original_tag = SPR }
			tag = SOV
			OR = {
				SPD = { has_completed_focus = SPR_the_stalinist_doctrine }
				SPD = { has_completed_focus = SPR_expand_soviet_aid }
			}
			country_exists = SPD
			SPD = { has_capitulated = no }
			NOT = { tag = SPD }
		}
	}
	option = {
		name = lar_news.2.h
		trigger = {
			NOT = { original_tag = SPR }
			NOT = { has_government = communism }
			NOT = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
			OR = {
				SPD = { has_completed_focus = SPR_the_stalinist_doctrine }
				SPD = { has_completed_focus = SPR_expand_soviet_aid }
			}
			country_exists = SPD
			SPD = { has_capitulated = no }
			NOT = { tag = SPD }
		}
	}
	option = {
		name = lar_news.1.e
		trigger = {
			NOT = { original_tag = SPR }
			OR = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
			country_exists = SPD
			SPD = { has_capitulated = no }
			NOT = { tag = SPD }
		}
	}
	option = {
		name = lar_news.1.f
		trigger = {
			OR = {
				tag = SPD
				tag = SPC
			}
		}
		effect_tooltip = {
			if = {
				limit = {
					tag = SPC
					SPC = { has_completed_focus = SPR_regional_defense_council_of_aragon }
				}
				set_global_flag = { flag = SPR_anarchist_victory_timer_flag value = 1 days = 365 }
			}
			delete_unit_template_and_units = {
				division_template = "Guarnición Republicana"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "División de la Guardia de Asalto"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Brigada de la Guardia Civil"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Carabineros"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Brigada Popular"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Brigada de Juventudes Sindicales"
				disband = yes
			}
			delete_unit_template_and_units = {
				division_template = "Brigada Anarquista"
				disband = yes
			}
			remove_ideas = SPR_death_before_surrender
			add_timed_idea = { idea = SPA_recovering_from_civil_war days = 2190 }
			if = {
				limit = {
					has_idea = SPR_anarchist_public_transport
				}
				remove_ideas = SPR_anarchist_public_transport
			}
			if = {
				limit = {
					has_idea = SPR_the_maximum_concession
				}
				remove_ideas = SPR_the_maximum_concession
			}
			if = {
				limit = {
					has_idea = SPR_international_brigades
				}
				remove_ideas = SPR_international_brigades
			}
			if = {
				limit = {
					has_idea = SPR_soviet_military_advisors
				}
				remove_ideas = SPR_soviet_military_advisors
			}
			if = {
				limit = {
					tag = SPC
				}
				every_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						has_state_flag = SPR_sided_with_nationalists_flag
					}
					remove_core_of = SPC
					start_resistance = yes
				}
				118 = {
					if = {
						limit = {
							is_controlled_by = ROOT
						}
						add_core_of = ROOT
					}
						else = {
						add_claim_by = SPC
					}
				}
			}
			if = {
				limit = {
					tag = SPD
				}
				every_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						has_state_flag = SPR_sided_with_nationalists_flag
					}
					remove_core_of = SPD
					start_resistance = yes
				}
				118 = {
					if = {
						limit = {
							is_controlled_by = ROOT
						}
						add_core_of = ROOT
					}
					else = {
						add_claim_by = SPD
					}
				}
			}
		}
	}
}
#news event - France - Congress of paris
news_event = {
	id = lar_news.3
	title = lar_news.3.t
	desc = lar_news.3.desc
	picture = GFX_news_event_generic_sign_treaty3
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.3.a
		trigger = {
			capital_scope = {
				is_on_continent = africa #welp
			}
			NOT = { is_in_faction_with = FRA }
		}
	}
	option = {
		name = lar_news.3.b #France and friends
		trigger = {
			is_in_faction_with = FRA
		}
	}
	option = {
		name = lar_news.3.c #everyone else
		trigger = {
			NOT = {
				is_in_faction_with = FRA
				capital_scope = {
					is_on_continent = africa #welp
				}
			}
		}
	}
}

#news event - France - Vichy France regains its northern territories
news_event = {
	id = lar_news.4
	title = lar_news.4.t
	desc = lar_news.4.desc
	picture = GFX_news_event_021
	
	major = yes
	
	is_triggered_only = yes
	option = {
		name = lar_news.4.b #France friends
		trigger = {
			is_in_faction_with = FRA
			NOT = { tag = FRA }
		}
	}
	option = {
		name = lar_news.4.c #everyone else
		trigger = {
			NOT = {
				is_in_faction_with = FRA
				tag = FRA
			}
		}
	}
	option = {
		name = lar_news.4.d #France
		trigger = {
			
			tag = FRA
		}
	}
}

#news event - France - Stresa Front ratified
news_event = {
	id = lar_news.5
	title = lar_news.5.t
	desc = lar_news.5.desc
	picture = GFX_news_event_generic_read_write
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.5.a
		trigger = {
			tag = ITA
		}
	}
	option = {
		name = lar_news.5.b #France friends
		trigger = {
			is_in_faction_with = FRA
			NOT = { 
				tag = FRA 
				tag = ITA
			}
		}
	}
	option = {
		name = lar_news.5.c #everyone else
		trigger = {
			NOT = {
				is_in_faction_with = FRA
				tag = FRA
				tag = ITA
				tag = GER
			}
		}
	}
	option = {
		name = lar_news.5.d #France
		trigger = {
			tag = FRA
		}
	}
	option = {
		name = lar_news.5.e #Germany
		trigger = {
			tag = GER
		}
	}
}

#news event - France - France abandons eastern allies
news_event = {
	id = lar_news.6
	title = lar_news.6.t
	desc = lar_news.6.desc
	picture = GFX_news_event_067
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.6.a
		trigger = {
			OR = {
				tag = CZE
				tag = POL
				tag = ROM
			}
		}
	}
	option = {
		name = lar_news.6.b #France friends
		trigger = {
			is_in_faction_with = FRA
			NOT = { 
				tag = FRA 
				tag = CZE
				tag = POL
				tag = ROM
			}
		}
	}
	option = {
		name = lar_news.6.c #everyone else
		trigger = {
			NOT = {
				is_in_faction_with = FRA
				tag = FRA
				tag = CZE
				tag = POL
				tag = ROM
				tag = GER
				tag = SOV
			}
		}
	}
	option = {
		name = lar_news.6.d #France
		trigger = {
			tag = FRA
		}
	}
	option = {
		name = lar_news.6.e #Germany
		trigger = {
			OR = {
				tag = GER
				tag = SOV
			}
		}
	}
}

#news event - France - France and Germany agree on Spheres of Influence
news_event = {
	id = lar_news.7
	title = lar_news.7.t
	desc = lar_news.7.desc
	picture = GFX_news_event_generic_sign_treaty1
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.7.a
		trigger = {
			OR = {
				tag = HOL
				tag = BEL
				tag = LUX
			}
		}
	}
	option = {
		name = lar_news.7.b #France friends
		trigger = {
			is_in_faction_with = FRA
			NOT = { 
				tag = FRA 
				tag = GER
				tag = HOL
				tag = BEL
				tag = LUX
			}
		}
	}
	option = {
		name = lar_news.7.c #everyone else
		trigger = {
			NOT = {
				is_in_faction_with = FRA
				tag = FRA
				tag = HOL
				tag = BEL
				tag = LUX
				tag = GER
			}
		}
	}
	option = {
		name = lar_news.7.d #France
		trigger = {
			tag = FRA
		}
	}
	option = {
		name = lar_news.7.e #Germany
		trigger = {
			tag = GER
		}
	}
}

#news event - France - royalist claims the Throne
news_event = {
	id = lar_news.8
	title = lar_news.8.t
	desc = lar_news.8.desc
	picture = GFX_news_event_generic_parliament
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.8.a #royalists
		trigger = {
			always = no
		}
	}
	option = {
		name = lar_news.8.b #commies
		trigger = {
			has_government = communism
		}
	}
	option = {
		name = lar_news.8.c #democrats
		trigger = {
			has_government = democratic
		}
	}
	option = {
		name = lar_news.8.e #fascist and non-royalist unaligned
		trigger = {
			OR = {
				has_government = fascism
				has_government = neutrality
			}
		}
	}
	option = {
		name = lar_news.8.d #France
		trigger = {
			tag = FRA
		}
	}
}

#news event - France - Communists force the issue
news_event = {
	id = lar_news.9
	title = lar_news.9.t
	desc = lar_news.9.desc
	picture = GFX_news_event_generic_rally2
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.9.a #unaligned
		trigger = {
			has_government = neutrality
		}
	}
	option = {
		name = lar_news.9.b #commies
		trigger = {
			has_government = communism
			NOT = { tag = FRA }
		}
	}
	option = {
		name = lar_news.9.c #democrats
		trigger = {
			has_government = democratic
		}
	}
	option = {
		name = lar_news.9.e #fascist 
		trigger = {
			has_government = fascism

		}
	}
	option = {
		name = lar_news.9.d #France
		trigger = {
			tag = FRA
		}
	}
}

# News event - Spain - Carlists rise up
news_event = {
	id = lar_news.10
	title = lar_news.10.t
	desc = {
		text = lar_news.10.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_news.10.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_news_event_spr_spanish_civil_war
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.10.a # Carlist
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			tag = SPB
		}
	}
	option = {
		name = lar_news.10.b # Falangist/Francoist or anyone helping them
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			OR = {
				tag = SPA
				SPA = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.10.b_2 # Falangist/Francoist
		trigger = {
			has_global_flag = scw_early_end
			OR = {
				tag = SPA
				tag = SPB
				has_country_flag = SPR_sent_volunteers_to_SPA_flag
			}
		}
	}
	option = {
		name = lar_news.10.c # Republicans/Anarchists/anyone helping them
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			OR = {
				tag = SPD
				tag = SPC
				SPD = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
				SPC = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.10.c_2 # Supporters of Republicans
		trigger = {
			has_global_flag = scw_early_end
			has_country_flag = SPR_sent_volunteers_to_SPD_flag
		}
	}
	option = {
		name = lar_news.10.d # Everyone else
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			NOT = {
				tag = SPA
				tag = SPB
				tag = SPC
				tag = SPD
				SPA = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
				SPD = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.10.d_2 # Everyone else
		trigger = {
			has_global_flag = scw_early_end
			NOT = {
				tag = SPA
				tag = SPB
				has_country_flag = SPR_sent_volunteers_to_SPD_flag
			}
		}
	}
}

# News event - Spain - Anarchists rise up
news_event = {
	id = lar_news.11
	title = lar_news.11.t
	desc = {
		text = lar_news.11.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_news.11.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_news_event_spr_spanish_civil_war
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.11.a # Falangist/Francoist or anyone helping them
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			OR = {
				tag = SPA
				tag = SPB
				SPA = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
				SPB = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.11.b # Republicans/anyone helping them
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			OR = {
				tag = SPD
				SPD = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.11.b_2 # Republican/Anarchist
		trigger = {
			has_global_flag = scw_early_end
			OR = {
				tag = SPD
				tag = SPC
				has_country_flag = SPR_sent_volunteers_to_SPD_flag
			}
		}
	}
	option = {
		name = lar_news.11.c # Anarchists
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			tag = SPC
		}
	}
	option = {
		name = lar_news.10.c_2 # Supporters of Nationalists
		trigger = {
			has_global_flag = scw_early_end
			has_country_flag = SPR_sent_volunteers_to_SPA_flag
		}
	}
	option = {
		name = lar_news.11.d # Everyone else
		trigger = {
			NOT = { has_global_flag = scw_early_end }
			NOT = {
				tag = SPA
				tag = SPB
				tag = SPC
				tag = SPD
				SPA = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
				SPB = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
				SPD = {
					has_volunteers_amount_from = {
					    tag = ROOT
					    count > 0
					}
				}
			}
		}
	}
	option = {
		name = lar_news.10.d_2 # Everyone else
		trigger = {
			has_global_flag = scw_early_end
			NOT = {
				tag = SPD
				tag = SPC
				has_country_flag = SPR_sent_volunteers_to_SPA_flag
			}
		}
	}
}

# News event - Spain joins the Axis
news_event = {
	id = lar_news.13
	title = lar_news.12.t
	desc = lar_news.13.desc
	picture = GFX_news_event_generic_read_write
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.12.a # Spain
		trigger = {
			original_tag = SPR
		}
	}
	option = {
		name = lar_news.12.b # Axis
		trigger = {
			any_other_country = {
				original_tag = SPR
				is_in_faction_with = ROOT
			}
		}
	}
	option = {
		name = lar_news.12.c # Enemies
		trigger = {
			any_other_country = {
				has_war_with = ROOT
				OR = {
					is_in_faction_with = SPD
					is_in_faction_with = SPA
				}
			}
		}
	}
	option = {
		name = lar_news.12.d # Everyone else
		trigger = {
			NOT = {
				original_tag = SPR
				any_other_country = {
					original_tag = SPR
					is_in_faction_with = ROOT
				}
				any_other_country = {
					has_war_with = ROOT
					OR = {
						is_in_faction_with = SPD
						is_in_faction_with = SPA
					}
				}
			}
		}
	}
}

# News event - Franco-Spanish Union
news_event = {
	id = lar_news.15
	title = lar_news.15.t
	desc = lar_news.15.desc
	picture = GFX_news_event_generic_sign_treaty3
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.15.a # Spain
		trigger = {
			original_tag = SPR
		}
	}
	option = {
		name = lar_news.15.b # France
		trigger = {
			original_tag = FRA
		}
	}
	option = {
		name = lar_news.15.c # Everyone else
		trigger = {
			NOT = {
				original_tag = SPR
				original_tag = FRA
			}
		}
	}
}
# News event - Francoist Spanish monarchy restoration
news_event = {
	id = lar_news.18
	title = lar_news.17.t
	desc = lar_news.18.desc
	picture = GFX_news_event_royal_visit
	
	major = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					original_tag = SPR
				}
				if = {
					limit = {
						has_country_flag = SPB_xavier_king
					}
					create_country_leader = {
						name = "Javier I"
						desc = "POLITICS_JAVIER_I_DESC"
						picture = "GFX_portrait_SPA_xavier_of_bourbon_parma"
						expire = "1965.1.1"
						ideology = despotism
						traits = {
							the_sacred_king
						}
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = SPB_xavier_king }
						NOT = { has_global_flag = SPB_alfonso_xiii_dead }
					}
					create_country_leader = {
						name = "Alfonso XIII"
						desc = "POLITICS_ALFONSO_XIII_DESC"
						picture = "GFX_portrait_SPA_alfonso_xiii"
						expire = "1965.1.1"
						ideology = despotism
						traits = {
							disgraced_monarch
						}
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = SPB_xavier_king }
						has_global_flag = SPB_alfonso_xiii_dead
					}
					create_country_leader = {
						name = "Jaime IV"
						desc = "POLITICS_JAIME_IV_DESC"
						picture = "GFX_portrait_fra_infante_jaime"
						expire = "1965.1.1"
						ideology = despotism
						traits = {
							the_legitimist
						}
					}
				}
			}
		}
	}
	
	option = {
		name = lar_news.18.a # Spain
		trigger = {
			original_tag = SPR
		}
		effect_tooltip = {
			if = {
				limit = {
					has_country_flag = SPB_xavier_king
				}
				create_country_leader = {
					name = "Javier I"
					desc = "POLITICS_JAVIER_I_DESC"
					picture = "GFX_portrait_SPA_xavier_of_bourbon_parma"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						the_sacred_king
					}
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = SPB_xavier_king }
					NOT = { has_global_flag = SPB_alfonso_xiii_dead }
				}
				create_country_leader = {
					name = "Alfonso XIII"
					desc = "POLITICS_ALFONSO_XIII_DESC"
					picture = "GFX_portrait_SPA_alfonso_xiii"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						disgraced_monarch
					}
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = SPB_xavier_king }
					has_global_flag = SPB_alfonso_xiii_dead
				}
				create_country_leader = {
					name = "Jaime IV"
					desc = "POLITICS_JAIME_IV_DESC"
					picture = "GFX_portrait_fra_infante_jaime"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						the_legitimist
					}
				}
			}
		}
	}
	option = {
		name = lar_news.18.b # Everyone else
		trigger = {
			NOT = {
				original_tag = SPR
			}
		}
	}
}

# News event - Latin Bloc
news_event = {
	id = lar_news.19
	title = lar_news.19.t
	desc = lar_news.19.desc
	picture = GFX_news_event_generic_sign_treaty1
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.19.a # Spain or new allies
		trigger = {
			is_in_faction_with = SPA
		}
	}
	option = {
		name = lar_news.19.b # Everyone else
		trigger = {
			NOT = {
				is_in_faction_with = SPA
			}
		}
	}
}

# News event - Independence War
news_event = {
	id = lar_news.20
	title = lar_news.20.t
	desc = lar_news.20.desc
	picture = GFX_news_event_generic_parliament
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.20.a # Spain
		trigger = {
			original_tag = SPR
		}
	}
	option = {
		name = lar_news.20.b # Soviet Union
		trigger = {
			original_tag = SOV
		}
	}
	option = {
		name = lar_news.20.c # Other enemies of Soviet Union
		trigger = {
			NOT = { original_tag = SPR }
			has_war_with = SOV
		}
	}
	option = {
		name = lar_news.20.d # Everyone else
		trigger = {
			NOT = {
				original_tag = SOV
				has_war_with = SOV
				original_tag = SPR
			}
		}
	}
}

# News event - London Bureau
news_event = {
	id = lar_news.21
	title = lar_news.21.t
	desc = lar_news.21.desc
	picture = GFX_news_event_sign_treaty2
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.21.a # Spain
		trigger = {
			original_tag = SPR
		}
	}
	option = {
		name = lar_news.21.b # Soviet Union and MEX if they have Trotsky
		trigger = {
			OR = {
				tag = SOV
				is_in_faction_with = SOV
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
				AND = {
					is_in_faction_with = MEX
					MEX = {
						has_country_leader = {
 							character = MEX_leon_trotsky
 						}
					}
				}
			}
		}
	}
	option = {
		name = lar_news.21.c # Unaligned Communists
		trigger = {
			has_government = communism
			NOT = { tag = SOV }
			NOT = {
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
			}
			NOT = {
				is_in_faction_with = SOV
				AND = {
					is_in_faction_with = MEX
					MEX = {
						has_country_leader = {
 							character = MEX_leon_trotsky
 						}
					}
				}
			}
		}
	}
	option = {
		name = lar_news.21.d # Everyone else
		trigger = {
			NOT = {
				has_government = communism
				original_tag = SOV
				AND = {
					tag = MEX
					has_country_leader = {
 						character = MEX_leon_trotsky
 					}
				}
				original_tag = SPR
			}
		}
	}
}

# News event - Nationalist Victory but Carlists might still rise up
news_event = {
	id = lar_news.28
	title = lar_news.28.t
	desc = lar_news.28.desc
	picture = GFX_news_event_033
	
	major = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_global_flag = scw_early_end
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
					has_state_flag = SPR_sided_with_nationalists_flag
				}
				remove_core_of = SPC
				remove_core_of = SPD
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
					has_state_flag = SPR_sided_with_republicans_flag
				}
				remove_core_of = SPC
				remove_core_of = SPD
			}
			118 = {
				if = {
					limit = {
						is_controlled_by = ROOT
					}
					add_core_of = ROOT
					remove_core_of = SPD
					remove_core_of = SPC
				}
				else = {
					add_claim_by = SPA
					remove_claim_by = SPC
					remove_claim_by = SPD
				}
			}
		}
	}

	option = {
		name = lar_news.28.a
		trigger = {
			OR = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
		}
	}

	option = {
		name = lar_news.28.b
		trigger = {
			NOT = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
				tag = SOV
				tag = SPA
			}
		}
	}

	option = {
		name = lar_news.28.c
		trigger = {
			tag = SOV
		}
	}

	option = {
		name = lar_news.28.d
		trigger = {
			tag = SPA
			has_completed_focus = SPA_the_phalanx_ascendant
		}
		#effect_tooltip = {
		#	every_state = {
		#		limit = {
		#			has_state_flag = SPR_sided_with_republicans_flag
		#		}
		#		remove_core_of = ROOT
		#		start_resistance = yes
		#	}
		#}
	}

	option = {
		name = lar_news.28.e
		trigger = {
			tag = SPA
			has_completed_focus = SPA_unify_the_nationalist_front
		}
		#effect_tooltip = {
		#	every_state = {
		#		limit = {
		#			has_state_flag = SPR_sided_with_republicans_flag
		#		}
		#		remove_core_of = ROOT
		#		start_resistance = yes
		#	}
		#}
	}

	option = {
		name = lar_news.28.f
		trigger = {
			tag = SPA
			has_completed_focus = SPA_supremacy_of_the_communion
		}
		#effect_tooltip = {
		#	every_state = {
		#		limit = {
		#			has_state_flag = SPR_sided_with_republicans_flag
		#		}
		#		remove_core_of = ROOT
		#		start_resistance = yes
		#	}
		#}
	}
}

# News event - Republican Victory but Anarchists might still rise up
news_event = {
	id = lar_news.29
	title = lar_news.29.t
	desc = lar_news.29.desc
	picture = GFX_news_event_033
	
	major = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_global_flag = scw_early_end
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
					has_state_flag = SPR_sided_with_republicans_flag
				}
				remove_core_of = SPA
				remove_core_of = SPB
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
					has_state_flag = SPR_sided_with_nationalists_flag
				}
				remove_core_of = SPB
				remove_core_of = SPA
			}
			118 = {
				if = {
					limit = {
						is_controlled_by = ROOT
					}
					add_core_of = ROOT
					remove_core_of = SPA
					remove_core_of = SPB
				}
				else = {
					add_claim_by = SPD
					remove_claim_by = SPA
					remove_claim_by = SPB
				}
			}
		}
	}

	option = { #GER/ITA
		name = lar_news.28.c
		trigger = {
			OR = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
			}
		}
	}

	option = {
		name = lar_news.28.b
		trigger = {
			NOT = {
				AND = {
					tag = GER
					has_government = fascism
				}
				AND = {
					tag = ITA
					has_government = fascism
				}
				tag = SPD
				tag = SOV
			}
		}
	}

	option = { #SOV
		name = lar_news.28.a
		trigger = {
			tag = SOV
		}
	}

	option = { # SPC
		name = lar_news.29.d
		trigger = {
			tag = SPD
			OR = {
				has_completed_focus = SPR_regional_defense_council_of_aragon
				has_completed_focus = SPR_hinder_nkvd_interference
			}
		}
		#effect_tooltip = {
		#	every_state = {
		#		limit = {
		#			has_state_flag = SPR_sided_with_nationalists_flag
		#		}
		#		remove_core_of = ROOT
		#		start_resistance = yes
		#	}
		#}
	}

	option = { # SPD
		name = lar_news.29.e
		trigger = {
			tag = SPD
			OR = {
				has_completed_focus = SPR_maintain_the_second_republic
				has_completed_focus = SPR_the_stalinist_doctrine
			}
		}
		#effect_tooltip = {
		#	every_state = {
		#		limit = {
		#			has_state_flag = SPR_sided_with_nationalists_flag
		#		}
		#		remove_core_of = ROOT
		#		start_resistance = yes
		#	}
		#}
	}
}

#Polynesia United
news_event = {
	id = lar_news.291
	title = lar_news.291.t
	desc = {
		text = lar_news.291.new_zealand_desc
		trigger = {
			FROM = {
				original_tag = NZL
			}
		}
	}
	desc = {
		text = lar_news.291.desc
		trigger = {
			FROM = {
				NOT = { original_tag = NZL }
			}
		}
	}
	picture = GFX_news_event_generic_parliament
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = lar_news.291.a
		trigger = {
			tag = FROM
		}
	}
	option = {
		name = lar_news.291.b
		trigger = {
			NOT = { tag = FROM }
		}
	}
}

add_namespace = occupied_countries

# create uprising
country_event = {
	id = occupied_countries.2
	
	is_triggered_only = yes
	
	hidden = yes
	
	immediate = {
		FROM = {
			if = {
				limit = {
					has_core_occupation_modifier = {
						occupied_country_tag = FROM
						modifier = resistance_90
					}
				}
				
				set_temp_variable = { occupier_country = THIS }
				set_temp_variable = { occupied_country = FROM }
				set_temp_variable = { new_occupied_country = FROM }
				
				if = { #warsaw achievement
					limit = {
						var:occupied_country = { original_tag = POL }
					}
					set_global_flag = warsaw_liberated_self_flag
				}
				
				
				set_temp_variable = { civil_war_country_picked = 0 }
				if = {
					## pick an existing civil war country
					limit = {
						FROM = {
							tag = PREV
						}
					}
					
					random_country_with_original_tag = {
						original_tag_to_check = var:occupier_country
						
						limit = {
							NOT = { tag = var:occupier_country }
							has_war_with = var:occupier_country
						}
						
						set_temp_variable = { civil_war_country_picked = 1 }
						set_temp_variable = { new_occupied_country = this }
					}
				}
				
				if = {
					## create a new country if necesarry
					limit = {
						check_variable = { civil_war_country_picked = 0 } 
						FROM = {
							#if resistance country exists and not at war with occupier (whitepaced/subjected etc) create a country instead
							exists = yes
							NOT = { has_war_with = occupier_country }
						}
					}
					create_dynamic_country = {
						original_tag = FROM
						copy_tag = FROM
						
						set_temp_variable = { new_occupied_country = THIS }
					}
				}
				
				
				# change ideology if necessary
				if = {
					limit = { 
						var:occupied_country = {
							#only change ideology if we are not creating a new country and old country is not existing
							NOT = { original_tag = SOV } #Soviet Union should always be communist
							OR = {
								exists = no
								NOT = { tag = new_occupied_country }
							}
						}
					}
					
					# booleans that will be allowed to change ideology
					set_temp_variable = { allowed_party_neutrality = 1 }
					set_temp_variable = { allowed_party_democratic = 1 }
					set_temp_variable = { allowed_party_fascism = 1 }
					set_temp_variable = { allowed_party_communism = 1 }
					
					# do not change ideology of occupier country
					var:occupier_country = {
						remove_from_allowed_party = yes
					}
					
					if = {
						# if occupied country exists and different than new country
						# it is white peaced & subject of occupier. ignore its ideology as well
						limit = { NOT = { check_variable = { new_occupied_country = occupied_country } } }
						var:occupied_country = {
							remove_from_allowed_party = yes
						}
					}
					
					# change government if necesarry
					var:new_occupied_country = {
						random_list = {
							allowed_party_democratic = {
								set_popularities = {
									democratic = 100
								}
								set_politics = { ruling_party = democratic elections_allowed = yes }
							}
							allowed_party_fascism = {
								set_popularities = {
									fascism = 100
								}
								set_politics = { ruling_party = fascism elections_allowed = no }
							}
							allowed_party_communism = {
								set_popularities = {
									communism = 100
								}
								set_politics = { ruling_party = communism elections_allowed = no }
							}
							allowed_party_neutrality = {
								set_popularities = {
									neutrality = 100
								}
								set_politics = { ruling_party = neutrality elections_allowed = no }
							}
						}
					}
				}
				
				# create resistance template for armies to spawn
				var:new_occupied_country = {
					if = {
						limit = { NOT = { has_country_flag = created_civil_war_template } }
						set_country_flag = created_civil_war_template
							
						division_template = {
							name = "Resistance"
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
					
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								
								infantry = { x = 2 y = 0 }
								infantry = { x = 2 y = 1 }
							}
						}
					}
				}
				
				
				clear_temp_array = checked_neighbours
				every_controlled_state = {
					limit = { 
						occupied_country_tag = occupied_country 
						impassable = no
					}
					
					# move our armies to back home
					teleport_armies = {
						limit = { 
							OR = {
								is_ally_with = occupier_country
								has_military_access_to = occupier_country
							}
						}
						to_state_array = owned_controlled_states
					}
					
					# transfer state
					if = {
						limit = { has_resistance = yes }
						set_resistance = 0
					}
					var:new_occupied_country = {
						transfer_state = PREV
					}
					
					if = {
						limit = { 
							var:occupier_country = {
								check_variable = { resistance_already_inited@var:occupied_country = 0 } 
							}
						}
						
						# create resistance units, number is relative to size of industry
						set_temp_variable = { num_units_to_create = building_level@arms_factory }
						add_to_temp_variable = { num_units_to_create = building_level@industrial_complex } 
						divide_temp_variable = { num_units_to_create = 3 }
						add_to_temp_variable = { num_units_to_create = 2 }
						round_temp_variable = num_units_to_create
						clamp_temp_variable = { var = num_units_to_create min = 2 max = 6 }
						for_loop_effect = {
							end = num_units_to_create
							
							create_unit = {
								division = "division_template = \"Resistance\" start_experience_factor = 1 start_equipment_factor = 1"
								owner = new_occupied_country
							}
						}
					}
					
					# also check neighbouring core states of the occupier that are not captured yet
					# move our armies so they are not surrounded/create pockets
					every_neighbor_state = {
						limit = {
							is_owned_and_controlled_by = occupied_country
							is_core_of = occupied_country
							not = { is_in_array = { checked_neighbours = this } }
						}
						add_to_temp_array = { checked_neighbours = this }
						
						teleport_armies = {
							limit = { 
								OR = {
									is_ally_with = occupier_country
									has_military_access_to = occupier_country
								}
							}
							to_state_array = owned_controlled_states
						}
						
						set_state_province_controller = {
							controller = occupied_country
							limit = {
								is_ally_with = occupier_country
							}
						}
					}
				}
			
				# create war if necesarry
				if = {
					limit = { NOT = { has_war_with = new_occupied_country } }
					declare_war_on = { target = new_occupied_country type = annex_everything }
				}
				
				var:occupier_country = {
					set_variable = { resistance_already_inited@var:occupied_country = 1 } 
				}
			
			}
		}
	}
}

# fuck portugal

add_namespace = lar_spain 

# Election of 1936 - La Resistance Edition
country_event = {
	id = lar_spain.1
	title = spain.9.t
	desc = lar_spain.1.desc
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes

	fire_only_once = yes

	trigger = {
		tag = SPR
		has_dlc = "La Resistance"
	}

	immediate = {
		hidden_effect = {
			set_country_flag = SPR_spanish_elections_flag
			if = {
				limit = {
					focus_progress = {
						focus = SPR_the_popular_front
						progress > 0
					}
					NOT = { has_completed_focus = SPR_the_popular_front }
				}
				complete_national_focus = SPR_the_popular_front
				add_political_power = -35
			}
			if = {
				limit = {
					focus_progress = {
						focus = SPA_a_great_spain
						progress > 0
					}
					NOT = { has_completed_focus = SPA_a_great_spain }
				}
				complete_national_focus = SPA_a_great_spain
				add_political_power = -35
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_popular_front
				}
				activate_mission = SPA_hand_over_the_ceda_campaign_chest_mission
				activate_mission = SPR_military_plot_republicans
				hidden_effect = {
					country_event = { id = lar_spain.4 } # Nationalists working against the government
					country_event = { id = lar_spain.5 }
					activate_mission = SPR_military_plot_republicans
					add_ideas = SPR_government_power_struggle
				}
			}
			if = {
				limit = {
					has_completed_focus = SPA_a_great_spain
				}
				random_list = {
					10 = {
						activate_mission = SPR_secure_the_guardia_de_asalto_mission
					}
					10 = {
						modifier = {
							factor = 0
							is_historical_focus_on = yes
						}
						activate_mission = SPR_secure_the_guardia_civil_mission
					}
				}
				activate_mission = SPA_military_plot_nationalists
				hidden_effect = {
					country_event = { id = lar_spain.3 } # Government working against the nationalists
					country_event = { id = lar_spain.5 days = 20 random_days = 10 }
					activate_mission = SPA_military_plot_nationalists
				}
			}
			every_state = {
				limit = {
					is_core_of = SPR
				}
				add_core_of = SPA
			}
		}
	}

	# Popular Front
	option = {
		name = lar_spain.1.a
		trigger = {
			NOT = {
				has_completed_focus = SPA_a_great_spain
			}
		}
		add_popularity = {
			ideology = communism
			popularity = 0.1
		}
		add_political_power = 5
		if = {
			limit = {
				NOT = {
					has_completed_focus = SPR_the_popular_front
				}
			}
			complete_national_focus = SPR_the_popular_front
			add_political_power = -35
			activate_mission = SPR_military_plot_republicans
			hidden_effect = {
				country_event = { id = lar_spain.4 days = 4 } # Nationalists working against the government
				country_event = { id = lar_spain.5 }
				activate_mission = SPR_military_plot_republicans
				if = {
					limit = {
						NOT = { has_active_mission = SPA_hand_over_the_ceda_campaign_chest_mission }
					}
					activate_mission = SPA_hand_over_the_ceda_campaign_chest_mission
				}
			}
		}
		effect_tooltip = { add_ideas = SPR_government_power_struggle }
		custom_effect_tooltip = SPR_republican_garrison_control_decisions_tt
	}

	# Falange
	option = {
		name = lar_spain.1.b
		trigger = {
			NOT = {
				has_completed_focus = SPR_the_popular_front
			}
		}
		add_popularity = {
			ideology = fascism
			popularity = 0.1
		}
		if = {
			limit = {
				NOT = {
					has_completed_focus = SPA_a_great_spain
				}
			}
			complete_national_focus = SPA_a_great_spain
			add_political_power = -35
			activate_mission = SPA_military_plot_nationalists
			hidden_effect = {
				country_event = { id = lar_spain.3 } # Government working against the nationalists
				country_event = { id = lar_spain.5 days = 20 random_days = 10 }
				activate_mission = SPA_military_plot_nationalists
				if = {
					limit = {
						NOT = {
							has_active_mission = SPR_secure_the_guardia_de_asalto_mission
							has_active_mission = SPR_secure_the_guardia_civil_mission
						}
					}
					random_list = {
						10 = {
							activate_mission = SPR_secure_the_guardia_de_asalto_mission
						}
						10 = {
							modifier = {
								factor = 0
								is_historical_focus_on = yes
							}
							activate_mission = SPR_secure_the_guardia_civil_mission
						}
					}
				}
			}
		}
		custom_effect_tooltip = SPA_nationalist_garrison_control_decisions_tt
	}
}

# Spanish Civil War - La Resistance Edition
country_event = {
	id = lar_spain.2
	title = lar_spain.2.t
	desc = lar_spain.2.desc
	picture = GFX_report_event_spain_civil_war_soldiers
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_owned_state = {
				limit = {
					is_core_of = ROOT
				}
				set_state_flag = SPR_core_of_spain_flag
			}
			set_global_flag = { flag = SPR_civil_war_startup value = 1 days = 3 } # Make AI avoid attacking for a few days
		}

#  #  ##  ### ###  ##  #  #  ##  #   ###  ## ###     ### ### ### ###  ##  ### 
## # #  #  #   #  #  # ## # #  # #    #  #    #      #   #   #   #   #  #  #  
# ## ####  #   #  #  # # ## #### #    #   #   #      ##  ##  ##  ##  #     #  
#  # #  #  #   #  #  # #  # #  # #    #    #  #      #   #   #   #   #  #  #  
#  # #  #  #  ###  ##  #  # #  # ### ### ##   #      ### #   #   ###  ##   #  

		if = {
			limit = {
				has_completed_focus = SPA_a_great_spain
			}
			hidden_effect = {
				SPA = { # Switch the tag alias for SPA - it now becomes SPD - the republicans
					clr_country_flag = SPR_nationalist_spain_flag
					drop_cosmetic_tag = yes
					set_country_flag = SPR_republican_spain_flag
					set_cosmetic_tag = SPR_republican_spain
					set_politics = {
						ruling_party = democratic
					}
					set_popularities = {
						democratic = 50
						neutrality = 11
						communism = 39
					}
					retire_ideology_leader = democratic
					retire_ideology_leader = neutrality
					retire_ideology_leader = communism
				}
				SPD = { # Remove Carlist/Falangist country leaders for new SPD tag
					retire_ideology_leader = fascism
					retire_ideology_leader = neutrality
					create_country_leader = {
						name = "Manuel Azaña"
						desc = "POLITICS_MANUEL_AZANA_DESC"
						picture = "Portrait_Spain_Manuel_Azana.dds"
						expire = "1965.1.1"
						ideology = conservatism
						traits = {
							figurehead_president
						}
					}
				}
				# Switch the tag alias for the player's country - the player goes from SPR to SPA
				set_country_flag = SPR_nationalist_spain_flag
				set_cosmetic_tag = SPR_nationalist_spain
				set_politics = {
					ruling_party = neutrality
				}
				add_popularity = {
				    ideology = democratic
				    popularity = -0.25
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.1
				}
				kill_country_leader = yes
				create_country_leader = {
					name = "José Sanjurjo"
					desc = "POLITICS_JOSE_SANJURJO_DESC"
					picture = "GFX_portrait_SPA_jose_sanjurjo"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						the_lion_of_the_rif
					}
				}
				# Add Nationalist and Republican Garrison division templates
				division_template = {
					name = "Guarnición Nacionalista"
					is_locked = yes
					template_counter = 6
					division_names_group = SPR_INF_02
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				SPD = {
					division_template = {
						name = "Guarnición Republicana"
						is_locked = yes
						template_counter = 6
						division_names_group = SPD_INF_01
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
				}
				# Give SPD Madrid if the Nationalists don't have complete garrison control over it - becomes capital
				if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 1 compare = equals }
						}
					}
					SPD = {
						transfer_state = 41
					}
					41 = {
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 3
						}
					}
				}
				else_if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 2 compare = equals }
						}
					}
					SPD = {
						transfer_state = 41
					}
					41 = {
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
				}
				else_if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 3 compare = equals }
						}
					}
					SPD = {
						transfer_state = 41
					}
					41 = {
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
				}
				# If Madrid is controlled by Nationalists, but a random state exists that has total Republican garrison control, give that as capital first
				if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 4 compare = equals }
						}
						any_owned_state = {
							check_variable = { var = SPA_garrison_control value = 1 compare = equals }
						}
					}
					random_owned_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 1 compare = equals }
						}
						SPD = {
							transfer_state = PREV
						}
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 3
						}
					}
				}
				# Give a state that does not have total Nationalist garrison control to the Republicans as their capital - in decreasing order of Republican control
				else_if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 4 compare = equals }
						}
						any_owned_state = {
							check_variable = { var = SPA_garrison_control value = 2 compare = equals }
						}
					}
					random_owned_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = equals }
						}
						SPD = {
							transfer_state = PREV
						}
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
				}
				else_if = {
					limit = {
						41 = {
							check_variable = { var = SPA_garrison_control value = 4 compare = equals }
						}
						any_owned_state = {
							check_variable = { var = SPA_garrison_control value = 3 compare = equals }
						}
					}
					random_owned_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = equals }
						}
						SPD = {
							transfer_state = PREV
						}
						set_state_flag = SPR_sided_with_republicans_flag
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
				}
				# Split equipment and army/navy depending on which focuses the Republicans have finished
				if = {
					limit = {
						NOT = { has_country_flag = SPR_enlarge_the_weapon_caches_flag }
					}
					transfer_units_fraction = {
						target = SPD
						size = 0.5 # Fallback in case one of the ratios below are not stipulated
						stockpile_ratio = 0.5
						army_ratio = 0.5
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							has_trait = trait_SPA_nationalist_sympathies
						}
					}
				}
				if = {
					limit = {
						has_country_flag = SPR_enlarge_the_weapon_caches_flag
						NOT = { has_country_flag = SPR_disband_the_army_flag }
					}
					transfer_units_fraction = {
						target = SPD
						size = 0.5
						stockpile_ratio = 0.8
						army_ratio = 0.5
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							has_trait = trait_SPA_nationalist_sympathies
						}
					}
				}
				if = {
					limit = {
						has_country_flag = SPR_disband_the_army_flag
					}
					transfer_units_fraction = {
						target = SPD
						size = 0.5
						stockpile_ratio = 0.8
						army_ratio = 0.8
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							has_trait = trait_SPA_nationalist_sympathies
						}
					}
				}
				# If player has completed this focus, give North Africa and spawn units there (this effect is run first so the tag has any territory whatsoever - it's assumed all players take this focus)
				if = {
					limit = {
						has_completed_focus = SPA_the_army_of_africa
					}
					division_template = {
						name = "División del Ejército de África"
						template_counter = 4
						division_names_group = SPR_INF_06
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
							infantry = { x = 2 y = 0 }
							artillery_brigade = { x = 2 y = 1 }
							artillery_brigade = { x = 2 y = 2 }
						}
						support = {
							recon = { x = 0 y = 0 }
							engineer = { x = 0 y = 1 }
						}
					}
					290 = {
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						if = {
							limit = {
								ROOT = { NOT = { has_country_flag = SPR_disband_the_army_flag } }
							}
							create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
							create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
						}
					}
				}
				#EASY SCW
				if = {
					limit = {
						has_completed_focus = SPA_the_army_of_africa
						has_game_rule = { rule = no_SPR option = easy_scw }
					}
					division_template = {
						name = "División del Ejército de África"
						template_counter = 4
						division_names_group = SPR_INF_06
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
							infantry = { x = 2 y = 0 }
							infantry = { x = 3 y = 0 }
							infantry = { x = 3 y = 1 }
							infantry = { x = 4 y = 0 }
							infantry = { x = 4 y = 1 }
							artillery_brigade = { x = 2 y = 1 }
							artillery_brigade = { x = 2 y = 2 }
							artillery_brigade = { x = 3 y = 2 }
						}
						support = {
							recon = { x = 0 y = 0 }
							engineer = { x = 0 y = 1 }
						}
					}
					176 = {
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						create_unit = {
							division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
							owner = SPA
						}
						create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
						create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
						}
					}
				}
				# Republicans remove their army
				SPD = {
					delete_units = {
					    division_template = "División de Infantería"
					    disband = yes
					}
					delete_units = {
					    division_template = "División de Caballería"
					    disband = yes
					}
					delete_units = {
					    division_template = "Brigada Montaña"
					    disband = yes
					}
					delete_units = {
					    division_template = "Brigada de Infantería"
					    disband = yes
					}
				}
				# Switch leaders who do not have nationalist sympathies to the Republicans
				every_unit_leader = {
					limit = {
						NOT = { has_trait = trait_SPA_nationalist_sympathies }
					}
					set_nationality = SPD
				}
				# Remove unnecessary traits from Nationalist commanders (no longer relevant to see for the player, as the SCW has started)
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_nationalist_sympathies
					}
					remove_unit_leader_trait = trait_SPA_nationalist_sympathies
				}
				# Add various loyalist traits that now become relevant - indicating loyalties to the different subfactions
				every_unit_leader = {
					limit = {
						OR = {
							has_id = 1108
							has_id = 1109
							has_id = 1111
							has_id = 1112
							has_id = 1113
						}
					}
					add_unit_leader_trait = trait_SPA_falangist_loyalties
				}
				every_unit_leader = {
					limit = {
						OR = {
							has_id = 1114
							has_id = 1115
							has_id = 1116
						}
					}
					add_unit_leader_trait = trait_SPA_carlist_loyalties
				}
				SPD = {
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 1101
								has_id = 1102
								has_id = 1103
							}
						}
						add_unit_leader_trait = trait_SPR_republican_loyalties
					}
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 1104
								has_id = 1105
								has_id = 1106
							}
						}
						add_unit_leader_trait = trait_SPR_stalinist_loyalties
					}
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 1107
							}
						}
						add_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
					}
				}
				# Add 3 Republican garrisons to every state where the Nationalists have NONE control
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 1 compare = equals }
						NOT = {
							state = 290
							state = 699
							state = 506
							state = 297
						}
					}
					# Transfer states and set flag to prepare for post-Civil War de-coring
					SPD = {
						transfer_state = PREV
					}
					set_state_flag = SPR_sided_with_republicans_flag
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 3
					}
				}
				41 = { # Extra 6 divisions to make Madrid harder to capture (as historically)
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 6
					}
				}
				# Add 3 Nationalist garrisons to every state where the Nationalists have TOTAL control
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 4 compare = equals }
					}
					create_unit = {
						division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
						owner = SPA
						allow_spawning_on_enemy_provs = yes
						count = 3
					}
				}
				# Trigger war between the sides - necessary because the next effects spawn units on contested provinces and this requires both sides to be at war
				SPA = {
					declare_war_on = {
					    target = SPD
					    type = civil_war
					}
					add_civil_war_target = SPD
				}
				# 2 Republican and 1 Nationalist garrisons spawned on all states with WEAK Nationalist control (except for Northern Garrison states)
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 2 compare = equals }
						NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
					}
					# Transfer states and set flag to prepare for post-Civil War de-coring
					SPD = {
						transfer_state = PREV
					}
					set_state_flag = SPR_sided_with_republicans_flag
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 2
					}
					create_unit = {
						division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
						owner = SPA
						allow_spawning_on_enemy_provs = yes
						count = 1
					}
				}
				# 2 Nationalist and 1 Republican garrisons spawned on all states with STRONG Nationalist control
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 3 compare = equals }
						NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
					}
					# Transfer states and set flag to prepare for post-Civil War de-coring
					SPD = {
						transfer_state = PREV
					}
					set_state_flag = SPR_sided_with_republicans_flag
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 1
					}
					create_unit = {
						division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
						owner = SPA
						allow_spawning_on_enemy_provs = yes
						count = 2
					}
				}
				# If Negotiate Carlist Support has been taken, add Nationalist units in Navarra
				if = {
					limit = {
						has_country_flag = SPA_negotiate_carlist_support_flag
						OR = {
							is_ai = no
							is_historical_focus_on = no
						}
					}
					division_template = {
						name = "Requeté Carlista"
						template_counter = 8
						division_names_group = SPR_INF_03
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
					172 = {
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 5
						}
					}
				}
				# If Negotiate Carlist Support has been taken AND AI, add Nationalist units in Navarra AND Western Aragon
				if = {
					limit = {
						has_country_flag = SPA_negotiate_carlist_support_flag
						is_ai = yes
						is_historical_focus_on = yes
					}
					division_template = {
						name = "Requeté Carlista"
						template_counter = 8
						division_names_group = SPR_INF_03
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
					172 = {
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					166 = {
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPA
							prioritize_location = 3816
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
				}
				# If Republicans secured the Guardia Civil, add Civil divisions to random states for the Republicans, and Asalto divisions to random states for the Nationalists
				if = {
					limit = {
						has_country_flag = SPR_secure_the_guardia_civil_flag
					}
					division_template = {
						name = "División de la Guardia de Asalto"
						template_counter = 5
						division_names_group = SPR_INF_05
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
					SPD = {
						division_template = {
							name = "Brigada de la Guardia Civil"
							template_counter = 7
							division_names_group = SPR_INF_04
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
				}
				# If Republicans secured the Guardia de Asalto, do the opposite distribution
				else_if = {
					limit = {
						has_country_flag = SPR_secure_the_guardia_de_asalto_flag
					}
					division_template = {
						name = "Brigada de la Guardia Civil"
						template_counter = 7
						division_names_group = SPR_INF_04
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					SPD = {
						division_template = {
							name = "División de la Guardia de Asalto"
							template_counter = 5
							division_names_group = SPR_INF_05
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
				}
				else = { #Extra backup in case player never took any focuses - SPA gets BOTH types! Suck on it, Reds!
					division_template = {
						name = "División de la Guardia de Asalto"
						template_counter = 5
						division_names_group = SPR_INF_05
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
						}
					}
					division_template = {
						name = "Brigada de la Guardia Civil"
						template_counter = 7
						division_names_group = SPR_INF_04
						is_locked = yes
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
	
					#Guardia de Asalto
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
	
					# Guardia Civil
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
				}
				# If Republicans had time to Train the Union Youth, add these divisions to random states that have at MOST WEAK Nationalist control
				if = {
					limit = {
						has_country_flag = SPR_train_the_union_youth_flag
					}
					SPD = {
						division_template = {
							name = "Brigada de Juventudes Sindicales"
							template_counter = 0
							division_names_group = SPD_INF_02
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
				}
				# If Republicans had time to Distribute Arms to the People, add these divisions to random states that have at MOST WEAK Nationalist control
				if = {
					limit = {
						has_country_flag = SPR_distribute_arms_to_the_people_flag
					}
					SPD = {
						division_template = {
							name = "Brigada Popular"
							template_counter = 13
							division_names_group = SPD_INF_03
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
				}
				# Load Spanish FT for Republicans, unlock relevant focuses
				SPD = {
					load_focus_tree = {
						tree = spanish_focus
						keep_completed = no
					}
					unlock_national_focus = SPR_the_popular_front
				}
				# Randomize which one they get, unless they had time to pick one
				random_list = {
					10 = {
						modifier = {
							factor = 0
							has_country_flag = SPR_secure_the_guardia_civil_flag
						}
						SPD = { unlock_national_focus = SPR_secure_the_guardia_de_asalto }
					}
					10 = {
						modifier = {
							factor = 0
							has_country_flag = SPR_secure_the_guardia_de_asalto_flag
						}
						SPD = { unlock_national_focus = SPR_secure_the_guardia_civil }
					}
				}
				SPD = {
					unlock_national_focus = SPR_train_the_union_youth
					unlock_national_focus = SPR_enlarge_the_weapon_caches
					unlock_national_focus = SPR_distribute_arms_to_the_people
					unlock_national_focus = SPR_disband_the_army
					random_list = {
						10 = {
							modifier = {
								factor = 0
								is_historical_focus_on = yes
							}
							modifier = {
								factor = 0
								has_global_flag = SOV_covert_support_for_poum_flag #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
							}
							complete_national_focus = SPR_regional_defense_council_of_aragon
						}
						10 = {
							modifier = {
								factor = 0
								has_global_flag = SOV_covert_support_for_poum_flag #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
							}
							complete_national_focus = SPR_maintain_the_second_republic
						}
						10 = {
							modifier = {
								factor = 0
								is_historical_focus_on = yes
							}
							modifier = {
								add = 10
								has_global_flag = SOV_covert_support_for_poum_flag #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
							}
							complete_national_focus = SPR_the_anti_fascist_workers_revolution
						}
					}
				}
				# Unlock division templates for Nationalists
				country_lock_all_division_template = no
				every_owned_state = {
					set_state_flag = SPR_sided_with_nationalists_flag
				}
				if = {
					limit = {
						176 = { is_owned_by = ROOT }
					}
					set_capital = { state = 176 }
				}
				else_if = {
					limit = {
						171 = { is_owned_by = ROOT }
					}
					set_capital = { state = 171 }
				}
				else = {
					random_owned_state = {
						ROOT = { set_capital = { state = PREV } }
					}
				}
				# Unlock division templates for Republicans
				SPD = {
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
						}
						add_core_of = SPD
					}
					inherit_technology = SPA
					country_lock_all_division_template = no
				}
				if = {
					limit = {
						41 = { is_owned_by = SPD }
					}
					SPD = { set_capital = { state = 41 } }
				}
				else_if = {
					limit = {
						165 = { is_owned_by = SPD }
					}
					SPD = { set_capital = { state = 165 } }
				}
				else = {
					random_owned_state = {
						SPD = { set_capital = { state = PREV } }
					}
				}
				# We need to teleport the railway guns after capitals have been set. transfer_units_fraction will
				# teleport them but to the wrong province.
				teleport_railway_guns_to_deploy_province = ROOT
				teleport_railway_guns_to_deploy_province = SPD
				SPD = {
					add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
					add_ideas = SPR_disbanded_army_1
					set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
				}
				set_party_name = { ideology = neutrality long_name = SPR_neutrality_military_junta_party_long name = SPR_neutrality_military_junta_party }
				#every_unit_leader = {
				#	limit = {
				#		has_unit_leader_flag = SPR_reassigned_flag
				#	}
				#	ROOT = { remove_unit_leader = PREV }
				#}
				add_timed_idea = { idea = SPA_death_before_surrender days = 900 }
				set_global_flag = spanish_civil_war # Start civil war - used in many triggers
				country_event = { id = lar_spain.6 days = 7 } # SCW notification event for the player
				country_event = { id = lar_spain.78 days = 7 random_days = 7 } # Sanjurjo dies
			}
		}

###  ### ###  #  # ###  #   ###  ##   ##  #  #     ### ### ### ###  ##  ### 
#  # #   #  # #  # #  # #    #  #  # #  # ## #     #   #   #   #   #  #  #  
###  ##  ###  #  # ###  #    #  #    #### # ##     ##  ##  ##  ##  #     #  
#  # #   #    #  # #  # #    #  #  # #  # #  #     #   #   #   #   #  #  #  
#  # ### #     ##  ###  ### ###  ##  #  # #  #     ### #   #   ###  ##   #  

		# check Nationalist effect for detailed comments
		if = {
			limit = {
				has_completed_focus = SPR_the_popular_front
			}
			hidden_effect = {
				set_country_flag = SPR_republican_spain_flag
				set_cosmetic_tag = SPR_republican_spain
				SPA = {
					retire_ideology_leader = democratic
					retire_ideology_leader = neutrality
					retire_ideology_leader = communism
					kill_country_leader = yes
					create_country_leader = {
						name = "José Sanjurjo"
						desc = "POLITICS_JOSE_SANJURJO_DESC"
						picture = "GFX_portrait_SPA_jose_sanjurjo"
						expire = "1965.1.1"
						ideology = despotism
						traits = {
							the_lion_of_the_rif
						}
					}
					set_popularities = {
						democratic = 5
						communism = 3
						neutrality = 44
						fascism = 48
					}
					transfer_state = 177
					177 = { set_state_flag = SPR_sided_with_nationalists_flag }
					transfer_state = 178
					178 = { set_state_flag = SPR_sided_with_nationalists_flag }
				}
				SPD = {
					retire_ideology_leader = fascism
					retire_ideology_leader = neutrality
					create_country_leader = {
						name = "Manuel Azaña"
						desc = "POLITICS_MANUEL_AZANA_DESC"
						picture = "Portrait_Spain_Manuel_Azana.dds"
						expire = "1965.1.1"
						ideology = conservatism
						traits = {
							figurehead_president
						}
					}
				}
				add_popularity = {
				    ideology = fascism
				    popularity = -0.3
				}
				add_popularity = {
				    ideology = neutrality
				    popularity = -0.2
				}
				division_template = {
					name = "Guarnición Republicana"
					is_locked = yes
					template_counter = 6
					division_names_group = SPD_INF_01
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				SPA = {
					division_template = {
						name = "Guarnición Nacionalista"
						is_locked = yes
						template_counter = 6
						division_names_group = SPR_INF_02
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
						}
					}
				}
				if = {
					limit = {
						has_country_flag = SPA_the_army_of_africa_flag
					}
					SPA = {
						transfer_state = 290
						290 = { set_state_flag = SPR_sided_with_nationalists_flag }
						division_template = {
							name = "División del Ejército de África"
							template_counter = 4
							division_names_group = SPR_INF_06
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
								infantry = { x = 2 y = 0 }
								artillery_brigade = { x = 2 y = 1 }
								artillery_brigade = { x = 2 y = 2 }
							}
							support = {
								recon = { x = 0 y = 0 }
								engineer = { x = 0 y = 1 }
							}
						}
						290 = {
							create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
							create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
							create_unit = {
								division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
								owner = SPA
							}
							if = {
								limit = {
									ROOT = { NOT = { has_country_flag = SPR_disband_the_army_flag } }
								}
								create_unit = {
									division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
									owner = SPA
								}
								create_unit = {
									division = "division_template = \"División del Ejército de África\" start_experience_factor = 0.3" 
									owner = SPA
								}
							}
						}
					}
				}
				if = {
					limit = {
						NOT = { has_completed_focus = SPR_enlarge_the_weapon_caches }
					}
					transfer_units_fraction = {
						target = SPA
						size = 0.5 # Fallback in case one of the ratios below are not stipulated
						stockpile_ratio = 0.5
						army_ratio = 0.5
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							NOT = { has_trait = trait_SPA_nationalist_sympathies }
						}
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_enlarge_the_weapon_caches
						NOT = { has_completed_focus = SPR_disband_the_army }
					}
					transfer_units_fraction = {
						target = SPA
						size = 0.5
						stockpile_ratio = 0.2
						army_ratio = 0.5
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							NOT = { has_trait = trait_SPA_nationalist_sympathies }
						}
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_disband_the_army
					}
					transfer_units_fraction = {
						target = SPA
						size = 0.5
						stockpile_ratio = 0.2
						army_ratio = 0.2
						navy_ratio = 0.5
						air_ratio = 0.5
						keep_unit_leaders = {
						    
						}
						keep_unit_leaders_trigger = {
							NOT = { has_trait = trait_SPA_nationalist_sympathies }
						}
					}
				}
				delete_units = {
				    division_template = "División de Infantería"
				    disband = yes
				}
				delete_units = {
				    division_template = "División de Caballería"
				    disband = yes
				}
				delete_units = {
				    division_template = "Brigada Montaña"
				    disband = yes
				}
				delete_units = {
				    division_template = "Brigada de Infantería"
				    disband = yes
				}
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_nationalist_sympathies
					}
					remove_unit_leader_trait = trait_SPA_nationalist_sympathies
					set_nationality = SPA
				}
				SPA = {
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 1108
								has_id = 1109
								has_id = 1111
								has_id = 1112
								has_id = 1113
							}
						}
						remove_unit_leader_trait = trait_SPA_nationalist_sympathies
						add_unit_leader_trait = trait_SPA_falangist_loyalties
					}
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 1114
								has_id = 1115
								has_id = 1116
							}
						}
						remove_unit_leader_trait = trait_SPA_nationalist_sympathies
						add_unit_leader_trait = trait_SPA_carlist_loyalties
					}
					every_unit_leader = {
						limit = {
							has_id = 1110
						}
						remove_unit_leader_trait = trait_SPA_nationalist_sympathies
					}
				}
				every_unit_leader = {
					limit = {
						OR = {
							has_id = 1101
							has_id = 1102
							has_id = 1103
						}
					}
					add_unit_leader_trait = trait_SPR_republican_loyalties
				}
				every_unit_leader = {
					limit = {
						OR = {
							has_id = 1104
							has_id = 1105
							has_id = 1106
						}
					}
					add_unit_leader_trait = trait_SPR_stalinist_loyalties
				}
				every_unit_leader = {
					limit = {
						OR = {
							has_id = 1107
						}
					}
					add_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
				}
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 1 compare = equals }
						NOT = {
							state = 290
							state = 699
							state = 506
							state = 297
						}
					}
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 3
					}
				}
				41 = { # Extra 6 divisions to make Madrid harder to capture (as historically)
					create_unit = {
						division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
						owner = SPD
						allow_spawning_on_enemy_provs = yes
						count = 6
					}
				}
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 4 compare = equals }
					}
					SPA = {
						transfer_state = PREV
					}
					set_state_flag = SPR_sided_with_nationalists_flag
					create_unit = {
						division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
						owner = SPA
						allow_spawning_on_enemy_provs = yes
						count = 3
					}
				}
				SPA = {
					declare_war_on = {
					    target = SPD
					    type = civil_war
					}
					add_civil_war_target = SPD
				}
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 2 compare = equals }
					}
					if = {
						limit = {
							has_state_flag = SPA_northern_garrisons_state_flag
						}
						SPA = {
							transfer_state = PREV
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					else = {
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
				}
				every_owned_state = {
					limit = {
						check_variable = { var = SPA_garrison_control value = 3 compare = equals }
					}
					if = {
						limit = {
							has_state_flag = SPA_northern_garrisons_state_flag
						}
						SPA = {
							transfer_state = PREV
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					else = {
						create_unit = {
							division = "division_template = \"Guarnición Republicana\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
						create_unit = {
							division = "division_template = \"Guarnición Nacionalista\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
				}
				if = {
					limit = {
						has_country_flag = SPA_negotiate_carlist_support_flag
					}
					SPA = {
						division_template = {
							name = "Requeté Carlista"
							template_counter = 8
							division_names_group = SPR_INF_03
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					172 = {
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.5" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 5
						}
						if = {
							limit = {
								difficulty > 1
								ROOT = {
									is_ai = no
								}
							}
							create_unit = {
								division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.5" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 5
							}
						}
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_secure_the_guardia_civil
					}
					SPA = {
						division_template = {
							name = "División de la Guardia de Asalto"
							template_counter = 5
							division_names_group = SPR_INF_05
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
					SPD = {
						division_template = {
							name = "Brigada de la Guardia Civil"
							template_counter = 7
							division_names_group = SPR_INF_04
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
				}
				else_if = {
					limit = {
						has_completed_focus = SPR_secure_the_guardia_de_asalto
					}
					SPA = {
						division_template = {
							name = "Brigada de la Guardia Civil"
							template_counter = 7
							division_names_group = SPR_INF_04
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
					SPD = {
						division_template = {
							name = "División de la Guardia de Asalto"
							template_counter = 5
							division_names_group = SPR_INF_05
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
								check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
								if = {
									limit = {
										ROOT = {
											is_ai = yes
											OR = {
												AND = {
													is_historical_focus_on = yes
													always = yes
												}
												has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
												always = yes
											}
										}
									}
									NOT = {
										state = 544
										state = 494
									}
								}
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPD
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
				}
				else = { #Extra backup in case player never took any focuses - SPA gets BOTH types!
					SPA = {
						division_template = {
							name = "División de la Guardia de Asalto"
							template_counter = 5
							division_names_group = SPR_INF_05
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
							}
						}
						division_template = {
							name = "Brigada de la Guardia Civil"
							template_counter = 7
							division_names_group = SPR_INF_04
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
	
					#Guardia de Asalto
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"División de la Guardia de Asalto\" start_experience_factor = 0.3" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
							}
						}
					}
	
					# Guardia Civil
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
						create_unit = {
							division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
							owner = SPA
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					if = {
						limit = {
							difficulty > 1
							ROOT = {
								is_ai = no
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
						random_state = {
							limit = {
								check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
							}
							create_unit = {
								division = "division_template = \"Brigada de la Guardia Civil\" start_experience_factor = 0.1" 
								owner = SPA
								allow_spawning_on_enemy_provs = yes
								count = 1
							}
						}
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_train_the_union_youth
					}
					SPD = {
						division_template = {
							name = "Brigada de Juventudes Sindicales"
							template_counter = 0
							division_names_group = SPD_INF_02
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada de Juventudes Sindicales\" start_experience_factor = 0.2" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 1
						}
					}
				}
				if = {
					limit = {
						has_completed_focus = SPR_distribute_arms_to_the_people
					}
					SPD = {
						division_template = {
							name = "Brigada Popular"
							template_counter = 13
							division_names_group = SPD_INF_03
							is_locked = yes
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
							}
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
					random_state = {
						limit = {
							check_variable = { var = SPA_garrison_control value = 2 compare = less_than_or_equals }
							check_variable = { var = SPA_garrison_control value = 1 compare = greater_than_or_equals }
							if = {
								limit = {
									ROOT = {
										is_ai = yes
										OR = {
											AND = {
												is_historical_focus_on = yes
												always = yes
											}
											has_country_flag = SPR_AI_RANDOM_NATIONALIST_HISTORICAL
											always = yes
										}
									}
								}
								NOT = {
									state = 544
									state = 494
								}
							}
						}
						create_unit = {
							division = "division_template = \"Brigada Popular\" start_experience_factor = 0" 
							owner = SPD
							allow_spawning_on_enemy_provs = yes
							count = 2
						}
					}
				}
				SPA = {
					load_focus_tree = {
						tree = spanish_focus
						keep_completed = no
					}
					unlock_national_focus = SPA_a_great_spain
					unlock_national_focus = SPA_hand_over_the_ceda_campaign_chest
					unlock_national_focus = SPA_negotiate_carlist_support
					unlock_national_focus = SPA_the_army_of_africa
					unlock_national_focus = SPA_secure_the_northern_garrisons
					random_list = {
						10 = {
							modifier = {
								factor = 0
								ROOT = { has_country_flag = SPA_con_paquito_flag }
							}
							unlock_national_focus = SPA_sin_paquito
						}
						10 = {
							modifier = {
								factor = 0
								ROOT = { has_country_flag = SPA_sin_paquito_flag }
							}
							unlock_national_focus = SPA_con_paquito
						}
					}
					random_list = {
						10 = {
							modifier = {
								factor = 0
								is_historical_focus_on = yes
							}
							modifier = {
								factor = 0
								ROOT = { has_country_flag = SPA_con_paquito_flag }
							}
							complete_national_focus = SPA_the_phalanx_ascendant
						}
						10 = {
							modifier = {
								factor = 0
								ROOT = { has_country_flag = SPA_sin_paquito_flag }
							}
							complete_national_focus = SPA_unify_the_nationalist_front
						}
						10 = {
							modifier = {
								factor = 0
								is_historical_focus_on = yes
							}
							complete_national_focus = SPA_supremacy_of_the_communion
						}
					}
					add_ideas = SPA_carlism_1
				}
				country_lock_all_division_template = no
				every_owned_state = {
					set_state_flag = SPR_sided_with_republicans_flag
				}
				if = {
					limit = {
						41 = { is_owned_by = ROOT }
					}
					set_capital = { state = 41 }
				}
				else_if = {
					limit = {
						165 = { is_owned_by = ROOT }
					}
					set_capital = { state = 165 }
				}
				else = {
					random_owned_state = {
						ROOT = { set_capital = { state = PREV } }
					}
				}
				SPA = {
					every_state = {
						limit = {
							has_state_flag = SPR_core_of_spain_flag
						}
						add_core_of = SPA
					}
					inherit_technology = SPD
					country_lock_all_division_template = no
					if = {
						limit = {
							176 = { is_owned_by = SPA }
						}
						SPA = { set_capital = { state = 176 } }
					}
					else_if = {
						limit = {
							171 = { is_owned_by = SPA }
						}
						SPA = { set_capital = { state = 171 } }
					}
					else = {
						random_owned_state = {
							SPA = { set_capital = { state = PREV } }
						}
					}
					set_party_name = { ideology = neutrality long_name = SPR_neutrality_military_junta_party_long name = SPR_neutrality_military_junta_party }
				}
				# We need to teleport the railway guns after capitals have been set. transfer_units_fraction will
				# teleport them but to the wrong province.
				teleport_railway_guns_to_deploy_province = ROOT
				teleport_railway_guns_to_deploy_province = SPA
				set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
				SPA = { add_timed_idea = { idea = SPA_death_before_surrender days = 900 } }
				add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
				add_ideas = SPR_disbanded_army_1
				set_global_flag = spanish_civil_war
				country_event = { id = lar_spain.6 days = 7 }
				SPA = { country_event = { id = lar_spain.78 days = 7 random_days = 7 } } # Sanjurjo dies
			}
		}
		hidden_effect = {
			# Marks gui as "dirty" so the code updates the layout to properly hide the unused branches
			mark_focus_tree_layout_dirty = yes
		}
	}
	
	option = { # Option for Nationalists - Franco
		name = lar_spain.2.a
		trigger = { has_completed_focus = SPA_con_paquito }
		ai_chance = {
			base = 40
		}
		# Remove Spirits that will no longer be relevant
		custom_effect_tooltip = nationalists_chosen
		remove_ideas = SPR_military_disloyalty
		remove_ideas = SPR_political_violence
		SPR_clr_national_strikes = yes
		effect_tooltip = {
			add_timed_idea = { idea = SPA_death_before_surrender days = 900 }
			SPD = { add_timed_idea = { idea = SPR_death_before_surrender days = 900 } }
			set_party_name = { ideology = neutrality long_name = SPR_neutrality_military_junta_party_long name = SPR_neutrality_military_junta_party }
			kill_ideology_leader = fascism
		}
		complete_national_focus = SPA_unify_the_nationalist_front
	}
	option = { # Option for Republicans - Democratic
		name = lar_spain.2.d
		trigger = { has_completed_focus = SPR_the_popular_front }
		ai_chance = {
			base = 0
		}
		# Remove Spirits that will no longer be relevant
		custom_effect_tooltip = republicans_chosen
		remove_ideas = SPA_carlism_1
		remove_ideas = SPR_military_disloyalty
		remove_ideas = SPR_political_violence
		SPR_clr_national_strikes = yes
		effect_tooltip = {
			add_ideas = SPR_disbanded_army_1
		}
		effect_tooltip = {
			add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
			SPA = { add_timed_idea = { idea = SPA_death_before_surrender days = 900 } }
			set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
		}
		complete_national_focus = SPR_maintain_the_second_republic
	}
	option = { # Option for Republicans - Communism
		name = lar_spain.2.e
		trigger = { has_completed_focus = SPR_the_popular_front }
		ai_chance = {
			base = 0
		}
		# Remove Spirits that will no longer be relevant
		custom_effect_tooltip = republicans_chosen
		remove_ideas = SPA_carlism_1
		remove_ideas = SPR_military_disloyalty
		remove_ideas = SPR_political_violence
		SPR_clr_national_strikes = yes
		effect_tooltip = {
			add_ideas = SPR_disbanded_army_1
		}
		effect_tooltip = {
			add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
			SPA = { add_timed_idea = { idea = SPA_death_before_surrender days = 900 } }
			set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
		}
		complete_national_focus = SPR_the_anti_fascist_workers_revolution
	}
	option = { # Option for Republicans - Anarchism
		name = lar_spain.2.f
		trigger = { has_completed_focus = SPR_the_popular_front }
		ai_chance = {
			base = 0
		}
		# Remove Spirits that will no longer be relevant
		custom_effect_tooltip = republicans_chosen
		remove_ideas = SPA_carlism_1
		remove_ideas = SPR_military_disloyalty
		remove_ideas = SPR_political_violence
		SPR_clr_national_strikes = yes
		effect_tooltip = {
			add_ideas = SPR_disbanded_army_1
		}
		effect_tooltip = {
			add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
			SPA = { add_timed_idea = { idea = SPA_death_before_surrender days = 900 } }
			set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
		}
		complete_national_focus = SPR_regional_defense_council_of_aragon
	}
}

# Mission Generator simulating Republican government working against the Nationalists
country_event = {
	id = lar_spain.3

	trigger = {
		NOT = { has_global_flag = spanish_civil_war }
	}
	
	is_triggered_only = yes

	hidden = yes

	immediate = {
		random_list = {
			30 = { # Government imprisons Primo de Rivera
				modifier = {
					factor = 0
					OR = {
						NOT = { has_country_flag = SPR_primo_de_rivera_first_speech }
						has_country_flag = SPA_primo_de_rivera_imprisoned
					}
				}
				activate_mission = SPA_imprison_primo_de_rivera_mission
			}
			30 = { # Government makes political arrest
				modifier = {
					factor = 0
					NOT = { has_country_flag = SPA_political_assassination_flag }
				}
				activate_mission = SPA_political_arrest_mission
			}
			10 = { # Government reassigns disloyal general
				modifier = {
					factor = 0
					NOT = {
						any_army_leader = {
							has_trait = trait_SPA_nationalist_sympathies
							NOT = { has_unit_leader_flag = SPR_reassigned_flag }
						}
					}
				}
				activate_mission = SPA_reassign_disloyal_leader_mission
			}
			30 = { # Government makes concessions to the far left
				activate_mission = SPA_concessions_to_the_left_mission
			}
		}
	}
}

# Mission Generator simulating Nationalists working against the Republican Government
country_event = {
	id = lar_spain.4

	trigger = {
		NOT = { has_global_flag = spanish_civil_war }
	}
	
	is_triggered_only = yes

	hidden = yes

	immediate = {
		random_list = {
			35 = { # Primo de Rivera makes inflammatory speech
				activate_mission = SPR_primo_de_rivera_speech_mission
				modifier = {
					factor = 0
					has_country_flag = SPA_primo_de_rivera_imprisoned
				}
				modifier = {
					factor = 0
					has_decision = SPR_imprison_primo_de_rivera
				}
			}
			15 = { # Nationalists conduct political assassination
				activate_mission = SPR_political_assassination_mission
			}
			20 = { # Nationalists obtain general's loyalty
				activate_mission = SPR_sway_leader_loyalty_mission
				modifier = {
					factor = 0
					any_unit_leader = {
						has_unit_leader_flag = SPA_swayed_leader_loyalty_flag
					}
				}
			}
			30 = { # Nationalists suppress the leftist strikes
				activate_mission = SPR_suppress_the_strikes_mission
			}
		}
	}
}

# Mission Generator simulating other side expanding garrison influence
country_event = {
	id = lar_spain.5

	trigger = {
		NOT = { has_global_flag = spanish_civil_war }
	}

	is_triggered_only = yes

	hidden = yes

	immediate = {
		random_list = {
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						171 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					171 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					171 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_galicia_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					544 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					544 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					544 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_asturias_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						174 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					174 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					174 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_leon_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						540 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					540 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					540 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_valladolid_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						176 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					176 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					176 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_burgos_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					494 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					494 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					494 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_pais_vasco_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						172 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					172 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					172 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_navarra_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						166 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					166 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					166 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_western_aragon_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					492 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					492 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					492 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_eastern_aragon_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					165 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					165 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					165 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_catalunya_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						649 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						is_historical_focus_on = yes
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					649 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					NOT = { has_country_flag = SPA_secure_the_northern_garrisons_flag }
				}
				modifier = {
					factor = 10
					649 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_salamanca_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					41 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					41 = { check_variable = { var = SPA_garrison_control value = 2 compare = greater_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					41 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					41 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				activate_mission = SPA_expand_influence_in_the_madrid_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					493 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					493 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					493 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_guadalajara_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					167 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					167 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					167 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_valencia_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						170 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						AND = {
							is_historical_focus_on = yes
							170 = { check_variable = { var = SPA_garrison_control value = 4 compare = less_than } }
						}
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
					is_ai = yes
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					170 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					170 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_extremadura_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					175 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					175 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					175 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_ciudad_real_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					168 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					168 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					168 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_murcia_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						169 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						AND = {
							is_historical_focus_on = yes
							169 = { check_variable = { var = SPA_garrison_control value = 4 compare = less_than } }
						}
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
					is_ai = yes
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					169 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					169 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_sevilla_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					OR = {
						552 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
						AND = {
							is_historical_focus_on = yes
							552 = { check_variable = { var = SPA_garrison_control value = 3 compare = less_than } }
						}
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
					is_ai = yes
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					552 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					552 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 20
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_cordoba_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					173 = { check_variable = { var = SPA_garrison_control value = 2 compare = less_than } }
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					173 = { check_variable = { var = SPA_garrison_control value = 4 compare = equals } }
				}
				modifier = {
					factor = 10
					173 = { has_state_flag = SPR_ai_recently_expanded_influence_flag }
				}
				modifier = {
					factor = 10
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
				}
				activate_mission = SPA_expand_influence_in_the_granada_garrison_mission
			}
			20 = {
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = no
					any_owned_state = {
						check_variable = { var = SPA_garrison_control value = 2 compare = greater_than_or_equals }
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPA_a_great_spain
					is_historical_focus_on = yes
					OR = {
						any_owned_state = {
							NOT = { state = 166 }
							NOT = { state = 169 }
							NOT = { state = 170 }
							NOT = { state = 171 }
							NOT = { state = 172 }
							NOT = { state = 174 }
							NOT = { state = 176 }
							NOT = { state = 649 }
							NOT = { state = 552 }
							NOT = { state = 540 }
							check_variable = { var = SPA_garrison_control value = 2 compare = greater_than_or_equals }
						}
						any_owned_state = {
							OR = {
								state = 169
								state = 170
							}
							check_variable = { var = SPA_garrison_control value = 4 compare = equals }
						}
						552 = {
							check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals }
						}
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = no
					any_owned_state = {
						check_variable = { var = SPA_garrison_control value = 4 compare = less_than }
					}
				}
				modifier = {
					factor = 0
					has_completed_focus = SPR_the_popular_front
					is_historical_focus_on = yes
					any_owned_state = {
						OR = {
							state = 166
							state = 169
							state = 170
							state = 171
							state = 172
							state = 174
							state = 176
							state = 649
							state = 552
							state = 540
						}
						check_variable = { var = SPA_garrison_control value = 4 compare = less_than }
					}
				}
				country_event = { id = lar_spain.5 days = 1 random_days = 9 }
			}
		}
	}
}

# Spanish Civil War - Frontlines Solidify
country_event = {
	id = lar_spain.6
	title = lar_spain.6.t
	desc = lar_spain.6.desc
	picture = GFX_report_event_spr_spanish_civil_war2
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_global_flag = scw_frontlines_solidify
			remove_ideas = SPA_planned_uprising
			every_state = {
				limit = {
					OR = {
						state = 41
						state = 165
						state = 166
						state = 167
						state = 168
						state = 169
						state = 170
						state = 171
						state = 172
						state = 173
						state = 174
						state = 175
						state = 176
						state = 649
						state = 552
						state = 544
						state = 540
						state = 494
						state = 493
						state = 492
					}
				}
				set_state_flag = SPR_unplanned_offensive_flag
				add_dynamic_modifier = {
					modifier = unplanned_offensive
				}
			}
		}
	}
	
	option = {
		name = lar_spain.6.a
		if = {
			limit = {
				tag = SPA
			}
			effect_tooltip = { remove_ideas = SPA_planned_uprising }
		}
		effect_tooltip = {
			every_state = {
				limit = {
					OR = {
						state = 41
						state = 165
						state = 166
						state = 167
						state = 168
						state = 169
						state = 170
						state = 171
						state = 172
						state = 173
						state = 174
						state = 175
						state = 176
						state = 649
						state = 552
						state = 544
						state = 540
						state = 494
						state = 493
						state = 492
					}
				}
				add_dynamic_modifier = {
					modifier = unplanned_offensive
				}
			}
		}
		custom_effect_tooltip = lar_spain.6_tt
	}
}

# Spanish Civil War - Carlists rise up
country_event = {
	id = lar_spain.7
	title = lar_spain.7.t
	desc = {
		text = lar_spain.7.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_spain.7.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_report_event_spr_carlists
	
	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_global_flag = SPR_carlist_uprising_flag
			set_global_flag = { flag = SPR_civil_war_startup value = 1 days = 3 } # Make AI avoid attacking for a few days
			SPB = {
				set_politics = {
					ruling_party = neutrality
				}
				set_popularities = {
					democratic = 13
					neutrality = 82
					fascism = 5
				}
				set_party_name = { ideology = neutrality long_name = SPR_neutrality_party_long name = SPR_neutrality_party }
			}
			if = { # If SPA owns both of the historical Carlist states
				limit = {
					controls_state = 172
					controls_state = 176
				}
				every_state = {
					limit = {
						OR = {
							state = 172
							state = 176
						}
						is_controlled_by = ROOT
					}
					SPB = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 10
						controls_state = 540
					}
					SPB = {
						transfer_state = 540
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 11
						controls_state = 174
					}
					SPB = {
						transfer_state = 174
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 13
						controls_state = 171
					}
					SPB = {
						transfer_state = 171
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 14
						has_global_flag = scw_early_end
					}
					random_owned_state = {
						limit = {
							any_neighbor_state = {
								OR = {
									state = 171
									state = 172
									state = 174
									state = 176
									state = 540
								}
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
					random_owned_state = {
						limit = {
							any_neighbor_state = {
								OR = {
									state = 171
									state = 172
									state = 174
									state = 176
									state = 540
								}
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
			}
			else_if = { # Fallback if not owning one of the historically Carlist states
				limit = {
					OR = {
						AND = {
							controls_state = 172
							NOT = { controls_state = 176 }
						}
						AND = {
							controls_state = 176
							NOT = { controls_state = 172 }
						}
					}
				}
				every_state = {
					limit = {
						OR = {
							state = 172
							state = 176
						}
						is_controlled_by = ROOT
					}
					SPB = {
						transfer_state = PREV
					}
				}
			}
			else_if = { # Fallback if not owning one of the historically Carlist states
				limit = {
					OR = {
						AND = {
							controls_state = 172
							NOT = { controls_state = 176 }
						}
						AND = {
							controls_state = 176
							NOT = { controls_state = 172 }
						}
					}
				}
				every_state = {
					limit = {
						OR = {
							state = 172
							state = 176
						}
						is_controlled_by = ROOT
					}
					SPB = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 5
						OR = {
							controls_state = 171
							controls_state = 174
							controls_state = 540
						}
					}
					random_state = {
						limit = {
							OR = {
								state = 171
								state = 174
								state = 540
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
				else = {
					random_state = {
						limit = {
							NOT = { state = 178 }
							NOT = { state = 177 }
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
			}
			else_if = { # You're not getting out of a civil war by voluntarily giving up the targetable locations, pal!
				limit = {
					NOT = {
						controls_state = 172
						controls_state = 176
					}
					OR = {
						controls_state = 171
						controls_state = 174
						controls_state = 540
					}
				}
				random_state = {
					limit = {
						OR = {
							state = 171
							state = 174
							state = 540
						}
						has_state_flag = SPR_core_of_spain_flag
						is_controlled_by = ROOT
						is_capital = no
					}
					SPB = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 5
						OR = {
							controls_state = 171
							controls_state = 174
							controls_state = 540
						}
					}
					random_state = {
						limit = {
							OR = {
								state = 171
								state = 174
								state = 540
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
				else = {
					random_state = {
						limit = {
							NOT = { state = 178 }
							NOT = { state = 177 }
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
			}
			else_if = { # You're not getting out of a civil war by voluntarily giving up the targetable locations, pal!
				limit = {
					NOT = {
						controls_state = 172
						controls_state = 176
						controls_state = 171
						controls_state = 174
						controls_state = 540
					}
				}
				random_state = {
					limit = {
						NOT = { state = 178 }
						NOT = { state = 177 }
						has_state_flag = SPR_core_of_spain_flag
						is_controlled_by = ROOT
						is_capital = no
					}
					SPB = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 5
					}
					random_state = {
						limit = {
							NOT = { state = 178 }
							NOT = { state = 177 }
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPB = {
							transfer_state = PREV
						}
					}
				}
			}
			else = {
				random_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						is_controlled_by = ROOT
						is_capital = no
					}
					SPB = {
						transfer_state = PREV
					}
				}
			}
			SPB = {
				random_owned_state = {
					limit = {
						is_controlled_by = SPB
						is_core_of = SPB
						NOT = {
							state = 177
							state = 178
						}
					}
					SPB = { set_capital = { state = PREV } }
				}
				inherit_technology = SPA
				set_stability = 0.6
				set_war_support = 0.5
				division_template = {
					name = "Requeté Carlista"
					template_counter = 8
					priority = 1
					division_names_group = SPR_INF_03
					is_locked = yes
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				set_division_template_lock = {
				    division_template = "Requeté Carlista"
				    is_locked = no
				}
				every_owned_state = {
					create_unit = {
						division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
						owner = SPB
					}
					create_unit = {
						division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
						owner = SPB
					}
				}
				if = {
					limit = {
						NOT = {
							owns_state = 540
							owns_state = 174
							owns_state = 171
						}
					}
					every_owned_state = {
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPB
						}
						create_unit = {
							division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
							owner = SPB
						}
					}
				}
				if = {
					limit = {
						owns_state = 172
					}
					set_capital = { state = 172 }
				}
				else = {
					random_owned_state = {
						SPB = {
							set_capital = { state = PREV }
						}
					}
				}
			}
			add_popularity = {
			    ideology = neutrality
			    popularity = -0.15
			}
			add_stability = -0.1
			delete_unit_template_and_units = {
				division_template = "Requeté Carlista"
			}
			transfer_units_fraction = {
				target = SPB
				stockpile_ratio = 0.2
				army_ratio = 0.1
				navy_ratio = 0.1
				air_ratio = 0.1
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPA_falangist_loyalties
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_carlist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_carlist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPB
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_falangist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_falangist_loyalties
			}
			SPB = {
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_nationalist_sympathies
					}
					remove_unit_leader_trait = trait_SPA_nationalist_sympathies
				}
				declare_war_on = {
				    target = ROOT
				    type = civil_war
				}
				add_civil_war_target = ROOT
				add_ai_strategy = {
					type = antagonize
					id = SPA
					value = 200
				}
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD

				add_ai_strategy = {
					type = antagonize
					id = SPD
					value = 200
				}
				if = {
					limit = {
						country_exists = SPC
					}
					declare_war_on = {
					    target = SPC
					    type = civil_war
					}
					add_civil_war_target = SPC

					add_ai_strategy = {
						type = antagonize
						id = SPC
						value = 200
					}
				}
			}
			every_other_country = {
				add_ai_strategy = {
					type = support
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = protect
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = befriend
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = alliance
					id = SPB
					value = -200
				}
			}
			SPB = {
				load_focus_tree = {
					tree = spanish_focus
					keep_completed = no
				}
				unlock_national_focus = SPA_a_great_spain
				unlock_national_focus = SPA_hand_over_the_ceda_campaign_chest
				unlock_national_focus = SPA_negotiate_carlist_support
				unlock_national_focus = SPA_the_army_of_africa
				unlock_national_focus = SPA_secure_the_northern_garrisons
				if = {
					limit = {
						SPA = { has_completed_focus = SPA_sin_paquito }
					}
					unlock_national_focus = SPA_sin_paquito
				}
				if = {
					limit = {
						SPA = { has_completed_focus = SPA_con_paquito }
					}
					unlock_national_focus = SPA_con_paquito
				}
				complete_national_focus = SPA_supremacy_of_the_communion
				complete_national_focus = SPA_prepare_the_carlist_insurrection
				complete_national_focus = SPA_contact_the_union_militar_espanola
				complete_national_focus = SPA_head_the_junta_nacional
				complete_national_focus = SPA_unite_the_requetes
				unlock_national_focus = SPA_no_compromise_on_carlist_ideals
				add_timed_idea = { idea = SPA_death_before_surrender days = 900 }
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_carlist_loyalties
					}
					remove_unit_leader_trait = trait_SPA_carlist_loyalties
				}
			}
			if = {
				limit = {
					has_idea = SPA_carlism_1
				}
				remove_ideas = SPA_carlism_1
			}
			if = {
				limit = {
					has_idea = SPA_carlism_2
				}
				remove_ideas = SPA_carlism_2
			}
			if = {
				limit = {
					has_idea = SPA_carlism_3
				}
				remove_ideas = SPA_carlism_3
			}
			if = {
				limit = {
					has_idea = SPA_carlism_4
				}
				remove_ideas = SPA_carlism_4
			}
			if = {
				limit = {
					has_idea = SPA_carlism_5
				}
				remove_ideas = SPA_carlism_5
			}

			## SPA triggers Carlist Uprising ##
			# If any country has already joined SCW, it will join the war against SPB as well
			if = { #Country supporting SPD
				limit = {
					any_country = { has_country_flag = supports_SPD_flag }
				}
				every_country = {
					limit = { has_country_flag = supports_SPD_flag }
					add_to_war = { targeted_alliance = SPD enemy = SPB hostility_reason = asked_to_join }
				}
				if = {
					limit = {
						any_country = { has_country_flag = POR_non_aligned_portugal_supports_SPA_flag }
					}
					random_country = { #Portuguese Non-aligned tag (spawned via Workers of Iberia, Unite! focus) will join war
						limit = {
							has_country_flag = POR_non_aligned_portugal_supports_SPA_flag
						}
						add_to_war = { targeted_alliance = SPA enemy = SPB hostility_reason = asked_to_join }
					}
				}
			}
			if = { #Country supporting SPA
				limit = {
					any_country = { has_country_flag = supports_SPA_flag }
				}
				every_country = {
					limit = { has_country_flag = supports_SPA_flag }
					add_to_war = { targeted_alliance = SPA enemy = SPB hostility_reason = asked_to_join }
				}
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
				}
				add_core_of = SPB
			}
			news_event = { id = lar_news.10 days = 1 }
		}
	}
	
	option = {
		name = lar_spain.7.a
		effect_tooltip = {
			add_popularity = {
			    ideology = neutrality
			    popularity = -0.15
			}
			add_stability = -0.1
			delete_unit_template_and_units = {
				division_template = "Requeté Carlista"
			}
			transfer_units_fraction = {
				target = SPB
				stockpile_ratio = 0.2
				army_ratio = 0.1
				navy_ratio = 0.1
				air_ratio = 0.1
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPA_falangist_loyalties
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_carlist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_carlist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPB
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_falangist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_falangist_loyalties
			}
			SPB = {
				declare_war_on = {
				    target = ROOT
				    type = civil_war
				}
				add_civil_war_target = ROOT
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD
				if = {
					limit = {
						country_exists = SPC
					}
					declare_war_on = {
					    target = SPC
					    type = civil_war
					}
					add_civil_war_target = SPC
				}
			}
		}
	}
}

# Spanish Civil War - Fascist Anti-Carlist Crack-down
country_event = {
	id = lar_spain.8
	title = lar_spain.8.t
	desc = {
		text = lar_spain.8.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_spain.8.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_report_event_spr_nationalist_soldiers
	
	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_other_country = {
				limit = {
					ROOT = {
						has_volunteers_amount_from = {
						    tag = PREV
						    count > 0
						}
					}
				}
				recall_volunteers_from = ROOT
			}
			set_global_flag = SPR_carlist_uprising_flag
			set_global_flag = { flag = SPR_civil_war_startup value = 1 days = 3 } # Make AI avoid attacking for a few days
			if = {
				limit = {
					NOT = { has_government = neutrality }
				}
				set_politics = {
					ruling_party = neutrality
				}
			}
			SPB = {
				clr_country_flag = SPR_carlist_spain_flag
				drop_cosmetic_tag = yes
				set_country_flag = SPR_nationalist_spain_flag
				set_cosmetic_tag = SPR_nationalist_spain
			}
			clr_country_flag = SPR_nationalist_spain_flag
			drop_cosmetic_tag = yes
			set_country_flag = SPR_carlist_spain_flag
			set_cosmetic_tag = SPR_carlist_spain
			if = {
				limit = {
					any_state = {
						is_controlled_by = ROOT
						has_state_flag = SPA_carlist_cell_flag
					}
				}
				every_state = {
					limit = {
						NOT = { has_state_flag = SPA_carlist_cell_flag }
						is_controlled_by = ROOT
					}
					SPA = {
						transfer_state = PREV
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						controls_state = 172
						controls_state = 176
					}
				}
				every_state = {
					limit = {
						NOT = { state = 172 }
						NOT = { state = 176 }
						NOT = { has_state_flag = SPA_carlist_cell_flag }
						is_controlled_by = ROOT
					}
					SPA = {
						transfer_state = PREV
					}
				}
			}
			else = {
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
					}
					set_state_flag = SPA_carlist_cell_flag
				}
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPA_carlist_cell_flag }
					}
					set_state_flag = SPA_carlist_cell_flag
				}
				every_state = {
					limit = {
						NOT = { has_state_flag = SPA_carlist_cell_flag }
						is_controlled_by = ROOT
					}
					SPA = {
						transfer_state = PREV
					}
				}
			}
			SPA = {
				inherit_technology = SPB
				set_politics = {
					ruling_party = fascism
					last_election = "1933.4.26"
					election_frequency = 48
					elections_allowed = no
				}
				set_popularities = {
					fascism = 80
					democratic = 15
					neutrality = 5
				}
				set_stability = 0.6
				set_war_support = 0.5
				if = {
					limit = {
						owns_state = 172
					}
					set_capital = { state = 172 }
				}
				else = {
					random_owned_state = {
						limit = {
							is_controlled_by = SPA
							is_core_of = SPA
							NOT = {
								state = 177
								state = 178
							}
						}
						SPA = {
							set_capital = { state = PREV }
						}
					}
				}
				delete_unit_template_and_units = {
					division_template = "Requeté Carlista"
				}
				set_party_name = { ideology = neutrality long_name = SPR_neutrality_military_junta_party_long name = SPR_neutrality_military_junta_party }
			}
			set_party_name = { ideology = neutrality long_name = SPR_neutrality_party_long name = SPR_neutrality_party }
			add_popularity = {
			    ideology = fascism
			    popularity = -0.35
			}
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPA
				stockpile_ratio = 0.4
				army_ratio = 0.3
				navy_ratio = 0.3
				air_ratio = 0.3
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPA_carlist_loyalties
				}
			}
			set_division_template_lock = {
			    division_template = "Requeté Carlista"
			    is_locked = no
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_falangist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_falangist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPA
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_carlist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_carlist_loyalties
			}
			SPA = {
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_falangist_loyalties
					}
					remove_unit_leader_trait = trait_SPA_falangist_loyalties
				}
				every_unit_leader = {
					limit = {
						has_trait = trait_SPA_nationalist_sympathies
					}
					remove_unit_leader_trait = trait_SPA_nationalist_sympathies
				}
				declare_war_on = {
				    target = ROOT
				    type = civil_war
				}
				add_civil_war_target = ROOT
				add_ai_strategy = {
					type = antagonize
					id = SPB
					value = 200
				}
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD

				add_ai_strategy = {
					type = antagonize
					id = SPD
					value = 200
				}
				if = {
					limit = {
						country_exists = SPC
					}
					declare_war_on = {
					    target = SPC
					    type = civil_war
					}
					add_civil_war_target = SPC

					add_ai_strategy = {
						type = antagonize
						id = SPC
						value = 200
					}
				}
			}
			every_other_country = {
				add_ai_strategy = {
					type = support
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = protect
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = befriend
					id = SPB
					value = -200
				}
				add_ai_strategy = {
					type = alliance
					id = SPB
					value = -200
				}
			}
			SPA = {
				load_focus_tree = {
					tree = spanish_focus
					keep_completed = no
				}
				unlock_national_focus = SPA_a_great_spain
				unlock_national_focus = SPA_hand_over_the_ceda_campaign_chest
				unlock_national_focus = SPA_negotiate_carlist_support
				unlock_national_focus = SPA_the_army_of_africa
				unlock_national_focus = SPA_secure_the_northern_garrisons
				unlock_national_focus = SPA_sin_paquito
				complete_national_focus = SPA_the_phalanx_ascendant
				complete_national_focus = SPA_secure_the_national_defense_council
				complete_national_focus = SPA_suspend_the_constitution
				unlock_national_focus = SPA_eliminate_the_carlists
				complete_national_focus = SPA_primo_de_rivera_prisoner_exchange
				complete_national_focus = SPA_establish_the_directory
				add_timed_idea = { idea = SPA_death_before_surrender days = 900 }
			}

			## SPB triggers Carlist Uprising ##
			### All foreign Aid goes to SPA ###
			if = {#Country supporting SPA
				limit = { 
					any_country = { has_country_flag = supports_SPA_flag }
				}
				every_country = {
					limit = {
						 has_country_flag = supports_SPA_flag
					}
					diplomatic_relation = {
						country = SPA
						relation = military_access
						active = yes
					}
					SPA = {
						diplomatic_relation = {
							country = PREV
							relation = military_access
							active = yes
						}
					}
					#Join war against all SPA enemies
					every_country = {
						limit = { has_war_with = SPA }
						PREV = {
							add_to_war = {
								targeted_alliance = SPA
								enemy = PREV
								hostility_reason = asked_to_join
							}
						}
					}
				}
			
				#Transfer troops in territory belonging to SPA allies back home
				every_state = {
					limit = {
						NOT = { is_fully_controlled_by = ROOT }
						owner = {
							has_war_together_with = SPA
						}
					}
					teleport_armies = {
						limit = { 
							tag = SPB
						}
						to_state_array = owned_controlled_states
					}
				}
			}
			if = {	#Country supporting SPD
				limit = {
					any_country = { has_country_flag = supports_SPD_flag }
				}
				every_country = {
					limit = {
						has_country_flag = supports_SPD_flag
					}
					# Country joins war against SPA
					add_to_war = { targeted_alliance = SPD enemy = SPA hostility_reason = asked_to_join }
				}
				if = {
					limit = {
						any_country = { has_country_flag = POR_non_aligned_portugal_supports_SPA_flag }
					}
					random_country = { #Portuguese Non-aligned tag (spawned via Workers of Iberia, Unite! focus) will join war
						limit = {
							has_country_flag = POR_non_aligned_portugal_supports_SPA_flag
						}
						add_to_war = { targeted_alliance = SPA enemy = SPB hostility_reason = asked_to_join }
					}
				}
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
				}
				add_core_of = SPB
				add_core_of = SPA
			}
			news_event = { id = lar_news.10 days = 1 }
		}
	}
	
	option = {
		name = lar_spain.8.a
		effect_tooltip = {
			if = {
				limit = {
					NOT = { has_government = neutrality }
				}
				set_politics = {
					ruling_party = neutrality
				}
			}
			add_popularity = {
			    ideology = fascism
			    popularity = -0.35
			}
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPA
				stockpile_ratio = 0.4
				army_ratio = 0.3
				navy_ratio = 0.3
				air_ratio = 0.3
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPA_carlist_loyalties
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_falangist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_falangist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPA
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPA_carlist_loyalties
				}
				remove_unit_leader_trait = trait_SPA_carlist_loyalties
			}
			set_division_template_lock = {
			    division_template = "Requeté Carlista"
			    is_locked = no
			}
			SPA = {
				declare_war_on = {
				    target = ROOT
				    type = civil_war
				}
				add_civil_war_target = ROOT
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD
				if = {
					limit = {
						country_exists = SPC
					}
					declare_war_on = {
					    target = SPC
					    type = civil_war
					}
					add_civil_war_target = SPC
				}
			}
		}
		random_state = {
			limit = {
				has_state_flag = SPA_union_militar_flag
			}
			create_unit = {
				division = "division_template = \"Requeté Carlista\" start_experience_factor = 0.3" 
				owner = SPB
				allow_spawning_on_enemy_provs = yes
				count = 5
			}
		}
	}
}

# Spanish Civil War - Anarchists rise up ("player" goes SPD)
country_event = {
	id = lar_spain.9
	title = lar_spain.9.t
	desc = {
		text = lar_spain.9.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_spain.9.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_report_event_spr_anarchist_uprising2
	
	fire_only_once = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_global_flag = SPR_anarchist_uprising_flag
			set_global_flag = { flag = SPR_civil_war_startup value = 1 days = 3 } # Make AI avoid attacking for a few days
			if = { #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
				limit = {
					has_global_flag = SOV_covert_support_for_poum_flag
				}
				if = {
					limit = {
						communism > 0.03
					}
					set_political_party = {
					    ideology = communism
					    popularity = 3
					}
				}
				add_popularity = {
				    ideology = neutrality
				    popularity = -0.05
				}
				SPC = {
					set_rule = {
						can_generate_female_aces = yes
					}
					set_politics = {
						ruling_party = communism
					}
					set_popularities = {
						communism = 58
						democratic = 2
						neutrality = 40
					}
					create_country_leader = {
						name = "Julián Gorkin"
						desc = "POLITICS_JULIAN_GORKIN_DESC"
						picture = "GFX_portrait_SPR_julian_gorkin"
						expire = "1965.1.1"
						ideology = anarchist_communism
						traits = {
							militant_socialist
						}
					}
					#Check for covert depots from Soviets
					if = {
						limit = {
							has_global_flag = SOV_poum_has_covert_depots_from_soviets_flag
						}
						add_equipment_to_stockpile = {
							type = infantry_equipment
							amount = 6000
							producer = SOV
						}
						add_equipment_to_stockpile = {
							type = support_equipment
							amount = 600
							producer = SOV
						}
						add_equipment_to_stockpile = {
							type = artillery_equipment
							amount = 120
							producer = SOV
						}
						add_equipment_to_stockpile = {
							type = motorized_equipment
							amount = 60
							producer = SOV
						}
						add_equipment_to_stockpile = {
							type = train_equipment
							amount = 6
							producer = SOV
						}
						add_opinion_modifier = {
							target = SOV
							modifier = SOV_sent_us_weapons
						}
					}
				}
			}
			else = { #REGULAR ANARCHIST UPRISING
				if = {
					limit = {
						neutrality > 0.03
					}
					set_political_party = {
					    ideology = neutrality
					    popularity = 3
					}
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.05
				}
				SPC = {
					set_rule = {
					    can_puppet = no
					    can_create_factions = no
					    can_join_factions = no
					    can_boost_own_ideology = no
						can_generate_female_aces = yes
						can_create_collaboration_government = no
					}
					set_politics = {
						ruling_party = neutrality
					}
					set_popularities = {
						communism = 40
						democratic = 2
						neutrality = 58
					}
					create_country_leader = {
						name = "Anarchist Commune"
						desc = "POLITICS_ANARCHIST_COMMUNE_DESC"
						picture = "GFX_portrait_SPR_anarchist_commune"
						expire = "1965.1.1"
						ideology = anarchism
						traits = {
							our_right_to_survive
						}
					}
				}
			}

			if = {
				limit = {
					OR = {
						controls_state = 165
						controls_state = 492
						controls_state = 166
					}
				}
				every_state = {
					limit = {
						OR = {
							state = 165
							state = 492
							state = 166
						}
						is_capital = no
						is_controlled_by = ROOT
					}
					SPC = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						SPC = {
							NOT = {
								AND = {
									controls_state = 165
									controls_state = 492
									controls_state = 166
								}
							}
						}
						num_of_controlled_states > 8
					}
					random_state = {
						limit = {
							NOT = { state = 178 }
							NOT = { state = 177 }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									state = 166
								}
								is_owned_by = SPC
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPC = {
							transfer_state = PREV
						}
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 15
						has_global_flag = scw_early_end
					}
					SPC = {
						transfer_state = 167
					}
					random_owned_state = {
						limit = {
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									state = 166
									state = 167
								}
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPC = {
							transfer_state = PREV
						}
					}
					random_owned_state = {
						limit = {
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									state = 166
									state = 167
								}
							}
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPC = {
							transfer_state = PREV
						}
					}
				}
			}
			else = { # You're not getting out of a civil war by voluntarily giving up the targetable locations, pal!
				random_state = {
					limit = {
						NOT = { state = 178 }
						NOT = { state = 177 }
						has_state_flag = SPR_core_of_spain_flag
						is_controlled_by = ROOT
						is_capital = no
					}
					SPC = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 3
					}
					random_state = {
						limit = {
							NOT = { state = 178 }
							NOT = { state = 177 }
							has_state_flag = SPR_core_of_spain_flag
							is_controlled_by = ROOT
							is_capital = no
						}
						SPC = {
							transfer_state = PREV
						}
					}
				}
			}
			if = {
				limit = {
					SPC = {
						owns_state = 165
					}
				}
				SPC = { set_capital = { state = 165 } }
			}
			else = {
				SPC = {
					random_owned_state = {
						limit = {
							is_controlled_by = SPC
							is_core_of = SPC
							NOT = {
								state = 177
								state = 178
							}
						}
						SPC = { set_capital = { state = PREV } }
					}
				}
			}
			SPC = {
				inherit_technology = SPD

				if = { #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
					limit = {
						has_global_flag = SOV_covert_support_for_poum_flag
					}
					set_politics = {
						ruling_party = communism
						last_election = "1933.4.26"
						election_frequency = 48
						elections_allowed = no
					}
					set_popularities = {
						neutrality = 15
						communism = 80
						democratic = 5
					}

				}
				else = { #REGULAR ANARCHIST UPRISING
					set_politics = {
						ruling_party = neutrality
						last_election = "1933.4.26"
						election_frequency = 48
						elections_allowed = no
					}
					set_popularities = {
						neutrality = 80
						communism = 15
						democratic = 5
					}
				}
				
				remove_ideas = SPR_the_maximum_concession
				add_ideas = closed_economy
				set_stability = 0.6
				set_war_support = 0.5
				division_template = { #No matter if POUM or Anarchist split, what really matters is the triumph of the revolution during the SCW
					name = "Brigada Anarquista"
					template_counter = 0
					priority = 1
					division_names_group = SPD_INF_04
					is_locked = yes
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
				}
				every_owned_state = {
					create_unit = {
						division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
						owner = SPC
					}
					create_unit = {
						division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
						owner = SPC
					}
					create_unit = {
						division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
						owner = SPC
					}
				}
				if = {
					limit = {
						num_of_controlled_states < 3
					}
					every_owned_state = {
						create_unit = {
							division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
							owner = SPC
						}
						create_unit = {
							division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
							owner = SPC
						}
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								num_of_controlled_states > 2
								num_of_controlled_states < 4
							}
							has_global_flag = scw_early_end
						}
					}
					every_owned_state = {
						create_unit = {
							division = "division_template = \"Brigada Anarquista\" start_experience_factor = 0 start_equipment_factor = 0.25" 
							owner = SPC
						}
					}
				}
			}
			add_popularity = {
			    ideology = neutrality
			    popularity = -0.25
			}
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPC
				stockpile_ratio = 0.2
				army_ratio = 0.1
				navy_ratio = 0.1
				air_ratio = 0.1
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					OR = {
						has_trait = trait_SPR_republican_loyalties
						has_trait = trait_SPR_stalinist_loyalties
					}
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_republican_loyalties
				}
				remove_unit_leader_trait = trait_SPR_republican_loyalties
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_stalinist_loyalties
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPC
				}
			}
			SPC = {
				every_unit_leader = {
					limit = {
						has_trait = trait_SPR_anti_stalinist_loyalties
					}
					remove_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
				}
				declare_war_on = {
				    target = SPA
				    type = civil_war
				}
				add_civil_war_target = SPA

				add_ai_strategy = {
					type = antagonize
					id = SPA
					value = 200
				}
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD

				add_ai_strategy = {
					type = antagonize
					id = SPD
					value = 200
				}
				if = {
					limit = {
						country_exists = SPB
					}
					declare_war_on = {
					    target = SPB
					    type = civil_war
					}
					add_civil_war_target = SPB

					add_ai_strategy = {
						type = antagonize
						id = SPB
						value = 200
					}
				}
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_anti_fascist_workers_revolution
					NOT = {
						has_completed_focus = SPR_the_stalinist_doctrine
					}
				}
				complete_national_focus = SPR_the_stalinist_doctrine
			}
			SPC = {
				load_focus_tree = {
					tree = spanish_focus
					keep_completed = no
				}
				set_party_name = { ideology = neutrality long_name = SPR_neutrality_anarchism_party_long name = SPR_neutrality_anarchism_party }
				set_party_name = { ideology = communism long_name = SPR_communism_independent_party_long name = SPR_communism_independent_party }
				create_country_leader = {
					name = "Anarchist Commune"
					desc = "POLITICS_ANARCHIST_COMMUNE_DESC"
					picture = "GFX_portrait_SPR_anarchist_commune"
					expire = "1965.1.1"
					ideology = anarchism
					traits = {
						our_right_to_survive
					}
				}
				unlock_national_focus = SPR_the_popular_front
				if = {
					limit = {
						SPD = { has_completed_focus = SPR_secure_the_guardia_civil }
					}
					unlock_national_focus = SPR_secure_the_guardia_civil
				}
				if = {
					limit = {
						SPD = { has_completed_focus = SPR_secure_the_guardia_de_asalto }
					}
					unlock_national_focus = SPR_secure_the_guardia_de_asalto
				}
				unlock_national_focus = SPR_train_the_union_youth
				unlock_national_focus = SPR_enlarge_the_weapon_caches
				unlock_national_focus = SPR_distribute_arms_to_the_people
				unlock_national_focus = SPR_disband_the_army
				if = { #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
					limit = {
						has_global_flag = SOV_covert_support_for_poum_flag
					}
					complete_national_focus = SPR_the_anti_fascist_workers_revolution
					complete_national_focus = SPR_arm_the_workers_militias
					complete_national_focus = SPR_demand_ministerial_positions
					unlock_national_focus = SPR_hinder_nkvd_interference
				}
				else = { #REGULAR ANARCHIST UPRISING
					complete_national_focus = SPR_regional_defense_council_of_aragon
					complete_national_focus = SPR_arm_the_people
					complete_national_focus = SPR_appropriate_the_means_of_production
					unlock_national_focus = SPR_the_maximum_concession
				}
				unlock_national_focus = SPR_seize_the_gold_reserves
				unlock_national_focus = SPR_masters_of_our_own_fate
				add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
			}

			## SPD triggers Anarchist Uprising ##
			# If any country has already joined SCW, it will join the war against SPC as well
			if = { #Country supporting SPD
				limit = {
					any_country = { has_country_flag = supports_SPD_flag }
				}
				every_country = {
					limit = { has_country_flag = supports_SPD_flag }
					add_to_war = { targeted_alliance = SPD enemy = SPC hostility_reason = asked_to_join }
				}
				if = { #Portuguese Non-aligned tag (spawned via Workers of Iberia, Unite! focus) will join war
					limit = {
						any_country = { has_country_flag = POR_non_aligned_portugal_supports_SPA_flag }
					}
					random_country = {
						limit = {
							has_country_flag = POR_non_aligned_portugal_supports_SPA_flag
						}
						add_to_war = { targeted_alliance = SPA enemy = SPC hostility_reason = asked_to_join }
					}
				}
			}
			if = { #Country supporting SPA
				limit = {
					any_country = { has_country_flag = supports_SPA_flag }
				}
				every_country = {
					limit = { has_country_flag = supports_SPA_flag }
					add_to_war = { targeted_alliance = SPA enemy = SPC hostility_reason = asked_to_join }
				}
			}
			if = { #Country supporting SPB
				limit = {
					any_country = { has_country_flag = supports_SPB_flag }
				}
				every_country = {
					limit = { has_country_flag = supports_SPB_flag }
					add_to_war = { targeted_alliance = SPB enemy = SPC hostility_reason = asked_to_join }
				}
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
				}
				add_core_of = SPC
			}
			news_event = { id = lar_news.11 days = 1 }
		}
	}
	
	option = {
		name = lar_spain.9.a
		effect_tooltip = {
			if = { #POUM UPRISING (SUPPORTED BY SOVIET RIGHT OPPOSITION)
				limit = {
					has_global_flag = SOV_covert_support_for_poum_flag
				}
				if = {
					limit = {
						communism > 0.03
					}
					set_political_party = {
					    ideology = communism
					    popularity = 3
					}
				}
				add_popularity = {
				    ideology = neutrality
				    popularity = -0.05
				}
			}
			else = { #REGULAR ANARCHIST UPRISING
				if = {
					limit = {
						neutrality > 0.03
					}
					set_political_party = {
					    ideology = neutrality
					    popularity = 3
					}
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.05
				}
			}
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPC
				stockpile_ratio = 0.2
				army_ratio = 0.1
				navy_ratio = 0.1
				air_ratio = 0.1
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					OR = {
						has_trait = trait_SPR_republican_loyalties
						has_trait = trait_SPR_stalinist_loyalties
					}
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_republican_loyalties
				}
				remove_unit_leader_trait = trait_SPR_republican_loyalties
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_stalinist_loyalties
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPC
				}
			}
			SPC = {
				declare_war_on = {
				    target = SPA
				    type = civil_war
				}
				add_civil_war_target = SPA
				declare_war_on = {
				    target = SPD
				    type = civil_war
				}
				add_civil_war_target = SPD
				if = {
					limit = {
						country_exists = SPB
					}
					declare_war_on = {
					    target = SPB
					    type = civil_war
					}
					add_civil_war_target = SPB
				}
			}
		}
	}
}

# Spanish Civil War - Republican Crack-Down ("player" goes SPC)
country_event = {
	id = lar_spain.10
	title = lar_spain.10.t
	desc = {
		text = lar_spain.10.desc
		trigger = {
			NOT = { has_global_flag = scw_early_end }
		}
	}
	desc = {
		text = lar_spain.10.desc_2
		trigger = {
			has_global_flag = scw_early_end
		}
	}
	picture = GFX_report_event_spr_solidify_the_frontlines
	
	fire_only_once = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_other_country = { #Default
				limit = {
					ROOT = {
						has_volunteers_amount_from = {
							tag = PREV
							count > 0
						}
					}
				}
				recall_volunteers_from = ROOT
			}
			
			set_global_flag = SPR_anarchist_uprising_flag
			set_global_flag = { flag = SPR_civil_war_startup value = 1 days = 3 } # Make AI avoid attacking for a few days
			if = {
				limit = {
					has_completed_focus = SPR_regional_defense_council_of_aragon
				}
				set_politics = {
					ruling_party = neutrality
				}
				set_party_name = { ideology = communism long_name = SPR_communism_independent_party_long name = SPR_communism_independent_party }
				create_country_leader = {
					name = "Julián Gorkin"
					desc = "POLITICS_JULIAN_GORKIN_DESC"
					picture = "GFX_portrait_SPR_julian_gorkin"
					expire = "1965.1.1"
					ideology = anarchist_communism
					traits = {
						militant_socialist
					}
				}
				create_country_leader = {
					name = "Anarchist Commune"
					desc = "POLITICS_ANARCHIST_COMMUNE_DESC"
					picture = "GFX_portrait_SPR_anarchist_commune"
					expire = "1965.1.1"
					ideology = anarchism
					traits = {
						our_right_to_survive
					}
				}
				add_popularity = {
				    ideology = fascism
				    popularity = -1
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.25
				}
				if = {
					limit = {
						democratic > 0.01
					}
					set_political_party = {
					    ideology = democratic
					    popularity = 1
					}
				}
				set_rule = {
				    can_puppet = no
				    can_create_factions = no
				    can_join_factions = no
				    can_boost_own_ideology = no
					can_generate_female_aces = yes
					can_create_collaboration_government = no
				}
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_anti_fascist_workers_revolution
				}
				set_politics = {
					ruling_party = communism
				}
				set_party_name = { ideology = communism long_name = SPR_communism_independent_party_long name = SPR_communism_independent_party }
				create_country_leader = {
					name = "Julián Gorkin"
					desc = "POLITICS_JULIAN_GORKIN_DESC"
					picture = "GFX_portrait_SPR_julian_gorkin"
					expire = "1965.1.1"
					ideology = anarchist_communism
					traits = {
						militant_socialist
					}
				}
				add_popularity = {
				    ideology = fascism
				    popularity = -1
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.05
				}
				if = {
					limit = {
						democratic > 0.01
					}
					set_political_party = {
					    ideology = democratic
					    popularity = 1
					}
				}
				#create_field_marshal = {
				#	name = "José Rovira"
				#	portrait_path = "gfx/leaders/Europe/Portrait_Europe_Generic_land_5.dds"
				#	traits = { infantry_officer politically_connected }
				#	skill = 3
				#    attack_skill = 2
				#    defense_skill = 2
				#    planning_skill = 2
				#    logistics_skill = 3
				#}
				add_field_marshal_role = { #TODO_Manu: All these guys should be handled with the new char system
					character = SPR_jose_rovira
					traits = { infantry_officer politically_connected }
					skill = 3
				    attack_skill = 2
				    defense_skill = 2
				    planning_skill = 2
				    logistics_skill = 3
				}
				create_corps_commander = {
					name = "Carmel Rosa Baserba"
					portrait_path = "gfx/leaders/Europe/Portrait_Europe_Generic_land_1.dds"
					traits = { trait_cautious infantry_officer }
					skill = 3
				    attack_skill = 2
				    defense_skill = 2
				    planning_skill = 2
				    logistics_skill = 2
				}
				create_corps_commander = {
					name = "Luis Rastrollo"
					portrait_path = "gfx/leaders/Europe/Portrait_Europe_Generic_land_19.dds"
					traits = { politically_connected }
					skill = 1
				    attack_skill = 1
				    defense_skill = 2
				    planning_skill = 1
				    logistics_skill = 1
				}
				set_rule = { can_generate_female_aces = yes	}

				#Check for covert depots from Soviets
				if = {
					limit = {
						has_global_flag = SOV_poum_has_covert_depots_from_soviets_flag
					}
					add_equipment_to_stockpile = {
						type = infantry_equipment
						amount = 6000
						producer = SOV
					}
					add_equipment_to_stockpile = {
						type = support_equipment
						amount = 600
						producer = SOV
					}
					add_equipment_to_stockpile = {
						type = artillery_equipment
						amount = 120
						producer = SOV
					}
					add_equipment_to_stockpile = {
						type = motorized_equipment
						amount = 60
						producer = SOV
					}
					add_equipment_to_stockpile = {
						type = train_equipment
						amount = 6
						producer = SOV
					}
					add_opinion_modifier = {
						target = SOV
						modifier = SOV_sent_us_weapons
					}
				}
			}
			remove_ideas = SPR_the_maximum_concession
			add_ideas = closed_economy
			SPC = {
				clr_country_flag = SPR_anarchist_spain_flag
				drop_cosmetic_tag = yes
				set_country_flag = SPR_republican_spain_flag
				set_cosmetic_tag = SPR_republican_spain
			}
			clr_country_flag = SPR_republican_spain_flag
			drop_cosmetic_tag = yes
			set_country_flag = SPR_anarchist_spain_flag
			set_cosmetic_tag = SPR_anarchist_spain
			if = {
				limit = {
					controls_state = 165
					controls_state = 492
				}
				set_capital = { state = 165 }
				every_state = {
					limit = {
						OR = {
							state = 165
							state = 492
							state = 166
						}
						is_controlled_by = ROOT
					}
					set_state_flag = SPR_anarchist_state_flag
				}
				if = {
					limit = {
						num_of_controlled_states > 7
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							NOT = { state = 41 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 9
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							NOT = { state = 41 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 11
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							NOT = { state = 41 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 13
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							NOT = { state = 41 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 15
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 17
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				if = {
					limit = {
						num_of_controlled_states > 19
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
					random_state = {
						limit = {
							NOT = { state = 165 }
							NOT = { state = 492 }
							NOT = { state = 166 }
							is_controlled_by = ROOT
							NOT = { has_state_flag = SPR_anarchist_state_flag }
							any_neighbor_state = {
								OR = {
									state = 165
									state = 492
									has_state_flag = SPR_anarchist_state_flag
								}
							}
						}
						set_state_flag = SPR_anarchist_state_flag
					}
				}
				every_state = {
					limit = {
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPR_anarchist_state_flag }
					}
					SPD = {
						transfer_state = PREV
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						controls_state = 165
						controls_state = 166
						controls_state = 492
					}
				}
				random_owned_state = {
					limit = {
						NOT = { state = 165 }
						NOT = { state = 492 }
						NOT = { state = 166 }
						is_controlled_by = ROOT
					}
					set_state_flag = SPR_anarchist_state_flag
				}
				every_state = {
					limit = {
						has_state_flag = SPR_core_of_spain_flag
						NOT = { state = 165 }
						NOT = { state = 492 }
						NOT = { state = 166 }
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPR_anarchist_state_flag }
					}
					SPD = {
						transfer_state = PREV
					}
				}
				if = {
					limit = {
						owns_state = 165
					}
					set_capital = { state = 165 }
				}
				if = {
					limit = {
						NOT = { owns_state = 165 }
					}
					random_owned_state = {
						limit = {
							is_controlled_by = ROOT
							is_core_of = ROOT
							NOT = {
								state = 177
								state = 178
							}
						}
						ROOT = { set_capital = { state = PREV } }
					}
				}
			}
			else = {
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
					}
					set_state_flag = SPR_anarchist_state_flag
				}
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPR_anarchist_state_flag }
					}
					set_state_flag = SPR_anarchist_state_flag
				}
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPR_anarchist_state_flag }
					}
					set_state_flag = SPR_anarchist_state_flag
				}
				every_state = {
					limit = {
						is_controlled_by = ROOT
						NOT = { has_state_flag = SPR_anarchist_state_flag }
					}
					SPD = {
						transfer_state = PREV
					}
				}
				random_owned_state = {
					limit = {
						is_controlled_by = ROOT
					}
					ROOT = { set_capital = { state = PREV } }
				}
			}
			SPD = {
				inherit_technology = SPC
				set_politics = {
					ruling_party = democratic
					last_election = "1933.4.26"
					election_frequency = 48
					elections_allowed = yes
				}
				set_popularities = {
					democratic = 61
					communism = 35
					neutrality = 3
					fascism = 1
				}
				set_stability = 0.6
				set_war_support = 0.5
				if = {
					limit = {
						SPD = { controls_state = 41 }
					}
					SPD = { set_capital = { state = 41 } }
				}
				else = {
					random_owned_state = {
						limit = {
							is_controlled_by = SPD
							is_core_of = SPD
							NOT = {
								state = 177
								state = 178
							}
						}
						SPD = {
							set_capital = { state = PREV }
						}
					}
				}
			}
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPD
				stockpile_ratio = 0.4
				army_ratio = 0.3
				navy_ratio = 0.3
				air_ratio = 0.3
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
			}
			
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_republican_loyalties
				}
				remove_unit_leader_trait = trait_SPR_republican_loyalties
				set_nationality = {
					character = THIS
					target_country = SPD
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_stalinist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPD
				}
			}
			every_unit_leader = {
				limit = {
					has_id = 1108
				}
				set_nationality = {
					character = THIS
					target_country = SPD
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
			}
			SPD = {
				every_unit_leader = {
					limit = {
						has_trait = trait_SPR_republican_loyalties
					}
					remove_unit_leader_trait = trait_SPR_republican_loyalties
				}
				every_unit_leader = {
					limit = {
						has_trait = trait_SPR_stalinist_loyalties
					}
					remove_unit_leader_trait = trait_SPR_stalinist_loyalties
				}
				declare_war_on = {
				    target = SPA
				    type = civil_war
				}
				add_civil_war_target = SPA

				add_ai_strategy = {
					type = antagonize
					id = SPA
					value = 200
				}
				declare_war_on = {
				    target = SPC
				    type = civil_war
				}
				add_civil_war_target = SPC

				add_ai_strategy = {
					type = antagonize
					id = SPC
					value = 200
				}
				if = {
					limit = {
						country_exists = SPB
					}
					declare_war_on = {
					    target = SPB
					    type = civil_war
					}
					add_civil_war_target = SPB

					add_ai_strategy = {
						type = antagonize
						id = SPB
						value = 200
					}
				}
			}
			SPD = {
				create_country_leader = {
					name = "Manuel Azaña"
					desc = "POLITICS_MANUEL_AZANA_DESC"
					picture = "Portrait_Spain_Manuel_Azana.dds"
					expire = "1965.1.1"
					ideology = conservatism
					traits = {
						figurehead_president
					}
				}
				load_focus_tree = {
					tree = spanish_focus
					keep_completed = no
				}
				unlock_national_focus = SPR_the_popular_front
				if = {
					limit = {
						SPC = { has_completed_focus = SPR_secure_the_guardia_civil }
					}
					unlock_national_focus = SPR_secure_the_guardia_civil
				}
				if = {
					limit = {
						SPC = { has_completed_focus = SPR_secure_the_guardia_de_asalto }
					}
					unlock_national_focus = SPR_secure_the_guardia_de_asalto
				}
				unlock_national_focus = SPR_train_the_union_youth
				unlock_national_focus = SPR_enlarge_the_weapon_caches
				unlock_national_focus = SPR_distribute_arms_to_the_people
				unlock_national_focus = SPR_disband_the_army
				complete_national_focus = SPR_maintain_the_second_republic
				complete_national_focus = SPR_new_leadership
				complete_national_focus = SPR_the_future_of_the_republic
				complete_national_focus = SPR_reaffirm_the_popular_front_strategy
				unlock_national_focus = SPR_crush_the_revolution
				add_timed_idea = { idea = SPR_death_before_surrender days = 900 }
			}

			## SPC triggers Anarchist Uprising ##
			### Foreign aid goes to SPD ###
			#Op. modifier goes to SPD.
			if = { #Country supporting SPD
				limit = {
					any_country = { has_country_flag = supports_SPD_flag }
				}
				every_country = {
					limit = {
						 has_country_flag = supports_SPD_flag
					}
					diplomatic_relation = {
						country = SPD
						relation = military_access
						active = yes
					}
					SPD = {
						diplomatic_relation = {
							country = PREV
							relation = military_access
							active = yes
						}
					}
					#Join war against all SPD enemies
					every_country = {
						limit = { has_war_with = SPD }
						PREV = {
							add_to_war = {
								targeted_alliance = SPD
								enemy = PREV
								hostility_reason = asked_to_join
							}
						}
					}
				}
				#Transfer troops in territory belonging to SPD allies back home
				every_state = {
					limit = {
						NOT = { is_fully_controlled_by = ROOT }
						owner = {
							has_war_together_with = SPD
						}
					}
					teleport_armies = {
						limit = { 
							tag = SPC
						}
						to_state_array = owned_controlled_states
					}
				}
				if = { #Portuguese Non-aligned tag (spawned via Workers of Iberia, Unite! focus) will join war
					limit = {
						any_country = { has_country_flag = POR_non_aligned_portugal_supports_SPA_flag }
					}
					random_country = {
						limit = {
							has_country_flag = POR_non_aligned_portugal_supports_SPA_flag
						}
						add_to_war = { targeted_alliance = SPA enemy = SPD hostility_reason = asked_to_join }
					}
				}
			}
			if = {	#Country supporting SPA
				limit = {
					any_country = { has_country_flag = supports_SPA_flag }
				}
				every_country = {# Country joins war against SPD
					limit = { has_country_flag = supports_SPA_flag }
					add_to_war = { targeted_alliance = SPA enemy = SPD hostility_reason = asked_to_join }
				}
			}
			if = {	#Country supporting SPB
				limit = {
					any_country = { has_country_flag = supports_SPB_flag }
				}
				every_country = {# Country joins war against SPD
					limit = { has_country_flag = supports_SPB_flag }
					add_to_war = { targeted_alliance = SPB enemy = SPD hostility_reason = asked_to_join }
				}
			}
			every_state = {
				limit = {
					has_state_flag = SPR_core_of_spain_flag
				}
				add_core_of = SPC
				add_core_of = SPD
			}
			news_event = { id = lar_news.11 days = 1 }
		}
	}
	
	option = {
		name = lar_spain.10.a
		effect_tooltip = {
			if = {
				limit = {
					has_completed_focus = SPR_regional_defense_council_of_aragon
					NOT = { has_government = neutrality }
				}
				set_politics = {
					ruling_party = neutrality
				}
				create_country_leader = {
					name = "Anarchist Commune"
					desc = "POLITICS_ANARCHIST_COMMUNE_DESC"
					picture = "GFX_portrait_SPR_anarchist_commune"
					expire = "1965.1.1"
					ideology = anarchism
					traits = {
						our_right_to_survive
					}
				}
				add_popularity = {
				    ideology = fascism
				    popularity = -1
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.15
				}
				if = {
					limit = {
						democratic > 0.01
					}
					set_political_party = {
					    ideology = democratic
					    popularity = 1
					}
				}
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_anti_fascist_workers_revolution
					NOT = { has_government = communism }
				}
				set_politics = {
					ruling_party = communism
				}
				create_country_leader = {
					name = "Julián Gorkin"
					desc = "POLITICS_JULIAN_GORKIN_DESC"
					picture = "GFX_portrait_SPR_julian_gorkin"
					expire = "1965.1.1"
					ideology = anarchist_communism
					traits = {
						militant_socialist
					}
				}
				add_popularity = {
				    ideology = fascism
				    popularity = -1
				}
				add_popularity = {
				    ideology = communism
				    popularity = -0.05
				}
				if = {
					limit = {
						democratic > 0.01
					}
					set_political_party = {
					    ideology = democratic
					    popularity = 1
					}
				}
			}
			remove_ideas = SPR_the_maximum_concession
			add_ideas = closed_economy
			add_stability = -0.1
			transfer_units_fraction = {
				target = SPD
				stockpile_ratio = 0.4
				army_ratio = 0.3
				navy_ratio = 0.3
				air_ratio = 0.3
				keep_unit_leaders = {
				    
				}
				keep_unit_leaders_trigger = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_republican_loyalties
				}
				remove_unit_leader_trait = trait_SPR_republican_loyalties
				set_nationality = {
					character = THIS
					target_country = SPD
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_stalinist_loyalties
				set_nationality = {
					character = THIS
					target_country = SPD
				}
			}
			every_unit_leader = {
				limit = {
					has_trait = trait_SPR_anti_stalinist_loyalties
				}
				remove_unit_leader_trait = trait_SPR_anti_stalinist_loyalties
			}
			SPD = {
				declare_war_on = {
				    target = SPA
				    type = civil_war
				}
				add_civil_war_target = SPA
				declare_war_on = {
				    target = SPC
				    type = civil_war
				}
				add_civil_war_target = SPC
				if = {
					limit = {
						country_exists = SPB
					}
					declare_war_on = {
					    target = SPB
					    type = civil_war
					}
					add_civil_war_target = SPB
				}
			}
		}
	}
}

# Spanish Civil War - Carlists Defeated
country_event = {
	id = lar_spain.11
	title = lar_spain.11.t
	desc = lar_spain.11.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Fascists Defeated
country_event = {
	id = lar_spain.12
	title = lar_spain.12.t
	desc = lar_spain.12.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Franco Defeated
country_event = {
	id = lar_spain.13
	title = lar_spain.13.t
	desc = lar_spain.13.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Anarchists Defeated
country_event = {
	id = lar_spain.14
	title = lar_spain.14.t
	desc = lar_spain.14.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Independent Communists Defeated
country_event = {
	id = lar_spain.15
	title = lar_spain.15.t
	desc = lar_spain.15.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Republicans Defeated
country_event = {
	id = lar_spain.16
	title = lar_spain.16.t
	desc = lar_spain.16.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes

	option = {
		name = lar_spain.11.a
	}
}

# Spanish Civil War - Stalinist Communists Defeated
country_event = {
	id = lar_spain.17
	title = lar_spain.17.t
	desc = lar_spain.17.desc
	picture = GFX_report_event_spr_civil_war_faction_defeated
	
	is_triggered_only = yes
	
	option = {
		name = lar_spain.11.a
	}
}

# Spain - Nationalists out of focuses to take, have to 'lay low' for a while
country_event = {
	id = lar_spain.18
	title = lar_spain.18.t
	desc = lar_spain.18.desc
	picture = GFX_report_event_spr_nationalist_soldiers
	
	trigger = {
		tag = SPR
		has_completed_focus = SPA_a_great_spain
		NOT = { has_global_flag = spanish_civil_war }
		NOT = { has_global_flag = scw_over }
		date > 1936.8.10
	}


	fire_only_once = yes
	
	option = {
		name = lar_spain.18.a
		add_ideas = SPA_awaiting_the_rebellion
		custom_effect_tooltip = lar_spain.18.a_tt
	}
}

# Reassert American Dominance - Event for American nations
country_event = {
	id = lar_spain.19
	title = lar_spain.19.t
	desc = lar_spain.19.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.19.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				strength_ratio = { tag = FROM ratio > 1 }
			}
		}
		effect_tooltip = {
			FROM = { puppet = ROOT }
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.20 hours = 18 random_hours = 6 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.19.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.5 }
			}
			modifier = {
				factor = 0.8
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.3 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.2 }
			}
			modifier = {
				factor = 0.5
				strength_ratio = { tag = FROM ratio < 0.1 }
			}
		}
		effect_tooltip = {
			FROM = {
				create_wargoal = {
				    type = puppet_wargoal_focus
				    target = ROOT
				}
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.21 hours = 18 random_hours = 6 }
			}
		}
	}
}

# Reassert American Dominance - Notification event for Spain - Target Accepted
country_event = {
	id = lar_spain.20
	title = lar_spain.20.t
	desc = lar_spain.20.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.20.a
		puppet = FROM
	}
}

# Reassert American Dominance - Notification event for Spain - Target Declined
country_event = {
	id = lar_spain.21
	title = lar_spain.21.t
	desc = lar_spain.21.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.21.a
		create_wargoal = {
		    type = puppet_wargoal_focus
		    target = FROM
		}
	}
}


# Latin Bloc - Event for invitees
country_event = {
	id = lar_spain.30
	title = lar_spain.30.t
	desc = lar_spain.30.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.30.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				has_government = democratic
				FROM = { has_government = fascism }
			}
			modifier = {
				factor = 0
				has_government = communism
			}
		}
		effect_tooltip = {
			FROM = {
				add_to_faction = ROOT
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.31 hours = 18 random_hours = 6 }
			}
			add_ai_strategy = {
				type = alliance
				id = FROM
				value = 200
			}
		}
	}

	option = { # Decline
		name = lar_spain.30.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0.5
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0
				has_government = FROM
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.32 hours = 18 random_hours = 6 }
			}
		}
	}
}

# Latin Bloc - Event for Spain - FROM accepted
country_event = {
	id = lar_spain.31
	title = lar_spain.30.t
	desc = lar_spain.31.desc
	picture = GFX_report_event_generic_sign_treaty2
	
	is_triggered_only = yes
	
	option = { # OK
		name = lar_spain.31.a
		add_to_faction = FROM
	}
}

# Latin Bloc - Event for Spain - FROM declined
country_event = {
	id = lar_spain.32
	title = lar_spain.30.t
	desc = lar_spain.32.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # OK
		name = lar_spain.32.a
	}
}

# Spain - Contact the Union Militar Espanola
country_event = {
	id = lar_spain.33
	title = lar_spain.33.t
	desc = lar_spain.33.desc
	picture = GFX_report_event_spr_carlists2
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_state = {
				limit = {
					is_core_of = ROOT
					is_controlled_by = ROOT
					NOT = {
						state = 177
						state = 178
					}
					NOT = { has_state_flag = SPA_carlist_cell_flag }
				}
				set_state_flag = union_militar_temp_flag_1
				save_event_target_as = union_militar_target_state_1
			}
			random_owned_state = {
				limit = {
					is_core_of = ROOT
					is_controlled_by = ROOT
					NOT = {
						state = 177
						state = 178
					}
					NOT = { has_state_flag = SPA_carlist_cell_flag }
					NOT = { has_state_flag = union_militar_temp_flag_1 }
				}
				set_state_flag = union_militar_temp_flag_2
				save_event_target_as = union_militar_target_state_2
			}
			random_owned_state = {
				limit = {
					is_core_of = ROOT
					is_controlled_by = ROOT
					NOT = {
						state = 177
						state = 178
					}
					NOT = { has_state_flag = SPA_carlist_cell_flag }
					NOT = { has_state_flag = union_militar_temp_flag_1 }
					NOT = { has_state_flag = union_militar_temp_flag_2 }
				}
				set_state_flag = union_militar_temp_flag_3
				save_event_target_as = union_militar_target_state_3
			}
		}
	}
	
	option = { # Choose First State
		name = lar_spain.33.a
		trigger = {
			any_owned_state = {
				has_state_flag = union_militar_temp_flag_1
			}
		}
		random_owned_state = {
			limit = {
				has_state_flag = union_militar_temp_flag_1
			}
			custom_effect_tooltip = lar_spain.33_tt
			hidden_effect = {
				set_state_flag = SPA_union_militar_flag
			}
		}
	}

	option = { # Choose Second State
		name = lar_spain.33.b
		trigger = {
			any_owned_state = {
				has_state_flag = union_militar_temp_flag_2
			}
		}
		random_owned_state = {
			limit = {
				has_state_flag = union_militar_temp_flag_2
			}
			custom_effect_tooltip = lar_spain.33_tt
			hidden_effect = {
				set_state_flag = SPA_union_militar_flag
			}
		}
	}

	option = { # Choose Third State
		name = lar_spain.33.c
		trigger = {
			any_owned_state = {
				has_state_flag = union_militar_temp_flag_3
			}
		}
		random_owned_state = {
			limit = {
				has_state_flag = union_militar_temp_flag_3
			}
			custom_effect_tooltip = lar_spain.33_tt
			hidden_effect = {
				set_state_flag = SPA_union_militar_flag
			}
		}
	}
}

# Spain - Settle the Succession Question
country_event = {
	id = lar_spain.34
	title = lar_spain.34.t
	desc = lar_spain.34.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Choose first King
		name = lar_spain.34.a
		ai_chance = {
			base = 66
		}
		set_country_flag = SPB_xavier_king
		custom_effect_tooltip = lar_spain.34.a_tt
	}

	option = { # Choose second King
		name = lar_spain.34.b
		ai_chance = {
			base = 34
		}
		custom_effect_tooltip = lar_spain.34.b_tt
	}
}

# Spain - Restore the Monarchy - ### DEPRECATED, replaced by News Event ###
country_event = {
	id = lar_spain.35
	title = lar_spain.35.t
	desc = lar_spain.35.desc
	picture = GFX_report_event_royal_parade
	
	is_triggered_only = yes
	
	option = { # Establish Monarchy
		name = lar_spain.35.a
		drop_cosmetic_tag = yes
		set_cosmetic_tag = SPB_kingdom
		if = {
			limit = {
				has_country_flag = SPB_xavier_king
			}
			create_country_leader = {
				name = "Javier I"
				desc = "POLITICS_JAVIER_I_DESC"
				picture = "GFX_portrait_SPA_xavier_of_bourbon_parma"
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					the_sacred_king
				}
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = SPB_xavier_king }
				NOT = { has_global_flag = SPB_alfonso_xiii_dead }
			}
			create_country_leader = {
				name = "Alfonso XIII"
				desc = "POLITICS_ALFONSO_XIII_DESC"
				picture = "GFX_portrait_SPA_alfonso_xiii"
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					disgraced_monarch
				}
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = SPB_xavier_king }
				has_global_flag = SPB_alfonso_xiii_dead
			}
			create_country_leader = {
				name = "Jaime IV"
				desc = "POLITICS_JAIME_IV_DESC"
				picture = "GFX_portrait_fra_infante_jaime"
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					the_legitimist
				}
			}
		}
	}
}

# Tangiers Enclave - Event for UK
country_event = {
	id = lar_spain.36
	title = lar_spain.36.t
	desc = lar_spain.36.desc
	picture = GFX_report_event_spr_occupation_of_tangiers
	
	is_triggered_only = yes
	
	option = { # Protest
		name = lar_spain.36.a
		ai_chance = {
			base = 34
			modifier = {
				factor = 3
				has_war = no
			}
			modifier = {
				factor = 2
				has_government = democratic
			}
			modifier = {
				factor = 5
				strength_ratio = {
				    tag = FROM
				    ratio > 5
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
				    tag = FROM
				    ratio > 3
				}
			}
			modifier = {
				factor = 0.5
				strength_ratio = {
				    tag = FROM
				    ratio < 2
				}
			}
			modifier = {
				factor = 0.5
				NOT = { has_political_power > 100 }
			}
			modifier = {
				factor = 0
				strength_ratio = {
				    tag = FROM
				    ratio < 1
				}
			}
			modifier = {
				factor = 0
				is_in_faction_with = FROM
			}
		}
		add_political_power = -200
		custom_effect_tooltip = lar_spain.36_tt
		effect_tooltip = {
			create_wargoal = {
			    type = topple_government
			    target = FROM
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.37 hours = 18 random_hours = 6 }
			}
		}
	}

	option = { # Let it slide
		name = lar_spain.36.b
		ai_chance = {
			base = 66
			modifier = {
				factor = 10
				has_war = yes
			}
			modifier = {
				factor = 5
				has_government = fascism
			}
			modifier = {
				factor = 10
				surrender_progress > 0.1
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.38 hours = 18 random_hours = 6 }
			}
		}
	}
}

# Tangiers Enclave - Event for Spain - UK protested
country_event = {
	id = lar_spain.37
	title = lar_spain.36.t
	desc = lar_spain.37.desc
	picture = GFX_report_event_spr_occupation_of_tangiers
	
	is_triggered_only = yes
	
	option = { # OK
		name = lar_spain.37.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		FROM = {
			create_wargoal = {
			    type = topple_government
			    target = ROOT
			}
		}
		290 = {
			add_extra_state_shared_building_slots = 3
			add_building_construction = {
				type = industrial_complex
				level = 2
				instant_build = yes
			}
		}
	}

	option = { # We must back down
		name = lar_spain.37.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0.5
				strength_ratio = {
				    tag = FROM
				    ratio > 0.6
				}
			}
		}
	}
}

# Tangiers Enclave - Event for Spain - UK let it slide
country_event = {
	id = lar_spain.38
	title = lar_spain.36.t
	desc = lar_spain.38.desc
	picture = GFX_report_event_spr_occupation_of_tangiers
	
	is_triggered_only = yes
	
	option = { # OK
		name = lar_spain.38.a
		290 = {
			add_extra_state_shared_building_slots = 3
			add_building_construction = {
				type = industrial_complex
				level = 2
				instant_build = yes
			}
		}
	}
}

# Demand French North Africa - Event for France
country_event = {
	id = lar_spain.39
	title = lar_spain.39.t
	desc = lar_spain.39.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.39.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				strength_ratio = { tag = FROM ratio > 1 }
			}
			modifier = {
				factor = 5
				NOT = { has_war_with = FROM }
				has_war = yes
			}
		}
		effect_tooltip = {
			FROM = {
				transfer_state = 461
				transfer_state = 462
				transfer_state = 459
				transfer_state = 460
				transfer_state = 513
				transfer_state = 458
				transfer_state = 665
			}
		}
		hidden_effect = {
			set_country_flag = surrendered_french_north_africa
			FROM = {
				country_event = { id = lar_spain.40 hours = 18 random_hours = 6 }
			}
			news_event = { id = lar_news.14 days = 2 }
		}
	}

	option = { # Decline
		name = lar_spain.39.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.5 }
			}
			modifier = {
				factor = 0.8
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.3 }
			}
			modifier = {
				factor = 0.8
				strength_ratio = { tag = FROM ratio < 0.2 }
			}
			modifier = {
				factor = 0
				strength_ratio = { tag = FROM ratio < 0.1 }
			}
			modifier = {
				factor = 0
				has_focus_tree = vichy_french_focus
				NOT = { has_war_with = GER }
				FROM = { is_in_faction_with = GER }
			}
		}
		effect_tooltip = {
			FROM = {
				add_state_claim = 461
				add_state_claim = 462
				add_state_claim = 459
				add_state_claim = 460
				add_state_claim = 513
				add_state_claim = 458
				add_state_claim = 665
				create_wargoal = {
					type = take_state_focus
					target = ROOT
					generator = { 461 462 459 460 513 458 665 }
					expire = 0
				}
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.41 hours = 18 random_hours = 6 }
			}
		}
	}
}

# Demand French North Africa - Event for Spain - France accepted
country_event = {
	id = lar_spain.40
	title = lar_spain.40.t
	desc = lar_spain.40.desc
	picture = GFX_report_event_generic_sign_treaty3
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.40.a
		transfer_state = 461
		transfer_state = 462
		transfer_state = 459
		transfer_state = 460
		transfer_state = 513
		transfer_state = 458
		transfer_state = 665
	}
}

# Demand French North Africa - Event for Spain - France declined
country_event = {
	id = lar_spain.41
	title = lar_spain.41.t
	desc = lar_spain.41.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.41.a
		add_state_claim = 461
		add_state_claim = 462
		add_state_claim = 459
		add_state_claim = 460
		add_state_claim = 513
		add_state_claim = 458
		add_state_claim = 665
		create_wargoal = {
			type = take_state_focus
			target = FROM
			generator = { 461 462 459 460 513 458 665 }
			expire = 0
		}
	}
}



# Relocate the Gold Reserves - Event for Spain - Choose target
country_event = {
	id = lar_spain.51
	title = lar_spain.51.t
	desc = lar_spain.51.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_other_country = {
				limit = {
					ROOT = {
						has_volunteers_amount_from = {
						    tag = PREV
						    count > 0
						}
					}
					NOT = { tag = SOV }
				}
				set_country_flag = SPR_relocated_gold_reserves_selection_flag1
				save_event_target_as = SPR_relocated_gold_reserves_selection_1
			}
			random_other_country = {
				limit = {
					ROOT = {
						has_volunteers_amount_from = {
						    tag = PREV
						    count > 0
						}
					}
					NOT = { tag = SOV }
					NOT = { has_country_flag = SPR_relocated_gold_reserves_selection_flag1 }
				}
				set_country_flag = SPR_relocated_gold_reserves_selection_flag2
				save_event_target_as = SPR_relocated_gold_reserves_selection_2
			}
			random_other_country = {
				limit = {
					ROOT = {
						has_volunteers_amount_from = {
						    tag = PREV
						    count > 0
						}
					}
					NOT = { tag = SOV }
					NOT = { has_country_flag = SPR_relocated_gold_reserves_selection_flag1 }
					NOT = { has_country_flag = SPR_relocated_gold_reserves_selection_flag2 }
				}
				set_country_flag = SPR_relocated_gold_reserves_selection_flag3
				save_event_target_as = SPR_relocated_gold_reserves_selection_3
			}
		}
	}
	
	option = { # Send to SOV
		name = lar_spain.51.a
		ai_chance = {
			base = 25
			modifier = {
				factor = 2
				has_volunteers_amount_from = {
				    tag = SOV
				    count > 0
				}
			}
		}
		trigger = {
			SOV = {
				exists = yes
				has_government = communism
			}
		}
		SOV = { set_country_flag = SPR_relocated_gold_reserves_selection_flag_sov }
		SOV = { country_event = { id = lar_spain.52 hours = 6 random_hours = 6 } }
	}
	option = { # Send to #1
		name = lar_spain.51.b
		ai_chance = {
			base = 25
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		trigger = {
			any_other_country = {
				has_country_flag = SPR_relocated_gold_reserves_selection_flag1
			}
		}
		event_target:SPR_relocated_gold_reserves_selection_1 = {
			country_event = { id = lar_spain.52 hours = 6 random_hours = 6 }
		}
	}
	option = { # Send to #2
		name = lar_spain.51.c
		ai_chance = {
			base = 25
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		trigger = {
			any_other_country = {
				has_country_flag = SPR_relocated_gold_reserves_selection_flag2
			}
		}
		event_target:SPR_relocated_gold_reserves_selection_2 = {
			country_event = { id = lar_spain.52 hours = 6 random_hours = 6 }
		}
	}
	option = { # Send to #3
		name = lar_spain.51.d
		ai_chance = {
			base = 25
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		trigger = {
			any_other_country = {
				has_country_flag = SPR_relocated_gold_reserves_selection_flag3
			}
		}
		event_target:SPR_relocated_gold_reserves_selection_3 = {
			country_event = { id = lar_spain.52 hours = 6 random_hours = 6 }
		}
	}
}

# Relocate the Gold Reserves - Event for Target
country_event = {
	id = lar_spain.52
	title = lar_spain.52.t
	desc = lar_spain.52.desc
	picture = GFX_report_event_destroyers
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.52.a
		set_country_flag = { flag = SPR_relocate_the_gold_reserves_timer_flag value = 1 days = 60 }
	}
}

# Relocate the Gold Reserves - Event for Target - Seize the Gold
country_event = {
	id = lar_spain.53
	title = lar_spain.53.t
	desc = lar_spain.53.desc
	picture = GFX_report_event_generic_read_write
	
	fire_only_once = yes

	trigger = {
		any_country = {
			original_tag = SPR
			OR = {
				has_government = democratic
				has_government = communism
			}
			has_volunteers_amount_from = {
			    tag = ROOT
			    count > 0
			}
			has_completed_focus = SPR_relocate_the_gold_reserves
		}
		OR = {
			has_country_flag = SPR_relocated_gold_reserves_selection_flag_sov
			has_country_flag = SPR_relocated_gold_reserves_selection_flag1
			has_country_flag = SPR_relocated_gold_reserves_selection_flag2
			has_country_flag = SPR_relocated_gold_reserves_selection_flag3
		}
		NOT = { has_country_flag = SPR_relocate_the_gold_reserves_timer_flag }
	}

	
	option = { # Seize it!
		name = lar_spain.53.a
		ai_chance = {
			base = 50
		}
		add_political_power = -25
		add_timed_idea = { idea = SPR_seized_spanish_gold_reserves days = 365 }
		hidden_effect = {
			SPD = {
				country_event = { id = lar_spain.54 }
			}
		}
	}

	option = { # Let it go.
		name = lar_spain.53.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
}

# Relocate the Gold Reserves - Event for Spain - Gold seized!
country_event = {
	id = lar_spain.54
	title = lar_spain.54.t
	desc = lar_spain.54.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			remove_ideas = SPR_relocate_the_gold_reserves
			set_country_flag = SPR_seized_gold_reserves_flag
		}
	}
	
	option = { # Ok
		name = lar_spain.54.a
		effect_tooltip = { remove_ideas = SPR_relocate_the_gold_reserves }
		custom_effect_tooltip = lar_spain.54.a_tt
	}
}

# Relocate the Gold Reserves - Event for Spain - Payback time
country_event = {
	id = lar_spain.55
	title = lar_spain.55.t
	desc = lar_spain.55.desc
	picture = GFX_report_event_generic_read_write
	
	fire_only_once = yes

	trigger = {
		original_tag = SPR
		has_country_flag = SPR_seized_gold_reserves_flag
		has_global_flag = scw_over
	}

	
	option = { # Dangit
		name = lar_spain.55.a
		add_timed_idea = { idea = SPR_seized_spanish_gold_reserves_spain days = 365 }
	}
}

# Appeal for Increased Autonomy - Event for SOV
country_event = {
	id = lar_spain.56
	title = lar_spain.56.t
	desc = lar_spain.56.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.56.a
		end_puppet = FROM
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.57 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.56.b
		ai_chance = {
			base = 0
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.58 }
			}
		}
	}
}

# Appeal for Increased Autonomy - Event for Spain - SOV accepted
country_event = {
	id = lar_spain.57
	title = lar_spain.57.t
	desc = lar_spain.57.desc
	picture = GFX_report_event_generic_sign_treaty3
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.57.a
		effect_tooltip = {
			FROM = { end_puppet = ROOT }
		}
	}
}

# Appeal for Increased Autonomy - Event for Spain - SOV declined
country_event = {
	id = lar_spain.58
	title = lar_spain.58.t
	desc = lar_spain.58.desc
	picture = GFX_report_event_generic_sign_treaty2
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.58.a
	}
}

# Support French Communists - Event for France
country_event = {
	id = lar_spain.62
	title = lar_spain.62.t
	desc = lar_spain.62.desc
	picture = GFX_report_event_generic_riot
	
	is_triggered_only = yes
	
	option = { # Ok :'(
		name = lar_spain.62.a
		hidden_effect = {
			if = {
				limit = {
					communism > 0.4
				}
				start_civil_war = {
				    ideology = communism
				    size = 0.3
				    keep_unit_leaders_trigger = {
				    	always = yes
				    }
				}
			}
			else_if = {
				limit = {
					communism > 0.3
				}
				start_civil_war = {
				    ideology = communism
				    size = 0.2
				    keep_unit_leaders_trigger = {
				    	always = yes
				    }
				}
			}
			else = {
				start_civil_war = {
				    ideology = communism
				    size = 0.1
				    keep_unit_leaders_trigger = {
				    	always = yes
				    }
				}
			}
			FROM = {
				country_event = { id = lar_spain.63 }
			}
		}
	}
}

# Support French Communists - Event for Spain
country_event = {
	id = lar_spain.63
	title = lar_spain.63.t
	desc = lar_spain.63.desc
	picture = GFX_report_event_generic_riot
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.63.a
		random_country = {
			limit = {
				original_tag = FRA
				has_government = communism
				NOT = { tag = FROM }
			}
			SPR = {
				puppet = PREV
				add_to_war = { 
				    targeted_alliance = PREV
				    enemy = FRA
				    hostility_reason = asked_to_join
				}
			}
		}
	}
}

# Petition for French Aid - Event for France
country_event = {
	id = lar_spain.64
	title = lar_spain.64.t
	desc = lar_spain.64.desc
	picture = GFX_report_event_spr_no_pasaran
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.64.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 0.5
				is_historical_focus_on = yes
			}
			modifier = {
				factor = 0.2
				has_country_flag = FRA_non_intervention
			}
		}
		add_political_power = -50
		add_popularity = {
			ideology = communism
			popularity = 0.1
		}
		add_timed_idea = { idea = SPR_equipment_shipments days = 730 }
		add_opinion_modifier = { target = FROM modifier = SPA_spanish_civil_war_commitments }
		FROM = {
			add_war_support = 0.15
		}
		add_ai_strategy = { type = send_lend_lease_desire id = SPR value = 100 }
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.65 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.64.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				OR = {
					has_country_flag = FRA_arms_purchases_allowed
					has_country_flag = FRA_sending_weapons_allowed
					has_country_flag = FRA_volunteer_work_allowed
				}
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.66 }
			}
		}
	}
}

# Petition for French Aid - Event for Spain - France Accepted
country_event = {
	id = lar_spain.65
	title = lar_spain.65.t
	desc = lar_spain.65.desc
	picture = GFX_report_event_spr_no_pasaran
	
	is_triggered_only = yes
	option = { # Ok
		name = lar_spain.65.a
		effect_tooltip = { FROM = { add_opinion_modifier = { target = ROOT modifier = SPA_spanish_civil_war_commitments } } }
		add_war_support = 0.15
	}
}

# Petition for French Aid - Event for Spain - France Declined
country_event = {
	id = lar_spain.66
	title = lar_spain.66.t
	desc = lar_spain.66.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.66.a
	}
}

# War of Independence - Event for SOV
country_event = {
	id = lar_spain.67
	title = lar_spain.67.t
	desc = lar_spain.67.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			end_puppet = FROM
			remove_from_faction = FROM
		}
	}
	
	option = { # Ok
		name = lar_spain.67.a
		ai_chance = {
			base = 100
			modifier = {
				factor = 0.33
				any_country = {
					is_major = yes
					has_war_with = ROOT
				}
			}
			modifier = {
				factor = 0
				surrender_progress > 0.1
			}
		}
		effect_tooltip = {
			end_puppet = FROM
			remove_from_faction = FROM
		}
		FROM = {
			declare_war_on = {
			    target = ROOT
			    type = topple_government
			}
		}
		hidden_effect = { FROM = { news_event = { id = lar_news.20 hours = 6 } } }
	}

	option = { # Let them have their independence
		name = lar_spain.67.b
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				any_country = {
					is_major = yes
					has_war_with = ROOT
				}
			}
			modifier = {
				add = 100
				has_country_flag = SOV_give_them_independence_flag
			}
		}
		effect_tooltip = {
			end_puppet = FROM
			remove_from_faction = FROM
		}
		delete_unit_template_and_units = {
			division_template = "Spanish Loyalist Division"
		}
		if = {
			limit = {
				has_country_flag = SOV_annexed_spanish_land
			}
			FROM = {
				transfer_state = 165
				transfer_state = 167
				transfer_state = 492
			}
		}
		FROM = { country_event = lar_spain.89 }
	}
}

# Those Who Would Not Help Us - Event for USA/ENG/FRA
country_event = {
	id = lar_spain.68
	title = lar_spain.68.t
	desc = lar_spain.68.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.68.a
		ai_chance = {
			base = 75
		}
		add_timed_idea = { idea = SPR_equipment_shipments days = 730 }
		add_ai_strategy = { type = send_lend_lease_desire id = SPR value = 100 }
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.69 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.68.b
		ai_chance = {
			base = 25
			modifier = {
				factor = 0.5
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0
				has_war_with = SOV
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.70 }
			}
		}
	}
}

# Those Who Would Not Help Us - Event for Spain - FROM Accepted
country_event = {
	id = lar_spain.69
	title = lar_spain.69.t
	desc = lar_spain.69.desc
	picture = GFX_report_event_generic_sign_treaty1
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.69.a
		effect_tooltip = {
			FROM = { add_timed_idea = { idea = SPR_equipment_shipments days = 730 } }
		}
	}
}

# Those Who Would Not Help Us - Event for Spain - FROM Declined
country_event = {
	id = lar_spain.70
	title = lar_spain.70.t
	desc = lar_spain.70.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.70.a
	}
}

# Enemies of Our Enemy - Event for GER/ITA
country_event = {
	id = lar_spain.71
	title = lar_spain.71.t
	desc = lar_spain.71.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.71.a
		ai_chance = {
			base = 75
		}
		diplomatic_relation = {
		    country = FROM
		    relation = non_aggression_pact
		    active = yes
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.72 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.71.b
		ai_chance = {
			base = 25
			modifier = {
				factor = 0.5
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0
				has_war_with = SOV
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.73 }
			}
		}
	}
}

# Enemies of Our Enemy - Event for Spain - FROM Accepted
country_event = {
	id = lar_spain.72
	title = lar_spain.72.t
	desc = lar_spain.72.desc
	picture = GFX_report_event_generic_sign_treaty3
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.72.a
		effect_tooltip = {
			FROM = {
				diplomatic_relation = {
				    country = ROOT
				    relation = non_aggression_pact
				    active = yes
				}
			}
		}
	}
}

# Enemies of Our Enemy - Event for Spain - FROM Declined
country_event = {
	id = lar_spain.73
	title = lar_spain.73.t
	desc = lar_spain.73.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.73.a
	}
}

# Enemies of Our Enemy - Event for GER
country_event = {
	id = lar_spain.74
	title = lar_spain.74.t
	desc = lar_spain.74.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Accept
		name = lar_spain.74.a
		ai_chance = {
			base = 75
		}
		army_experience = -25
		effect_tooltip = {
			FROM = {
				add_timed_idea = { idea = SPR_deal_with_the_devil days = 730 }
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.75 }
			}
		}
	}

	option = { # Decline
		name = lar_spain.74.b
		ai_chance = {
			base = 25
			modifier = {
				factor = 0.5
				has_opinion = { target = FROM value > 99 }
			}
			modifier = {
				factor = 0
				has_war_with = SOV
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = lar_spain.76 }
			}
		}
	}
}

# Enemies of Our Enemy - Event for Spain - FROM Accepted
country_event = {
	id = lar_spain.75
	title = lar_spain.75.t
	desc = lar_spain.75.desc
	picture = GFX_report_event_generic_sign_treaty2
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.75.a
		add_timed_idea = { idea = SPR_deal_with_the_devil days = 730 }
	}
}

# Enemies of Our Enemy - Event for Spain - FROM Declined
country_event = {
	id = lar_spain.76
	title = lar_spain.76.t
	desc = lar_spain.76.desc
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes
	
	option = { # Damn
		name = lar_spain.76.a
	}
}

# Spain - Alfonso Dies
country_event = {
	id = lar_spain.77
	title = lar_spain.77.t
	desc = {
		text = lar_spain.77.desc1
		trigger = {
			has_completed_focus = SPA_restore_the_monarchy
			NOT = { has_country_flag = SPB_xavier_king }
		}
	}
	desc = {
		text = lar_spain.77.desc2
		trigger = {
			NOT = {
				AND = {
					has_completed_focus = SPA_restore_the_monarchy
					NOT = { has_country_flag = SPB_xavier_king }
				}
			}
		}
	}
	picture = GFX_report_event_europe_funeral
	
	trigger = {
		original_tag = SPR
		if = {
			limit = {
				any_country = {
					OR = {
						AND = {
							tag = SPA
							has_completed_focus = SPA_unify_the_nationalist_front
						}
						tag = SPB
					}
					is_ai = no
				}
			}
			is_ai = no
		}
		has_completed_focus = SPA_a_great_spain
		NOT = { has_completed_focus = SPA_the_phalanx_ascendant }
		NOT = { has_global_flag = SPB_alfonso_xiii_dead }
		date > 1940.2.28
	}


	fire_only_once = yes

	immediate = {
		hidden_effect = {
			set_global_flag = SPB_alfonso_xiii_dead
			if = {
				limit = {
					has_country_leader = {
					    name = "Alfonso XIII"
					    ruling_only = yes
					}
				}
				kill_country_leader = yes
				create_country_leader = {
					name = "Jaime IV"
					desc = "POLITICS_JAIME_IV_DESC"
					picture = "GFX_portrait_fra_infante_jaime"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						
					}
				}
			}
		}
	}
	
	option = { # RIP
		name = lar_spain.77.a
		if = {
			limit = {
				has_country_leader = {
				    name = "Alfonso XIII"
				    ruling_only = yes
				}
			}
			effect_tooltip = {
				kill_country_leader = yes
				create_country_leader = {
					name = "Jaime IV"
					desc = "POLITICS_JAIME_IV_DESC"
					picture = "GFX_portrait_fra_infante_jaime"
					expire = "1965.1.1"
					ideology = despotism
					traits = {
						
					}
				}
			}
		}
	}
}

# Spain - Sanjurjo Dies
country_event = {
	id = lar_spain.78
	title = lar_spain.78.t
	desc = lar_spain.78.desc
	picture = GFX_report_event_spr_plane_crash
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			kill_country_leader = yes
			create_country_leader = {
				name = "Military Junta"
				desc = "POLITICS_MILITARY_JUNTA_DESC"
				picture = "GFX_portrait_SPA_military_junta"
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					divided_interests
				}
			}
		}
	}
	
	option = { # RIP
		name = lar_spain.78.a
		effect_tooltip = {
			custom_effect_tooltip = lar_spain.78_tt
			hidden_effect = {
				kill_country_leader = yes
			}
			create_country_leader = {
				name = "Military Junta"
				desc = "POLITICS_MILITARY_JUNTA_DESC"
				picture = "GFX_portrait_SPA_military_junta"
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					divided_interests
				}
			}
		}
	}
}

# Claim the French Throne - Event for Spain - Coronation
country_event = {
	id = lar_spain.79
	title = lar_spain.79.t
	desc = lar_spain.79.desc
	picture = GFX_report_event_royal_parade
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.79.a
		FRA = {
			every_unit_leader = {
				set_nationality = ROOT
			}
		}
		every_state = {
			limit = {
				is_core_of = FRA
			}
			add_core_of = ROOT
		}
		annex_country = { target = FRA transfer_troops = yes }
	}
}

# Hidden event to 'age' Franco after 1950
country_event = {
	id = lar_spain.80

	trigger = {
		tag = SPA
		has_completed_focus = SPA_caudillo_of_spain
		NOT = { has_completed_focus = SPA_restore_the_monarchy }
		date > 1950.1.1
	}

	fire_only_once = yes

	hidden = yes

	immediate = {
		hidden_effect = {
			SPA_francisco_franco = {
				set_leader_portrait = "GFX_portrait_spain_francisco_franco_old"
			}
		}
	}
}

# End of SCW, Republicans expanded Soviet aid - event for SOV
country_event = {
	id = lar_spain.81
	title = lar_spain.81.t
	desc = lar_spain.81.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes
	
	option = { # Ok
		name = lar_spain.81.a
		effect_tooltip = {
			puppet = SPD
		}
	}
}

# End of SCW, Republicans expanded Soviet aid - event for SPD
country_event = {
	id = lar_spain.82
	title = lar_spain.82.t
	desc = lar_spain.82.desc
	picture = GFX_report_event_generic_parliament
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_government = democratic
				}
				set_country_flag = SPR_democratic_government_flag
			}
			set_temp_variable = {
				var = soviet_puppet_democratic_var
				value = party_popularity@democratic
			}
			SOV = { puppet = SPD }
			if = {
				limit = {
					has_country_flag = SPR_democratic_government_flag
				}
				set_politics = {
					ruling_party = democratic
				}
				clr_country_flag = SPR_democratic_government_flag
			}
			set_political_party = {
			    ideology = communism
			    popularity = 100
			}
			add_popularity = {
			    ideology = democratic
			    popularity = soviet_puppet_democratic_var
			}
		}
	}
	
	option = { # Ok
		name = lar_spain.82.a
		effect_tooltip = {
			SOV = { puppet = SPD }
		}
	}
}

# Soviets get notification SPR is being disloyal
country_event = {
	id = lar_spain.83
	title = lar_spain.83.t
	desc = lar_spain.83.desc
	picture = GFX_report_event_generic_parliament

	trigger = {
		tag = SOV
		any_country = {
			original_tag = SPR
			focus_progress = {
			    focus = SPR_subvert_soviet_control
			    progress > 0.1
			}
		}
	}


	fire_only_once = yes

	option = { # We must act!
		name = lar_spain.83.a
		ai_chance = {
			base = 100
			modifier = {
				factor = 0.33
				any_country = {
					is_major = yes
					has_war_with = ROOT
				}
			}
			modifier = {
				factor = 0
				surrender_progress > 0.1
			}
		}
		set_country_flag = SOV_annexed_spanish_land
		transfer_state = 165
		transfer_state = 167
		transfer_state = 492
		hidden_effect = { SPD = { country_event = { id = lar_spain.84 } } }
		division_template = {
			name = "Spanish Loyalist Division"
			priority = 1
			division_names_group = SOV_INF_01
			is_locked = yes
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
		}
		# Catalonia
		165 = {
			create_unit = {
				division = "name = \"1. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"2. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
		}
		# Valencia
		167 = {
			create_unit = {
				division = "name = \"3. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"4. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"5. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"6. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"7. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
		}
		 # Eastern Aragon
		492 = {
			create_unit = {
				division = "name = \"8. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"9. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"10. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"11. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"12. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"13. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"14. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"15. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
			create_unit = {
				division = "name = \"16. Spanish Loyalist Division\" division_template = \"Spanish Loyalist Division\" start_experience_factor = 0.1" 
				owner = ROOT
			}
		}
	}

	option = { # Everything will be fine
		name = lar_spain.83.b
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				any_country = {
					is_major = yes
					has_war_with = ROOT
				}
			}
		}
		set_country_flag = SOV_give_them_independence_flag
		add_political_power = -50
	}
}

# Event for SPR that Soviets are seizing land
country_event = {
	id = lar_spain.84
	title = lar_spain.84.t
	desc = lar_spain.84.desc
	picture = GFX_report_event_soviet_army_greeted

	is_triggered_only = yes

	option = { # Bastards!
		name = lar_spain.84.a
		set_country_flag = SOV_took_spanish_states
		effect_tooltip = {
			SOV = {
				transfer_state = 165
				transfer_state = 167
				transfer_state = 492
			}
		}
	}
}

# SPR has Catalonia returned
country_event = {
	id = lar_spain.85
	title = lar_spain.85.t
	desc = lar_spain.85.desc
	picture = GFX_report_event_soldiers_marching

	trigger = {
		tag = SPD
		has_completed_focus = SPR_war_of_independence
		has_country_flag = SOV_took_spanish_states
		has_war_with = SOV
		SOV = { owns_state = 165 }
		has_full_control_of_state = 165
	}


	fire_only_once = yes

	immediate = {
		hidden_effect = {
			165 = { save_event_target_as = SPR_stolen_state_name }
		}
	}

	option = { # Excellent!
		name = lar_spain.85.a
		transfer_state = 165
		hidden_effect = { SOV = { country_event = { id = lar_spain.88 } } }
	}
}

# SPR has Valencia returned
country_event = {
	id = lar_spain.86
	title = lar_spain.85.t
	desc = lar_spain.85.desc
	picture = GFX_report_event_soldiers_marching

	trigger = {
		tag = SPD
		has_completed_focus = SPR_war_of_independence
		has_country_flag = SOV_took_spanish_states
		has_war_with = SOV
		SOV = { owns_state = 167 }
		has_full_control_of_state = 167
	}


	fire_only_once = yes

	immediate = {
		hidden_effect = {
			167 = { save_event_target_as = SPR_stolen_state_name }
		}
	}

	option = { # Excellent!
		name = lar_spain.85.a
		transfer_state = 167
		hidden_effect = { SOV = { country_event = { id = lar_spain.88 } } }
	}
}

# SPR has Eastern Aragon returned
country_event = {
	id = lar_spain.87
	title = lar_spain.85.t
	desc = lar_spain.85.desc
	picture = GFX_report_event_soldiers_marching

	trigger = {
		tag = SPD
		has_completed_focus = SPR_war_of_independence
		has_country_flag = SOV_took_spanish_states
		has_war_with = SOV
		SOV = { owns_state = 492 }
		has_full_control_of_state = 492
	}


	fire_only_once = yes

	immediate = {
		hidden_effect = {
			492 = { save_event_target_as = SPR_stolen_state_name }
		}
	}

	option = { # Excellent!
		name = lar_spain.85.a
		transfer_state = 492
		hidden_effect = { SOV = { country_event = { id = lar_spain.88 } } }
	}
}

# Event for SOV informing them of losing a state to SPR
country_event = {
	id = lar_spain.88
	title = lar_spain.88.t
	desc = lar_spain.88.desc
	picture = GFX_report_event_soldiers_marching

	is_triggered_only = yes

	option = { # Excellent!
		name = lar_spain.88.a
		effect_tooltip = { FROM = { transfer_state = event_target:SPR_stolen_state_name } }
	}
}

# Event for SPR that Soviets are giving them independence
country_event = {
	id = lar_spain.89
	title = lar_spain.89.t
	desc = lar_spain.89.desc
	picture = GFX_report_event_soviet_army_greeted

	is_triggered_only = yes

	option = { # Ok
		name = lar_spain.89.a
		if = {
			limit = {
				SOV = { has_country_flag = SOV_annexed_spanish_land }
			}
			SOV = { clr_country_flag = SOV_annexed_spanish_land }
			effect_tooltip = {
				FROM = {
					transfer_state = 165
					transfer_state = 167
					transfer_state = 492
				}
			}
		}
	}
}

# Event for Spain that the president is dismissed
country_event = {
	id = lar_spain.90
	title = lar_spain.90.t
	desc = lar_spain.90.desc
	picture = GFX_report_event_generic_parliament

	trigger = {
		tag = SPR
		date > 1936.4.20
		NOT = { has_global_flag = spanish_civil_war }
	}


	fire_only_once = yes

	option = { # Ok
		name = lar_spain.90.a
		if = {
			limit = {
				has_dlc = "La Resistance"
			}
			if = {
				limit = {
					has_completed_focus = SPR_the_popular_front
				}
				remove_ideas = SPR_government_power_struggle
				add_political_power = 10
			}
			retire_country_leader = yes
			create_country_leader = {
				name = "Manuel Azaña"
				desc = "POLITICS_MANUEL_AZANA_DESC"
				picture = "Portrait_Spain_Manuel_Azana.dds"
				expire = "1965.1.1"
				ideology = conservatism
				traits = {
					figurehead_president
				}
			}
		}
		else = {
			retire_country_leader = yes
			create_country_leader = {
				name = "Manuel Azaña"
				desc = "POLITICS_MANUEL_AZANA_DESC"
				picture = "Portrait_Spain_Manuel_Azana.dds"
				expire = "1965.1.1"
				ideology = conservatism
				traits = {
		
				}
			}
		}
	}
}
add_namespace = lar_test

operative_leader_event = {
	id = lar_test.1
	title = lar_test.1.t
	desc = lar_test.1.d

	is_triggered_only = yes

	#major = yes

	option = {
		name = lar_test.1.a
		harm_operative_leader = 12
		FROM = { add_political_power = 100 }
	}
}

###########################
# Mexico Events
# By Tristan 'Enjoy' Edge, aged 30 and 2 months
###########################

add_namespace = mexico

# General Cedillo revolts

country_event = {
	id = mexico.1
	title = mexico.1.title
	desc = mexico.1.desc
	
	picture = GFX_report_event_yugoslavian_cavalry
	
	fire_only_once = yes
	
	is_triggered_only = yes
		
	immediate = {
		set_global_flag = flag_mexico_cedillo_has_revolted
		add_stability = -0.25
	}
	
	option = {
		name = mexico.1.a
	}
}

# Mexico has nationalised the oil fields, Britain and America are informed that their oil companies are demanding compensation

country_event = {
	id = mexico.2
	title = mexico.2.title
	desc = mexico.2.desc
	
	picture = GFX_report_event_journalists_speech
	
	is_triggered_only = yes

	option = {
		name = mexico.2.a
		
		add_political_power = -25
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 10
				FROM = {
					has_government = ROOT
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_enemy_ideology = yes
				}
			}
		}
	}
	option = {
		name = mexico.2.b
		
		add_opinion_modifier = {
			target = FROM
			modifier = embargo
		}
		
		FROM = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
			country_event = {
				days = 1
				id = mexico.3
			}
		}
		ai_chance = {
			factor = 80
			modifier = {
				factor = 0.5
				has_war = yes
			}
			modifier = {
				factor = 0
				has_government = communism
				FROM = {
					has_government = communism
				}
			}
		}
	}
	option = {
		name = mexico.2.c
		
		add_stability = -0.1
		add_war_support = -0.1
		
		create_wargoal = {
			type = puppet_wargoal_focus
			target = FROM
		}
		
		add_opinion_modifier = {
			target = FROM
			modifier = embargo
		}
		
		FROM = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
			country_event = {
				days = 1
				id = mexico.3
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				has_stability < 0.4
			}
			modifier = {
				factor = 0
				has_war_support < 0.4
			}
			modifier = {
				factor = 0
				has_war = yes
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
			modifier = {
				factor = 0
				has_government = communism
				FROM = {
					has_government = communism
				}
			}
		}
	}
}

# Mexico is informed that they are under embargo

country_event = {
	id = mexico.3
	title = mexico.3.title
	desc = mexico.3.desc
	
	picture = GFX_report_event_merchant_ship_01
	
	is_triggered_only = yes

	option = {
		name = mexico.3.a

		if = {
			limit = {
				NOT = {
					has_global_flag = flag_mexico_embargo_has_incited_cedillo
				}
			}
			set_global_flag = flag_mexico_embargo_has_incited_cedillo
			MEX_increase_cedillo_tension = yes # Supposedly, Cedillo rebelled because he thought the imperial powers would support him after the oil nationalisation
		}
	}
}

# Mexico has compensated the oil firms, Britain and America are informed and must lift any embargo or face political pressure

country_event = {
	id = mexico.4
	title = mexico.4.title
	desc = mexico.4.desc
	
	picture = GFX_report_event_FDR_speech
	
	is_triggered_only = yes

	option = {
		name = mexico.4.a
		
		if = {
			limit = {
				has_opinion_modifier = embargo
			}
			
			remove_opinion_modifier = { target = FROM modifier = embargo }
			
			FROM = {
				remove_opinion_modifier = { target = ROOT modifier = embargo }
			}
		}
		
		ai_chance = {
			factor = 80
		}
	}
	option = {
		name = mexico.4.b
		
		trigger = {
			has_opinion_modifier = embargo
		}
		
		add_political_power = -25
		
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0.1
				has_war = yes
			}
			modifier = {
				factor = 0.5
				tag = USA
				is_historical_focus_on = yes
			}
		}
	}
}

# Mexico asks to join someone's faction via focus

country_event = {
	id = mexico.8
	title = mexico.8.title
	desc = mexico.8.desc
	
	picture = GFX_report_event_canadian_tank
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			save_event_target_as = alliance_inviter
			FROM = { save_event_target_as = alliance_applicant }
		}
	}
	
	option = {
		name = mexico.8.a
		
		if = {
			limit = {
				original_tag = ENG
			}
			add_to_tech_sharing_group = MEX_ENG_tech_group
			
			FROM = {
				add_to_tech_sharing_group = MEX_ENG_tech_group
			}
		}
		
		if = {
			limit = {
				original_tag = GER
			}
			add_to_tech_sharing_group = MEX_GER_tech_group
			
			FROM = {
				add_to_tech_sharing_group = MEX_GER_tech_group
			}
		}
		
		if = {
			limit = {
				original_tag = SOV
			}
			add_to_tech_sharing_group = MEX_SOV_tech_group
			
			FROM = {
				add_to_tech_sharing_group = MEX_SOV_tech_group
			}
		}
		
		if = {
			limit = {
				original_tag = USA
			}
			add_to_tech_sharing_group = MEX_USA_tech_group
			
			FROM = {
				add_to_tech_sharing_group = MEX_USA_tech_group
			}
		}
		
		if = {
			limit = {
				is_faction_leader = yes
			}
			add_to_faction = FROM
			hidden_effect = {
				news_event = { id = news.289 hours = 12 }
			}
			FROM = { country_event = { id = generic.3 hours = 6 } }
		}
		
		if = {
			limit = {
				is_faction_leader = no
			}
			random_other_country = {
				limit = {
					is_in_faction_with = ROOT
					is_faction_leader = yes
				}
				country_event = {
					id = mexico.9
					days = 1
				}
			}
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 2.0
				has_war = yes
			}
			modifier = {
				factor = 0.5
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
						OR = {
							has_government = ROOT
							is_major = yes
						}
					}
				}
			}
		}
	}
	
	option = {
		name = mexico.8.b
		
		FROM = { 
			country_event = { id = generic.4 hours = 6 }
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.1
				MEX = {
					OR = {
						has_government = ROOT
						is_major = yes
						is_ai = no
					}
				}
			}
		}
	}
}

# Mexico is being sponsored to join a faction by a third party (ENG/GER/SOV/USA)
# Attempt to catch a request to USA going to ENG, but knowing HoI4 anything could happen

country_event = {
	id = mexico.9
	title = mexico.9.title
	desc = mexico.9.desc
	
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			save_event_target_as = alliance_inviter
		}
	}
	
	option = {
		name = mexico.9.a

		add_to_faction = MEX
				
		hidden_effect = {
			news_event = { id = news.289 hours = 12 }
		}
		
		MEX = { country_event = { id = generic.3 hours = 6 } }
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 2.0
				has_war = yes
			}
			modifier = {
				factor = 0.5
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
						OR = {
							has_government = ROOT
							is_major = yes
						}
					}
				}
			}
		}
	}
	
	option = {
		name = mexico.9.b
				
		FROM = { 
			country_event = { id = generic.4 hours = 6 }
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				MEX = {
					OR = {
						has_government = ROOT
						is_major = yes
						is_ai = no
					}
				}
			}
		}
	}
}

# Mexico invites a Latin American country to join its right-wing faction, the Latin American Order

country_event = {
	id = mexico.10
	title = mexico.10.title
	desc = mexico.10.desc
	
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes

	option = {
		name = mexico.10.a

		set_country_flag = flag_joined_mexican_faction # Used to turn on an AI strategy to stay in Mexico's faction
		
		FROM = {
			add_to_faction = ROOT
			country_event = { id = generic.6 hours = 6 } 
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 2.0
				has_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = {
					has_government = FROM
				}
			}
			modifier = {
				factor = 0.1
				is_historical_focus_on = yes
				NOT = {
					has_government = FROM
				}
			}
			modifier = {
				factor = 0.5
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
						OR = {
							has_government = ROOT
							is_major = yes
						}
					}
				}
			}
		}
	}
	
	option = {
		name = mexico.10.b
		
		FROM = {
			country_event = { id = generic.7 hours = 6 }
		}
		
		ai_chance = {
			factor = 25
		}
	}
}

# Mexico invites a Latin American country to join its left-wing faction, the Bolivarian Alliance

country_event = {
	id = mexico.11
	title = mexico.11.title
	desc = mexico.11.desc
	
	picture = GFX_report_event_generic_communist_congress
	
	is_triggered_only = yes

	option = {
		name = mexico.11.a
		
		set_country_flag = flag_joined_mexican_faction # Used to turn on an AI strategy to stay in Mexico's faction

		FROM = {
			add_to_faction = ROOT
			country_event = { id = generic.6 hours = 6 } 
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 2.0
				has_war = yes
			}
			modifier = {
				factor = 0.5
				NOT = {
					has_government = FROM
				}
			}
			modifier = {
				factor = 0.1
				is_historical_focus_on = yes
				NOT = {
					has_government = FROM
				}
			}
			modifier = {
				factor = 0.5
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				MEX = {
					has_war = yes
					any_enemy_country = {
						NOT = {
							has_war_with = ROOT
						}
						OR = {
							has_government = ROOT
							is_major = yes
						}
					}
				}
			}
		}
	}
	
	option = {
		name = mexico.11.b
		
		FROM = {
			country_event = { id = generic.7 hours = 6 }
		}
		
		ai_chance = {
			factor = 25
		}
	}
}

# Mexico asks Britain to sell Belize after aligning towards them

country_event = {
	id = mexico.12
	title = mexico.12.title
	desc = mexico.12.desc
	
	picture = GFX_report_event_generic_conference
	
	is_triggered_only = yes
	
	option = {
		name = mexico.12.a
		
		311 = {
			set_state_name = "Belice"
		}
		
		add_political_power = 25
		
		MEX = {
			transfer_state = 311
			add_state_core = 311
			country_event = {
				id = mexico.13
				days = 1
			}
		}
		
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2.0
				has_government = FROM
			}
			
			modifier = {
				factor = 2.0
				is_in_faction_with = FROM
			}
		}
	}
	
	option = {
		name = mexico.12.b
		
		MEX = {
			country_event = {
				id = mexico.14
				days = 1
			}
		}
		
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2.0
				has_war = yes
			}
		}
	}
}

# Mexico is informed that Belize was granted to them

country_event = {
	id = mexico.13
	title = mexico.13.title
	desc = mexico.13.desc
	
	picture = GFX_report_event_generic_read_write
	
	is_triggered_only = yes

	option = {
		name = mexico.13.a
	}
}

# Mexico is informed Britain refused to turn over Belize

country_event = {
	id = mexico.14
	title = mexico.14.title
	desc = mexico.14.desc
	
	picture = GFX_report_event_british_inspect_troops
	
	is_triggered_only = yes

	option = {
		name = mexico.14.a
	}
}

# Archbishop Pascual Díaz y Barreto passes away

country_event = {
	id = mexico.15
	title = mexico.15.title
	desc = mexico.15.desc
	
	picture = GFX_report_event_europe_funeral
	
	fire_only_once = yes
	
	trigger = {
		tag = MEX
		has_dlc = "Man the Guns"
	}
	
	
	option = {
		name = mexico.15.a # Rest in peace
		
		MEX_increase_church_power = yes
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				has_completed_focus = MEX_focus_state_education
			}
			modifier = {
				factor = 10
				has_active_mission = MEX_mission_second_cristiada
			}
			modifier = {
				factor = 10
				OR = {
					has_idea = MEX_church_power_2
					has_idea = MEX_church_power_1
				}
				NOT = { has_global_flag = flag_second_mexican_civil_war }
			}
		}
	}
	option = {
		name = mexico.15.b # Burn in hell
		
		MEX_decrease_church_power = yes
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				has_completed_focus = MEX_focus_antidisestablishmentarianism
			}
			modifier = {
				factor = 10
				has_active_mission = MEX_mission_second_revolution
			}
			modifier = {
				factor = 10
				OR = {
					has_idea = MEX_church_power_4
					has_idea = MEX_church_power_5
				}
				NOT = { has_global_flag = flag_second_mexican_civil_war }
			}
		}
	}
}

# Oil worker strike

country_event = {
	id = mexico.16
	title = mexico.16.title
	desc = mexico.16.desc
	
	picture = GFX_report_event_american_hunger_march
	
	fire_only_once = yes
	
	trigger = {
		tag = MEX
		
		date > 1937.1.1
		
		NOT = {
			OR = {
				has_completed_focus = MEX_focus_strike_breaking

				has_completed_focus = MEX_focus_royal_dutch_shell
				
				has_completed_focus = MEX_focus_nationalize_the_oil_fields
				
				focus_progress = {
					focus = MEX_focus_royal_dutch_shell
					progress > 0.01
				}
				
				focus_progress = {
					focus = MEX_focus_nationalize_the_oil_fields
					progress > 0.01
				}
			}
		}
		has_dlc = "Man the Guns"
	}
	
	
	option = {
		name = mexico.16.a # Support the strikers
		
		if = {
			limit = {
				OR = {
					has_idea = MEX_cedillo_tension
					has_idea = MEX_cedillo_tension_2
					has_idea = MEX_cedillo_tension_3
				}
			}
			MEX_increase_cedillo_tension = yes # Supposedly, Cedillo rebelled because he thought the imperial powers would support him after the oil nationalisation
			add_political_power = -100
		}
		else = {
			add_political_power = -150
		}
		
		ai_chance = {
			factor = 100
		}
	}

	option = {
		name = mexico.16.b # Support the oil companies
		
		add_stability = -0.05
		
		ai_chance = {
			factor = 0
		}
	}
}

# Trotsky arrives from Norway

country_event = {
	id = mexico.17
	title = mexico.17.title
	desc = mexico.17.desc
	
	picture = GFX_report_event_communists_cheer
	
	fire_only_once = yes
	
	trigger = {
		tag = MEX
		date > 1936.08.28
		OR = {
			has_government = neutrality
			AND = {
				has_government = communism
				NOT = {
					has_country_leader = { ruling_only = yes character = MEX_dionisio_encina }
				} 
			}

		}
		NOT = {
			has_global_flag = trotsky_not_welcome_in_mexico
		}
		NOT = {
			has_global_flag = flag_trotsky_dead
		}

	}
	

	option = {
		name = mexico.17.a # We aren't Stalin's puppets, let him stay
		
		if = {
			limit = {
				SOV = {
					has_country_leader = { character = SOV_iosif_stalin }
				}
			}
			SOV = {
				add_opinion_modifier = {
					target = ROOT
					modifier = mexico_trotskyite_wreckers
				}
			}
		}
		USA = {
			add_opinion_modifier = {
				target = ROOT
				modifier = mexico_snubbed_stalin
			}
		}
		set_global_flag = trotsky_exile_mexico
		ai_chance = {
			factor = 1
		}
	}
}

# The 1940 election begins
# First the player is asked if he wants to change the law to remain in office a second term
# Doing so is likely to incite a second revolution (Diaz reigned for 30 years)

country_event = {
	id = mexico.18
	title = mexico.18.title
	desc = mexico.18.desc
	
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes

	trigger = {
		original_tag = MEX
		date < 1942.1.1
		has_dlc = "Man the Guns"
	}
	
	option = {
		name = mexico.18.a
		
		country_event = {
			id = mexico.19
			days = 1
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = mexico.18.b
		
		trigger = {
			NOT = {
				has_government = democratic
			}
		}
		
		add_stability = -0.03
		
		if = {
			limit = {
				has_government = neutrality
			}
			set_politics = {
				ruling_party = neutrality
				elections_allowed = no
			}
		}
		
		if = {
			limit = {
				has_government = fascism
			}
			set_politics = {
				ruling_party = fascism
				elections_allowed = no
			}
		}
		
		if = {
			limit = {
				has_government = communism
			}
			set_politics = {
				ruling_party = communism
				elections_allowed = no
			}
		}
		
		ai_chance = {
			factor = 25
			
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
}

# The successor is now selected. Will depend on the choice of policies and current leader.
# The previous event implies the law on successors is being strictly applied so candidates are not eligible if they have been president before!

country_event = {
	id = mexico.19
	title = mexico.19.title
	desc = mexico.19.desc
	
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes
	
	# Neutrality
	
	option = { # Left-wing successor: Francisco Múgica
		name = mexico.19.a
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_francisco_mugica
				}
			}
			has_government = neutrality
		}

		add_country_leader_role = {
			character = MEX_francisco_mugica
			country_leader = {
				expire = "1965.1.1"
				ideology = moderatism
				traits = {
					revolutionary_general
				}
			}
			promote_leader = yes
		}
		
		hidden_effect = { # Juan Andreu complains he was not selected
			if = {
				limit = {
					USA = {
						is_subject = no
						exists = yes
						NOT = {
							has_war_with = ROOT
						}
					}
				}
				country_event = {
					id = mexico.20
					days = 1
				}
			}
		}
	}
	
	option = { # Compromise successor: Manuel Ávila
		name = mexico.19.b
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_manuel_avila_camacho
				}
			}
			has_government = neutrality
		}

		add_country_leader_role = {
			character = MEX_manuel_avila_camacho
			country_leader = {
				expire = "1965.1.1"
				ideology = oligarchism
				traits = {
					the_gentleman_president
				}
			}
			promote_leader = yes
		}
		
		hidden_effect = { # Juan Andreu complains he was not selected
			if = {
				limit = {
					USA = {
						is_subject = no
						exists = yes
						NOT = {
							has_war_with = ROOT
						}
					}
				}
				country_event = {
					id = mexico.20
					days = 1
				}
			}
		}
	}
	
	option = { # Right-wing successor: Saturnino Cedillo
		name = mexico.19.c
		
		trigger = {
			NOT = {
				has_global_flag = flag_mexico_cedillo_has_revolted
			}
			has_completed_focus = MEX_focus_support_general_cedillo
			NOT = {
				has_country_leader = {
					character = MEX_saturnino_cedillo
				}
			}
			has_government = neutrality
		}

		add_country_leader_role = {
			character = MEX_saturnino_cedillo
			country_leader = {
				expire = "1965.1.1"
				ideology = despotism
				traits = {
					strongman_of_san_luis_potosi
				}
			}
			promote_leader = yes
		}
	}
	
	#option = { # Far-right candidate: Juan Andreu
	#	name = mexico.19.d
	#	
	#	trigger = {
	#		NOT = {
	#			has_country_leader = {
	#				character = MEX_juan_andreu
	#			}
	#		}
	#		has_government = neutrality
	#	}

	#	add_country_leader_role = {
	#		character = MEX_juan_andreu
	#		country_leader = {
	#			expire = "1965.1.1"
	#			ideology = oligarchism
	#			traits = {
	#				the_silver_president
	#			}
	#		}
	#		promote_leader = yes
	#	}
	#}

	# Democratic
	
	option = { # Far-left successor: Vicente Lombardo
		name = mexico.19.e
		
		trigger = {
			has_completed_focus = MEX_focus_confederation_of_mexican_workers
			NOT = {
				has_country_leader = {
					character = MEX_vicente_lombardo
				}
			}
			has_government = democratic
		}

		add_country_leader_role = {
			character = MEX_vicente_lombardo
			country_leader = {
				expire = "1965.1.1"
				ideology = socialism
				traits = {
					the_dean_of_mexican_marxism
				}
			}
			promote_leader = yes
		}
		
		hidden_effect = { # Juan Andreu complains he was not selected
			if = {
				limit = {
					USA = {
						is_subject = no
						exists = yes
						NOT = {
							has_war_with = ROOT
						}
					}
				}
				country_event = {
					id = mexico.20
					days = 1
				}
			}
		}
		
		ai_chance = {
			factor = 10
		}
	}
	
	option = { # Left-wing successor: Francisco Múgica
		name = mexico.19.f
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_francisco_mugica
				}
			}
			has_government = democratic
		}

		add_country_leader_role = {
			character = MEX_francisco_mugica
			country_leader = {
				expire = "1965.1.1"
				ideology = socialism
				traits = {
					revolutionary_general
				}
			}
			promote_leader = yes
		}
		
		hidden_effect = { # Juan Andreu complains he was not selected
			if = {
				limit = {
					USA = {
						is_subject = no
						exists = yes
						NOT = {
							has_war_with = ROOT
						}
					}
				}
				country_event = {
					id = mexico.20
					days = 1
				}
			}
		}
		
		ai_chance = {
			factor = 30
		}
	}
	
	option = { # Right-wing successor: Manuel Ávila
		name = mexico.19.g
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_manuel_avila_camacho
				}
			}
			has_government = democratic
		}

		add_country_leader_role = {
			character = MEX_manuel_avila_camacho
			country_leader = {
				expire = "1965.1.1"
				ideology = conservatism
				traits = {
					the_gentleman_president
				}
			}
			promote_leader = yes
		}
		
		hidden_effect = { # Juan Andreu complains he was not selected
			if = {
				limit = {
					USA = {
						is_subject = no
						exists = yes
						NOT = {
							has_war_with = ROOT
						}
					}
				}
				country_event = {
					id = mexico.20
					days = 1
				}
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				is_historical_focus_on = yes
			}
		}
	}
	
	#option = { # Far-right candidate: Juan Andreu
	#	name = mexico.19.h
	#	
	#	trigger = {
	#		NOT = {
	#			has_country_leader = {
	#				character = MEX_juan_andreu
	#			}
	#		}
	#		has_government = democratic
	#	}

	#	add_country_leader_role = {
	#		character = MEX_juan_andreu
	#		country_leader = {
	#			expire = "1965.1.1"
	#			ideology = conservatism
	#			traits = {
	#				the_silver_president
	#			}
	#		}
	#		promote_leader = yes
	#	}
	#}
	
	# Communist
	
	option = { # Trades unionist successor: Vicente Lombardo
		name = mexico.19.i
		
		trigger = {
			has_completed_focus = MEX_focus_confederation_of_mexican_workers
			NOT = {
				has_country_leader = {
					character = MEX_vicente_lombardo
				}
			}
			has_government = communism
		}

		add_country_leader_role = {
			character = MEX_vicente_lombardo
			country_leader = {
				expire = "1965.1.1"
				ideology = marxism
				traits = {
					the_dean_of_mexican_marxism
				}
			}
			promote_leader = yes
		}
	}
	
	option = { # Social democratic successor: Francisco Múgica
		name = mexico.19.j
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_francisco_mugica
				}
			}
			has_government = communism
		}

		add_country_leader_role = {
			character = MEX_francisco_mugica
			country_leader = {
				expire = "1965.1.1"
				ideology = marxism
				traits = {
					revolutionary_general
				}
			}
			promote_leader = yes
		}
	}
	
	option = { # Trotskyist successor: Hernán Laborde
		name = mexico.19.l
		
		trigger = {
			NOT = {
				has_country_leader = {
					character = MEX_hernan_laborde
				}
			}
			has_government = communism
			OR = {
				NOT = {
					has_global_flag = flag_mexico_invited_trotsky_to_government
				}
				AND = { # If Trotsky is in power, he steps down and Laborde is successor
					has_global_flag = flag_mexico_invited_trotsky_to_government
					has_country_leader = { character = MEX_leon_trotsky }
				}
			}
		}

		promote_character = MEX_hernan_laborde
	}

	option = { # Neither Trotsky nor Laborde: Valentín Campa
		name = mexico.19.r
		
		trigger = {
			has_country_leader = {
			 	ruling_only = yes
			 	character = MEX_hernan_laborde
			}				
		}

		add_country_leader_role = {
			character = MEX_valentin_campa
			country_leader = {
				expire = "1965.1.1"
				ideology = leninism
				traits = {
					railroad_enthusiast
				}
			}
			promote_leader = yes
		}
	}

	# That should be enough for now. # (After endless new character system adjustments): Yes it was definitely enough

}

# If a centre/left-wing neutral or democratic leader is selected, Juan Andreu complains (historic)
# Only triggered if America exists, is independent and not at war with Mexico (flavour text reasons)

country_event = {
	id = mexico.20
	title = mexico.20.title
	desc = mexico.20.desc
	
	picture = GFX_report_event_election_vote
	
	is_triggered_only = yes

	option = {
		name = mexico.20.a
	}
}

# Unrestricted submarine warfare

# German submarines sank some oilers in 1942, which brought Mexico into the war

# First event offers Germany a short bonus to convoy raiding in exchange for the risk of diplomatic repercussions

country_event = {
	id = mexico.23
	title = mexico.23.title
	desc = mexico.23.desc
	
	picture = GFX_report_event_merchant_ship_01
	
	fire_only_once = yes
	
	trigger = {
		tag = GER
		
		has_war_with = USA
		
		NOT = {
			has_war_with = MEX
		}
		
		has_navy_size = { unit = submarine size > 9 }
		
		OR = {
			ships_in_area = { # Gulf of Mexico
				type = submarine
				area = 52
				size > 0
			}
			ships_in_area = { # Carribean Sea
				type = submarine
				area = 53
				size > 0
			}
			ships_in_area = { # Florida Coast
				type = submarine
				area = 170
				size > 0
			}
			ships_in_area = { # Eastern Seaboard
				type = submarine
				area = 54
				size > 0
			}
			ships_in_area = { # Sargasso Sea
				type = submarine
				area = 57
				size > 0
			}
			ships_in_area = { # Demerara Plain
				type = submarine
				area = 59
				size > 0
			}
		}
		has_dlc = "Man the Guns"
	}
	
	
	option = {
		name = mexico.23.a # Sink them
		
		add_war_support = 0.01
		
		add_timed_idea = {
			idea = mexico_german_submarine_happy_time
			days = 90
		}
		
		MEX = {
			country_event = {
				id = mexico.24
				days = 1
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = mexico.23.b # Best not
		
		ai_chance = {
			factor = 0
		}
	}
}

# Mexico is informed of the attacks by German submarines and gets the opportunity to enter the war against Germany

country_event = {
	id = mexico.24
	title = mexico.24.title
	desc = mexico.24.desc
	
	picture = GFX_report_event_merchant_ship_01
	
	is_triggered_only = yes

	option = {
		name = mexico.24.a # Join the war against Germany
		
		trigger = {
			NOT = {
				has_war_with = USA
			}
			is_in_faction = no
			has_dlc = "Man the Guns"
		}
		
		add_war_support = 0.01
		
		random_other_country = {
			limit = {
				is_in_faction_with = USA
				is_faction_leader = yes
			}
			country_event = {
				id = mexico.25
				days = 1
			}
		}
		
		ai_chance = {
			factor = 70
			
			modifier = {
				factor = 0.1
				USA = {
					surrender_progress > 0.1
				}
			}
			modifier = {
				factor = 0.5
				has_war = yes
			}
		}
	}
	
	option = {
		name = mexico.24.b # What can we do?
		
		add_stability = 0.01
		
		ai_chance = {
			factor = 30
			
			modifier = {
				factor = 0.5
				is_historical_focus_on = yes
			}
		}
	}
}

# USA's faction leader (ie USA or ENG) gets asked to add Mexico to the war against Germany

country_event = {
	id = mexico.25
	title = mexico.25.title
	desc = mexico.25.desc
	
	picture = GFX_report_event_merchant_ship_01
	
	is_triggered_only = yes
	
	option = {
		name = mexico.25.a # Every little helps
		
		trigger = {
			NOT = {
				has_war_with = MEX
			}
			has_dlc = "Man the Guns"
		}
		
		add_to_faction = MEX
		
		MEX = {
			add_to_war = {
				targeted_alliance = ROOT
				enemy = GER
			}
		}
		
		hidden_effect = {
			news_event = {
				id = mexico.26
				days = 1
			}
		}
		
		ai_chance = {
			factor = 85
			
			modifier = {
				factor = 0.5
				MEX = {
					has_war = yes
				}
			}
		}
	}
	
	option = {
		name = mexico.25.b # Mexico? Bahahaha
		
		add_political_power = 25
		
		ai_chance = {
			factor = 15
			
			modifier = {
				factor = 0.5
				is_historical_focus_on = yes
			}
		}
	}
}

# News event for Mexico joining the war against Germany after submarine attacks

news_event = {
	id = mexico.26
	title = mexico.26.title
	desc = mexico.26.desc
	
	picture = GFX_news_event_020
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.26.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
				has_war_with = GER
			}
		}
	}
	option = {
		name = mexico.26.b
		
		trigger = {
			OR = {
				original_tag = GER
				is_in_faction_with = GER
				has_war_with = MEX
			}
		}
	}
	option = {
		name = mexico.26.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
					original_tag = GER
					is_in_faction_with = GER
					has_war_with = GER
				}
			}
		}
	}
}

# Papal encyclical on Mexico issued by Pope Pius XI

country_event = {
	id = mexico.27
	title = mexico.27.title
	desc = mexico.27.desc
	
	picture = GFX_report_event_europe_funeral
	
	fire_only_once = yes
	
	trigger = {
		tag = MEX
		
		date > 1937.1.1
		
		has_civil_war = no

		NOT = {
			has_global_flag = flag_second_mexican_civil_war
		}
		has_dlc = "Man the Guns"
	}
	
	
	option = {
		name = mexico.27.a # It is good that the anti-Church violence has ended.
		
		MEX_increase_church_power = yes
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.1
				has_completed_focus = MEX_focus_state_education
			}
			modifier = {
				factor = 10
				has_active_mission = MEX_mission_second_cristiada
			}
			modifier = {
				factor = 10
				OR = {
					has_idea = MEX_church_power_2
					has_idea = MEX_church_power_1
				}
				NOT = { has_global_flag = flag_second_mexican_civil_war }
			}
		}
	}
	option = {
		name = mexico.27.b # Superstitious propaganda, prevent publication of this treason!
		
		MEX_decrease_church_power = yes
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.1
				has_completed_focus = MEX_focus_antidisestablishmentarianism
			}
			modifier = {
				factor = 10
				has_active_mission = MEX_mission_second_revolution
			}
			modifier = {
				factor = 10
				OR = {
					has_idea = MEX_church_power_4
					has_idea = MEX_church_power_5
				}
				NOT = { has_global_flag = flag_second_mexican_civil_war }
			}
		}
	}
}

# The renewed attacks on the church incite a Second Cristiada

country_event = {
	id = mexico.28
	title = mexico.28.title
	desc = mexico.28.desc
	
	picture = GFX_report_event_mex_civil_war
	
	fire_only_once = yes
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_government = communism
				}
				start_civil_war = {
					ideology = fascism
					size = 0.35
					keep_unit_leaders = { 700 701 702 703 704 705 706 707 708 709 710 711 712 }
				}
			}
			if = {
				limit = {
					has_government = fascism
				}
				start_civil_war = {
					ideology = democratic
					size = 0.35
					keep_unit_leaders = { 700 701 702 703 704 705 706 707 708 709 710 711 712 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
				}
				start_civil_war = {
					ideology = democratic
					size = 0.35
					keep_unit_leaders = { 700 701 702 703 704 705 706 707 708 709 710 711 712 }
				}
			}
			random_other_country = {
				limit = {
					original_tag = MEX
					has_war_with = ROOT
				}
				MEX_remove_church_power = yes
				set_cosmetic_tag = MEX_cristero
				add_field_marshal_role = {
					character = MEX_jesus_degollado_guizar
					traits = { war_hero trait_cautious }
					skill = 3
					attack_skill = 3
					defense_skill = 3
					planning_skill = 2
					logistics_skill = 2
				}
				add_corps_commander_role = { # Fictitious
					character = MEX_alberto_gorostieta_vega
					traits = { war_hero }
					skill = 3
					attack_skill = 2
					defense_skill = 2
					planning_skill = 3
					logistics_skill = 3
				}
				add_corps_commander_role = { # Fictitious
					character = MEX_dionisio_navarro_anguiano
					traits = { infantry_officer }
					skill = 3
					attack_skill = 3
					defense_skill = 2
					planning_skill = 3
					logistics_skill = 2
				}
				add_country_leader_role = {
					character = MEX_jesus_degollado_guizar
					country_leader = {
						expire = "1965.1.1"
						ideology = falangism
						traits = {
							cristero_general
						}
					}
					promote_leader = yes
				}
				add_country_leader_role = {
					character = MEX_luis_maria_martinez
					country_leader = {
						expire = "1965.1.1"
						ideology = socialism
						traits = {
							primate_of_mexico
						}
					}
					promote_leader = yes
				}
				division_template = {
					name = "Guardia Cristera"
					division_names_group = MEX_INF_01
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
					priority = 0
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"GER\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"USA\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"ITA\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"GER\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"USA\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Guardia Cristera\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"ITA\" } }"
						owner = PREV
					}
				}
				set_party_name = { ideology = fascism name = MEX_fascist_party_legionnaires_of_christ_short long_name = MEX_fascist_party_legionnaires_of_christ_long }
				set_party_name = { ideology = democratic name = MEX_democratic_party_national_action_party_short long_name = MEX_democratic_party_national_action_party_long }
			}
		}
	}

	option = {
		name = mexico.28.a # We should have stamped this treason out earlier!
		
		hidden_effect = {
			news_event = {
				id = mexico.29
				days = 1
			}
		}
	}
}

# News event for Second Cristiada

news_event = {
	id = mexico.29
	title = mexico.29.title
	desc = mexico.29.desc
	
	picture = GFX_news_event_mex_civil_war
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.29.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
			has_dlc = "Man the Guns"
		}
	}
	option = {
		name = mexico.29.b
		
		trigger = {
			has_war_with = MEX
		}
	}
	option = {
		name = mexico.29.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
				}
			}
		}
	}
}

# The rapid ascent of the church incites a civil war from the anti-Church military and far-left

country_event = {
	id = mexico.30
	title = mexico.30.title

	desc = {
		text = mexico.30.desc1
		trigger = {
			NOT = { has_completed_focus = MEX_focus_jefe_maximo } # Calles is in on the action
		}
	}
	desc = {
		text = mexico.30.desc2
		trigger = {
			has_completed_focus = MEX_focus_jefe_maximo # Calles has been placated and isn't mentioned in the description
		}
	}

	picture = GFX_report_event_mex_civil_war
	
	fire_only_once = yes
		
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					has_government = democratic
					NOT = {
						has_completed_focus = MEX_focus_jefe_maximo
					}
				}
				start_civil_war = {
					ideology = neutrality
					size = 0.35
				}
			}
			if = {
				limit = {
					has_government = democratic
					has_completed_focus = MEX_focus_jefe_maximo
				}
				start_civil_war = {
					ideology = communism
					size = 0.35
				}
			}
			if = {
				limit = {
					has_government = fascism
				}
				start_civil_war = {
					ideology = communism
					size = 0.35
				}
			}
			if = {
				limit = {
					has_government = neutrality
				}
				start_civil_war = {
					ideology = communism
					size = 0.35
				}
			}
			random_other_country = {
				limit = {
					original_tag = MEX
					has_war_with = ROOT
				}
				drop_cosmetic_tag = yes
				MEX_remove_church_power = yes
				save_event_target_as = mexican_second_revolution_rebeller
				ROOT = {
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 704 # Former president Abelardo L. Rodríguez
								has_id = 705 # Future president Manuel Ávila Camacho
								has_id = 707 # Revolutionary general/admiral Heriberto Jara Corona
							}
						}
						set_nationality = event_target:mexican_second_revolution_rebeller
					}
					if = {
						limit = {
							ROOT = {
								NOT = {
									has_completed_focus = MEX_focus_jefe_maximo
								}
							}
						}
						MEX_plutarco_calles = {
							add_field_marshal_role = {
								traits = { harsh_leader }
								skill = 4
								attack_skill = 4
								defense_skill = 3
								planning_skill = 2
								logistics_skill = 3
							}
							set_nationality = event_target:mexican_second_revolution_rebeller
						}
					}
				}
				
				MEX_vicente_lombardo = {
					add_corps_commander_role = { # It's your chance to shine, my boy!
						traits = { politically_connected }
						skill = 1
						attack_skill = 1
						defense_skill = 1
						planning_skill = 1
						logistics_skill = 1
					}	
					set_nationality = event_target:mexican_second_revolution_rebeller

				}

				add_corps_commander_role = {
					character = MEX_adolfo_de_la_huerta
					traits = { }
					skill = 3
					attack_skill = 3
					defense_skill = 3
					planning_skill = 2
					logistics_skill = 2
				}				
				add_country_leader_role = { # Exiled until 1935 following a rebellion attempt, allowed back in by Cardenas and joined the cabinet of Avila
					character = MEX_adolfo_de_la_huerta
					country_leader = {
						expire = "1965.1.1"
						ideology = conservatism
						traits = {
							#
						}
					}
					promote_leader = yes				
				}
				add_country_leader_role = {
					character = MEX_plutarco_calles
					country_leader = {
						expire = "1965.1.1"
						ideology = despotism
						traits = {
							el_jefe_maximo
						}
					}
					promote_leader = yes				
				}
				add_country_leader_role = {
					character = MEX_vicente_lombardo
					country_leader = {
						expire = "1965.1.1"
						ideology = marxism
						traits = {
							the_dean_of_mexican_marxism
						}
					}
				promote_leader = yes				
				}
				if = {
					limit = {
						NOT = { has_global_flag = flag_mexico_cedillo_has_revolted }
					}
					add_country_leader_role = {
						character = MEX_saturnino_cedillo
						country_leader = {
							expire = "1965.1.1"
							ideology = fascism_ideology
							traits = {
								strongman_of_san_luis_potosi
							}
						}
						promote_leader = yes				
					}
				}
				if = {
					limit = {
						has_global_flag = flag_mexico_cedillo_has_revolted
					}
					add_country_leader_role = {
						character = MEX_juan_andreu
						country_leader = {
							expire = "1965.1.1"
							ideology = fascism_ideology
							traits = {
								the_silver_president
							}
						}
						promote_leader = yes				
					}
				}
				division_template = {
					name = "Brigada Roja"
					division_names_group = MEX_INF_01
					regiments = {
						infantry = { x = 0 y = 0 }
						infantry = { x = 0 y = 1 }
						infantry = { x = 0 y = 2 }
					}
					priority = 0
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"MEX\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"USA\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"SOV\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"MEX\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"USA\" } }"
						owner = PREV
					}
				}
				random_owned_controlled_state = {
					create_unit = {
						division = "division_template = \"Brigada Roja\" start_experience_factor = 0.2 force_equipment_variants = { infantry_equipment_0 = { owner = \"SOV\" } }"
						owner = PREV
					}
				}
			}
		}
	}

	option = {
		name = mexico.30.a # Long live Christ the King and Blessed Mary of Guadalupe!
		
		hidden_effect = {
			news_event = {
				id = mexico.31
				days = 1
			}
		}
	}
}

# News event for Second Mexican Revolution

news_event = {
	id = mexico.31
	title = mexico.31.title
	desc = mexico.31.desc
	
	picture = GFX_news_event_mex_civil_war
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.31.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.31.b
		
		trigger = {
			has_war_with = MEX
		}
	}
	option = {
		name = mexico.31.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
				}
			}
		}
	}
}

country_event = {
	id = mexico.33
	title = mexico.33.title
	desc = mexico.33.desc
	
	picture = GFX_report_event_mex_civil_war
	
	is_triggered_only = yes

	option = {
		name = mexico.33.a
		
		MEX_decrease_church_power = yes
		
		add_stability = -0.01
		add_war_support = 0.01
		
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2.0
				is_in_faction_with = FROM
			}
			modifier = {
				factor = 0.1
				has_government = fascism
			}
			modifier = {
				factor = 10
				has_active_mission = MEX_mission_second_revolution
			}
			modifier = {
				factor = 10
				OR = {
					has_idea = MEX_church_power_4
					has_idea = MEX_church_power_5
				}
				NOT = { has_global_flag = flag_second_mexican_civil_war }
			}
		}
	}
	
	option = {
		name = mexico.33.b
		
		add_stability = 0.01
		add_war_support = -0.01
		
		add_opinion_modifier = {
			target = FROM
			modifier = protest_action
		}
		
		reverse_add_opinion_modifier = {
			target = FROM
			modifier = protest_action
		}
		
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2.0
				NOT = {
					has_government = FROM
				}
			}
		}
	}
}

# Germany is asked if they want to give Mexico tank licences for closer relations

country_event = {
	id = mexico.34
	title = mexico.34.title
	desc = mexico.34.desc
	
	picture = GFX_report_event_generic_panzer_attack
	
	is_triggered_only = yes

	option = {
		name = mexico.34.a
		
		trigger = {
			NOT = {
				has_war_with = MEX
			}
		}
		
		effect_tooltip = {
			add_opinion_modifier = {
				target = MEX
				modifier = mexico_german_resource_exchange
			}
			
			MEX = {
				add_opinion_modifier = {
					target = ROOT
					modifier = mexico_german_resource_exchange
				}
			}
		
			if = {
				limit = {
					has_dlc = "Death or Dishonor"
				}
				if = {
					limit = {
						has_tech = advanced_light_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_light_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_light_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_medium_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_medium_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_medium_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_heavy_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_heavy_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_heavy_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_light_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_light_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_light_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_medium_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_medium_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_medium_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_heavy_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_heavy_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_heavy_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				MEX = {
					add_tech_bonus = {
						name = armor
						bonus = 1.0
						uses = 1
						category = armor
					}
				}
			}
			if = {
				limit = {
					NOT = { has_dlc = "Death or Dishonor" }
				}
				MEX = {
					add_tech_bonus = {
						name = armor
						bonus = 1.0
						uses = 2
						category = armor
					}
				}
			}
			MEX = {
				give_resource_rights = { receiver = GER state = 476 }
				country_event = {
					days = 1
					id = mexico.35
				}
			}
		}
		
		hidden_effect = {
			MEX = {
				country_event = {
					days = 1
					id = mexico.35
				}
			}
		}
			
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2.0
				has_government = FROM
			}

			modifier = {
				factor = 2.0
				FROM = {
					is_in_faction = no
				}
			}
		}
	}
	
	option = {
		name = mexico.34.b
		
		MEX = {
			country_event = {
				days = 1
				id = mexico.36
			}
		}
		
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				FROM = {
					is_in_faction_with = ROOT
				}
			}

			modifier = {
				factor = 2.0
				FROM = {
					is_enemy_ideology = yes
				}
			}

			modifier = {
				factor = 2.0
				FROM = {
					is_in_faction_with = USA
				}
			}
			
			modifier = {
				factor = 2.0
				FROM = {
					is_in_faction_with = ENG
				}
			}
			
			modifier = {
				factor = 2.0
				FROM = {
					is_in_faction_with = SOV
				}
			}
		}
	}
}

# Mexico is informed Germany is giving them free tank licences

country_event = {
	id = mexico.35
	title = mexico.35.title
	desc = mexico.35.desc
	
	picture = GFX_report_event_generic_panzer_attack
	
	is_triggered_only = yes

	option = {
		name = mexico.35.a
		
		add_opinion_modifier = {
			target = GER
			modifier = mexico_german_resource_exchange
		}
	
		GER = {
			add_opinion_modifier = {
				target = ROOT
				modifier = mexico_german_resource_exchange
			}

			if = {
				limit = {
					has_dlc = "Death or Dishonor"
				}
				if = {
					limit = {
						has_tech = advanced_light_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_light_tank
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_light_tank
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_medium_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_medium_tank
					
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_medium_tank
					
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_heavy_tank
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_heavy_tank
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_heavy_tank
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_equipment_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_light_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_light_tank_chassis
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_light_tank_chassis
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = light_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_medium_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_medium_tank_chassis
					
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_medium_tank_chassis
					
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = medium_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				if = {
					limit = {
						has_tech = advanced_heavy_tank_chassis
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_3
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = improved_heavy_tank_chassis
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_2
						}
						cost_factor = 0
					}
				}
				else_if = {
					limit = {
						has_tech = basic_heavy_tank_chassis
						
					}
					create_production_license = {
						target = MEX
						equipment = {
							type = heavy_tank_chassis_1
						}
						cost_factor = 0
					}
				}
				MEX = {
					add_tech_bonus = {
						name = armor
						bonus = 1.0
						uses = 1
						category = armor
					}
				}
			}
			if = {
				limit = {
					NOT = { has_dlc = "Death or Dishonor" }
				}
				MEX = {
					add_tech_bonus = {
						name = armor
						bonus = 1.0
						uses = 2
						category = armor
					}
				}
			}
			give_resource_rights = { receiver = GER state = 476 }
		}
	}
}

# Mexico is informed Germany refuses to give tank licences for free

country_event = {
	id = mexico.36
	title = mexico.36.title
	desc = mexico.36.desc
	
	picture = GFX_report_event_generic_panzer_attack
	
	is_triggered_only = yes

	option = {
		name = mexico.36.a
	}
}

# Operation Just Cause - Mexico seizes the Panama Canal and is informed of success

country_event = {
	id = mexico.40
	title = mexico.40.title
	desc = mexico.40.desc
	
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes

	option = {
		name = mexico.40.a
		
		transfer_state = 685

		add_war_support = 0.05

		army_experience = 25
	}
}

# Operation Just Cause succeeded - America gets opportunity to retaliate

country_event = {
	id = mexico.41
	title = mexico.41.title
	desc = mexico.41.desc
	
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes
	
	option = {
		name = mexico.41.a
				
		army_experience = 25

		add_political_power = 100
		
		add_opinion_modifier = {
			target = MEX
			modifier = embargo
		}
		
		MEX = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
		}
		
		set_global_flag = flag_america_plans_to_punish_mexico_for_canal_attack

		hidden_effect = {
			news_event = {
				id = mexico.44
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				is_historical_focus_on = yes
			}
		}
	}
	
	option = {
		name = mexico.41.b
		
		army_experience = 25

		add_war_support = 0.05
		
		create_wargoal = {
			type = puppet_wargoal_focus
			target = MEX
		}
		
		add_opinion_modifier = {
			target = MEX
			modifier = embargo
		}
		
		MEX = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
		}
		
		set_global_flag = flag_america_ignores_mexican_attack_on_canal

		hidden_effect = {
			news_event = {
				id = mexico.44
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				has_war = yes
			}
		}
	}
}

# Operation Just Cause - Mexican attack on Panama Canal failed

country_event = {
	id = mexico.42
	title = mexico.42.title
	desc = mexico.42.desc
	
	picture = GFX_report_event_soviet_soldiers_tank
	
	is_triggered_only = yes

	option = {
		name = mexico.42.a
		
		add_war_support = -0.05

		army_experience = 25
	}
}

# Operation Just Cause failed - America gets opportunity to retaliate

country_event = {
	id = mexico.43
	title = mexico.43.title
	desc = mexico.43.desc
	
	picture = GFX_report_event_usa_macarthur_speech
	
	is_triggered_only = yes
	
	option = {
		name = mexico.43.a
				
		army_experience = 25
		
		add_opinion_modifier = {
			target = MEX
			modifier = embargo
		}
		
		MEX = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
		}
		
		set_global_flag = flag_america_plans_to_punish_mexico_for_canal_attack

		hidden_effect = {
			news_event = {
				id = mexico.45
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				is_historical_focus_on = yes
			}
		}
	}
	
	option = {
		name = mexico.43.b
		
		army_experience = 25
		
		create_wargoal = {
			type = puppet_wargoal_focus
			target = MEX
		}
		
		add_opinion_modifier = {
			target = MEX
			modifier = embargo
		}
		
		MEX = {
			add_opinion_modifier = {
				target = ROOT
				modifier = embargo
			}
		}
		
		set_global_flag = flag_america_ignores_mexican_attack_on_canal

		hidden_effect = {
			news_event = {
				id = mexico.45
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				has_war = yes
			}
		}
	}
}

# News event for a successful seizure of Panama Canal

news_event = {
	id = mexico.44
	title = mexico.44.title

	desc = { # 
		text = mexico.44.desc1
		trigger = {
			has_global_flag = flag_america_plans_to_punish_mexico_for_canal_attack
		}
	}
	desc = { # 
		text = mexico.44.desc2
		trigger = {
			has_global_flag = flag_america_ignores_mexican_attack_on_canal
		}
	}
	
	picture = GFX_news_event_039
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.44.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.44.b
		
		trigger = {
			OR = {
				original_tag = USA
				is_in_faction_with = USA
			}
		}
	}
	option = {
		name = mexico.44.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					original_tag = USA
					is_in_faction_with = USA
				}
			}
		}
	}
}

# News event for the seizure of Panama Canal failing

news_event = {
	id = mexico.45
	title = mexico.45.title

	desc = { # 
		text = mexico.45.desc1
		trigger = {
			has_global_flag = flag_america_plans_to_punish_mexico_for_canal_attack
		}
	}
	desc = { # 
		text = mexico.45.desc2
		trigger = {
			has_global_flag = flag_america_ignores_mexican_attack_on_canal
		}
	}
	
	picture = GFX_news_event_usa_japan_at_war
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.45.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.45.b
		
		trigger = {
			OR = {
				original_tag = USA
				is_in_faction_with = USA
			}
		}
	}
	option = {
		name = mexico.45.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					original_tag = USA
					is_in_faction_with = USA
				}
			}
		}
	}
}

# News event for Mexico creating Latin American Order faction

news_event = {
	id = mexico.46
	title = mexico.46.title
	desc = mexico.46.desc
	
	picture = GFX_news_event_053
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.46.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.46.b
		
		trigger = {
			has_war_with = MEX
		}
	}
	option = {
		name = mexico.46.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
				}
			}
		}
	}
}

# News event for Mexico creating Bolivarian Alliance

news_event = {
	id = mexico.47
	title = mexico.47.title
	desc = mexico.47.desc
	
	picture = GFX_news_event_gathering_protest
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.46.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.46.b
		
		trigger = {
			has_war_with = MEX
		}
	}
	option = {
		name = mexico.46.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
				}
			}
		}
	}
}

# Mexico sends a shipment of military supplies to a Spanish Civil War participant

country_event = {
	id = mexico.50
	title = mexico.50.title
	desc = mexico.50.desc
	
	picture = GFX_report_event_merchant_ship_01
	
	is_triggered_only = yes
	
	option = {
		name = mexico.50.a

		add_equipment_to_stockpile = {
			type = infantry_equipment_0
			amount = 250
			producer = "MEX"
		}
	}
}

# Shipment intended for Spain is sunk

country_event = {
	id = mexico.51
	title = mexico.51.title
	desc = mexico.51.desc
	
	picture = GFX_report_event_merchant_ship_01

	is_triggered_only = yes

	option = {
		name = mexico.51.a
	}
}

country_event = {
	id = mexico.52
	title = mexico.52.title
	desc = {
		text = mexico.52.desc_not_trotsky
		trigger = {
			NOT = {
				MEX = {
					has_country_leader = { ruling_only = yes character = MEX_leon_trotsky }
				}			
			}	
		}
	}
	desc = {
		text = mexico.52.desc_trotsky
		trigger = {			
			MEX = {
				has_country_leader = { ruling_only = yes character = MEX_leon_trotsky }
			}				
		}
	}		
	picture = GFX_report_event_soviet_purge_politicians

	is_triggered_only = yes

	option = { #ask other communist faction leaders to dismantle their faction and join Trotsky
		name = mexico.52.a
		every_other_country = {
			limit = {
				is_in_faction_with = ROOT
			}
			country_event = {
				id = mexico.53
			}
		}
		dismantle_faction = yes
		MEX = {
			add_to_faction = PREV
		}
		ai_chance = {
			factor = 70
		}		
	}	
	option = {
		name = mexico.52.b #Never! Stalinism best -ism.
		ai_chance = {
			factor = 30
		}		
	}
}
country_event = {
	id = mexico.53
	title = mexico.53.title
	desc = mexico.53.desc
	
	picture = GFX_report_event_communists_cheer

	is_triggered_only = yes

	option = { #ask minor communist countries to join Trotsky
		name = mexico.53.a
		MEX = {
			add_to_faction = ROOT
		}
		ai_chance = {
			factor = 90
		}		
	}	
	option = {
		name = mexico.53.b
		#Never! Stalinism best -ism.
		ai_chance = {
			factor = 10
		}		
	}
}
# Enforce Decolonization event - release or else!!!!
country_event = {
	id = mexico.54
	title = mexico.54.title
	desc = mexico.54.desc
	picture = GFX_report_event_soviet_purge_politicians

	is_triggered_only = yes
	
	# Accept - We will release
	option = {
		name = mexico.54.a
		ai_chance = {
			factor = 34
			modifier = {
				factor = 1.5
				strength_ratio = {
					tag = MEX
					ratio < 0.5
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio < 0.3
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio < 0.2
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio < 0.1
				}
			}
			modifier = {
				factor = 0
				strength_ratio = {
					tag = MEX
					ratio > 1.6
				}
			}
		}
		if = {
			limit = {
				original_tag = USA
				owns_state = 686
				has_full_control_of_state = 686
			}
		}
		if = {
			limit = {
				original_tag = HOL
				owns_state = 695
				has_full_control_of_state = 695
			}
		}
		if = {
			limit = {
				original_tag = HOL
				owns_state = 309
				has_full_control_of_state = 309
			}
		}
		if = {
			limit = {
				original_tag = FRA
				owns_state = 694
				has_full_control_of_state = 694
			}
		}
		if = {
			limit = {
				original_tag = FRA
				owns_state = 310
				has_full_control_of_state = 310
			}
		}
		if = {
			limit = {
				original_tag = ENG
				owns_state = 687
				has_full_control_of_state = 687
			}
		}
		if = {
			limit = {
				original_tag = ENG
				owns_state = 689
				has_full_control_of_state = 689
			}
		}		
		if = {
			limit = {
				original_tag = ENG
				owns_state = 691
				has_full_control_of_state = 691
			}
		}
		if = {
			limit = {
				original_tag = ENG
				owns_state = 692
				has_full_control_of_state = 692
				owns_state = 308
				has_full_control_of_state = 308				
			}
		}
		if = {
			limit = {
				original_tag = ENG
				owns_state = 690
				has_full_control_of_state = 690
				owns_state = 693
				has_full_control_of_state = 693				
			}
		}								
		FROM = { country_event = { id = mexico.55 hours = 6 } }
	}

	# Reject - We will NOT release
	option = {
		name = mexico.54.b
		ai_chance = {
			factor = 66
			modifier = {
				factor = 1.5
				strength_ratio = {
					tag = MEX
					ratio > 0.7
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio > 0.85
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio > 1
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio > 1.2
				}
			}
			modifier = {
				factor = 2
				strength_ratio = {
					tag = MEX
					ratio > 1.4
				}
			}
		}
		FROM = { country_event = { id = mexico.56 hours = 6 } }
		effect_tooltip = {
			FROM = { 
				create_wargoal = {
					type = puppet_wargoal_focus
					target = ROOT
				}
			}
		}
	}
}
# Enforce Decolonization event - FROM has released
country_event = {
	id = mexico.55
	title = mexico.55.title
	desc = mexico.55.desc
	picture = GFX_report_event_soviet_purge_politicians

	is_triggered_only = yes
	
	# Ok
	option = {
		name = mexico.55.a
		#TODO_Drikus effect_tooltip
	}
}

# Enforce Decolonization event - FROM has refused to release!
country_event = {
	id = mexico.56
	title = mexico.56.title
	desc = mexico.56.desc
	picture = GFX_report_event_soviet_purge_politicians 

	is_triggered_only = yes
	
	# Ok
	option = {
		name = mexico.56.a
		create_wargoal = {
			type = puppet_wargoal_focus
			target = FROM
		}
	}
}

news_event = {
	id = mexico.57
	title = mexico.57.title
	desc = mexico.57.desc
	
	picture = GFX_news_event_023
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = mexico.57.a
		
		trigger = {
			OR = {
				original_tag = MEX
				is_in_faction_with = MEX
			}
		}
	}
	option = {
		name = mexico.57.b
		
		trigger = {
			OR = {
				original_tag = SOV
				is_in_faction_with = SOV
				has_war_with = MEX
			}
		}
	}
	option = {
		name = mexico.57.c
		
		trigger = {
			NOT = {
				OR = {
					original_tag = MEX
					is_in_faction_with = MEX
					has_war_with = MEX
					original_tag = SOV
					is_in_faction_with = SOV
				}
			}
		}
	}
}